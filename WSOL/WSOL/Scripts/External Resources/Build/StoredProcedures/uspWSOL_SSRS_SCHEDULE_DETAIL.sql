CREATE PROCEDURE [dbo].[uspWSOL_SSRS_SCHEDULE_DETAIL]
 @DATE_BEG				DATETIME
,@DATE_END				DATETIME
,@SUPPRESS_ZEROS		VARCHAR(5)	  --Vis. Def='0'
,@ONLY_SCHEDULED_TIME	VARCHAR(5)	  --Hid. Def='0'
,@CLIENT_ID				VARCHAR(2500) --Vis. Def='ALL'
,@PROGRAM_ID			VARCHAR(2500) --Vis. Def='ALL'
,@INTERVAL				VARCHAR(1)	  --Vis. Def='H'
,@DUR_IN				VARCHAR(1)	  --Vis. Def='M'
,@PSW					VARCHAR(10)   --Hid. Def='NONE'
,@EXECUTIONER			VARCHAR(3)    --Hid. Def='MAN'  MANual,SUBscription
,@RPT_TYPE				VARCHAR(3)    --Hid. Def='DLY'  
AS
BEGIN
SET NOCOUNT ON 

--  EXECUTE [dbo].[uspWSOL_SSRS_SCHEDULE_DETAIL] '07/13/2017','07/13/2017','1','1','141','ALL','H','H','','MAN','DLY'

--=============================================================================
SET DATEFIRST 1  --1=MONDAY  7=SUNDAY  --DW = M,T,W,T,F,S,S
--=============================================================================
DECLARE
 @DTM_BEG AS DATETIME
,@DTM_END AS DATETIME
	IF @DATE_BEG < '01/01/1901' OR @RPT_TYPE = 'WKL' BEGIN	--WEEKLY - Run report for 7 days from current day to current day.
			--Dates passed in are for PREVIOUS DAY:
		SET @DTM_BEG = CAST(CONVERT(VARCHAR(10),@DATE_BEG,101) AS DATETIME)				-- @DATE_BEG already starting at yesterday's date.
		SET @DTM_BEG = CASE WHEN DATEPART(DW,@DTM_BEG) = 1 THEN @DTM_BEG				-- MONDAY
							ELSE DATEADD(DD,-6,@DTM_BEG) END								-- SET START DATE TO PAST MONDAY
		SET @DTM_END = CAST(CONVERT(VARCHAR(10),@DATE_END,101) AS DATETIME)				-- + 1 --DONE BELOW. 

		IF @DTM_END >  DBO.GETDATE() - 1 BEGIN											--DBO.GETDATE() -1 IS GOING TO ALSO INCLUDE SOME TIME AFTER MIDNIGHT.  THIS IS CORRECT !
			SET @DTM_END = CAST(CONVERT(VARCHAR(10),DBO.GETDATE() - 1,101) AS DATETIME)
		END
	END
	ELSE IF @RPT_TYPE = 'DLY' BEGIN
		SET @DTM_BEG = CAST(CONVERT(VARCHAR(10),@DATE_BEG,101) AS DATETIME)
		SET @DTM_BEG = DATEADD(DD, +1, @DTM_BEG)										-- SET DATE TO TODAY
		SET @DTM_END = CAST(CONVERT(VARCHAR(10),@DATE_END,101) AS DATETIME)
		SET @DTM_END = DATEADD(DD, +1, @DTM_END)										-- SET DATE TO TODAY
	END
	ELSE BEGIN  --DAILY - Run report for YESTERDAY, 1 Day ONLY.
		SET @DTM_BEG = CAST(CONVERT(VARCHAR(10),@DATE_BEG,101) AS DATETIME)				--@DATE_BEG already starting at yesterday's date.
		SET @DTM_END = CAST(CONVERT(VARCHAR(10),@DATE_END,101) AS DATETIME)				-- + 1 --done below.
	END

SET @DTM_END    = @DTM_END + 1  --EVERYTHING ABOVE, @DTM_END IS FOR EXACT DATE RANGE NEEDED. ONE IS ADDED SO WHERE CLAUSE " < @DTM_END" WORKS.

--=======================================================================================
--	SET MULTI-VALUE PARAMETERS:
--=======================================================================================
SET @CLIENT_ID	= ',' + LTRIM(RTRIM(REPLACE(@CLIENT_ID	,'ALL','0'))) + ','
SET @PROGRAM_ID	= ',' + LTRIM(RTRIM(REPLACE(@PROGRAM_ID	,'ALL','0'))) + ','


--==================================
--	SET AMOUNT TO DIVIDE BY:
--==================================
DECLARE @DS DECIMAL(10,2)
IF @DUR_IN = 'S' BEGIN
	SET @DS = 1.00
END
IF @DUR_IN = 'M' BEGIN
	SET @DS = 60.00
END
IF @DUR_IN = 'H' BEGIN
	SET @DS = 3600.00
END


--==================================
--	CREATE TMP TABLE:
--==================================
--	SELECT TOP 100 * FROM WSOL_VW_SCHEDULE_DETAIL
IF OBJECT_ID('TEMPDB..#WSOL_SSRS_SCHEDULE_DETAILS') IS NOT NULL BEGIN
   DROP TABLE #WSOL_SSRS_SCHEDULE_DETAILS
END
CREATE TABLE #WSOL_SSRS_SCHEDULE_DETAILS
(AGENT_FIRST_NAME				VARCHAR(100)
,AGENT_MIDDLE_NAME				VARCHAR(100)
,AGENT_LAST_NAME				VARCHAR(100)
,CORPORATE_NAME					VARCHAR(200)
,CATS_ID						VARCHAR(20)
,EMAIL_ADDRESS					VARCHAR(200)
,SCHEDULE_DATE					DATETIME
,INTERVAL_START					CHAR(5)
,CLIENT_NAME					VARCHAR(100)
,[PROGRAM_NAME]					VARCHAR(100)
,SCHEDULED_TIME					DECIMAL(10,2)
,CANCELLED_TIME					DECIMAL(10,2)
,RESOURCE_NAME					VARCHAR(200)
)

INSERT INTO #WSOL_SSRS_SCHEDULE_DETAILS
SELECT
 DAT.AGENT_FIRST_NAME
,DAT.AGENT_MIDDLE_NAME
,DAT.AGENT_LAST_NAME
,DAT.CORPORATE_NAME
,DAT.CATS_ID
,DAT.EMAIL_ADDRESS
,DAT.SCHEDULE_DATE
,DAT.INTERVAL_START
,DAT.CLIENT_NAME
,DAT.[PROGRAM_NAME]
,DAT.SCHEDULED_TIME
,DAT.CANCELLED_TIME
,DAT.RESOURCE_NAME
FROM
(	SELECT	
	 APP.FIRSTNAME																	AS AGENT_FIRST_NAME
	,APP.MIDDLINIT																	AS AGENT_MIDDLE_NAME
	,APP.LASTNAME																	AS AGENT_LAST_NAME
	,CASE WHEN APP.CORPORATEW9 = 'Y' THEN APP.CORPORATNAME
		  ELSE '' END																AS CORPORATE_NAME
	,APP.AGENTIDENTNUM																AS CATS_ID
	,APP.EMAIL																		AS EMAIL_ADDRESS
	,CAST(SCH.SCHEDULE_DATE AS DATETIME)											AS SCHEDULE_DATE
	,CASE WHEN @INTERVAL = 'D' THEN '00:00'
		  WHEN @INTERVAL = 'H' THEN
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN 
					CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
				 ELSE
					CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
			END
		  WHEN @INTERVAL = 'T' THEN
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (0,15)  THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (30,45) THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':30')
					END
				 ELSE
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (0,15)  THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (30,45) THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':30')
					END
			END
		  ELSE
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) = 0 THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 ELSE
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':',CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)))
					END
				 ELSE
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) = 0 THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 ELSE
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':',CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)))
					END
			END
	 END	AS INTERVAL_START
	/*,CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN 
			CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)))
		  ELSE
			CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) END					AS INTERVAL_START */
	,SCH.CLIENT_NAME																AS CLIENT_NAME
	,SCH.[PROGRAM_NAME]																AS [PROGRAM_NAME]
	,SUM(SCH.SCHEDULED_SECS) / @DS													AS SCHEDULED_TIME
	,SUM(SCH.CANCELLED_SECS) / @DS													AS CANCELLED_TIME
	,CASE WHEN ISNULL(APP.MIDDLINIT,'') = '' THEN
			CONCAT(APP.FIRSTNAME,' ',APP.LASTNAME)
		  ELSE
			CONCAT(APP.FIRSTNAME,' ',APP.MIDDLINIT,' ',APP.LASTNAME) END			AS RESOURCE_NAME

--  SELECT *
	FROM
	(
		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:00:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0000) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:15:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0015) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:30:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0030) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:45:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0045) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:00:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0100) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:15:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0115) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID  IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:30:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0130) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:45:00' AS DATETIME)	AS INTERVAL_START
		,CASE WHEN SUM(S.F0145) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
		,0.00																AS CANCELLED_SECS
		FROM  SCHTIMES_AGENT	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0200) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0215) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0230) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0245) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0300) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0315) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0330) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0345) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0400) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0415) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0430) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0445) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0500) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0515) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0530) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0545) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0600) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0615) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0630) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0645) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0700) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0715) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0730) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0745) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0800) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0815) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0830) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0845) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0900) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0915) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0930) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F0945) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1000) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1015) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1030) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1045) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1100) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1115) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1130) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1145) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1200) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1215) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1230) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1245) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1300) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1315) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1330) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1345) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1400) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1415) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1430) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1445) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1500) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1515) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1530) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1545) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1600) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1615) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1630) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1645) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1700) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1715) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1730) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1745) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1800) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1815) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1830) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1845) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1900) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1915) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1930) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F1945) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2000) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2015) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2030) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2045) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2100) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2115) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2130) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2145) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2200) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2215) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2230) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2245) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:00:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2300) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:15:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2315) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:30:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2330) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:45:00' AS DATETIME)	AS INTERVAL_START
,CASE WHEN SUM(S.F2345) > 0 THEN 900 ELSE 0 END						AS SCHEDULED_SECS
,0.00																AS CANCELLED_SECS
FROM  SCHTIMES_AGENT	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]
	
	UNION ALL
																									--<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:00:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0000) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:15:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0015) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:30:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0030) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 00:45:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0045) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:00:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0100) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:15:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0115) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID  IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:30:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0130) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

		UNION ALL

		SELECT
		 S.IDAGENT															AS IDAGENT
		,S.DATESCH															AS SCHEDULE_DATE
		,S.IDPROGR															AS IDPROGR
		,C.ID																AS CLIENT_ID
		,C.[NAME]															AS CLIENT_NAME
		,P.[NAME]															AS [PROGRAM_NAME]
		,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 01:45:00' AS DATETIME)	AS INTERVAL_START
		,0.00																AS SCHEDULED_SECS
		,CASE WHEN SUM(S.F0145) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
		FROM  SCHTIMES_CANCEL	S
		LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
		LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
		WHERE P.ISSHOW = 1
		AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
		AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
		AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
		AND S.PMREQMOVE <> 'Y'
		GROUP BY
		 S.IDAGENT
		,S.DATESCH
		,S.IDPROGR
		,C.ID
		,C.[NAME]
		,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0200) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0215) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0230) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 02:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0245) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0300) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0315) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0330) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 03:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0345) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0400) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0415) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0430) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 04:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0445) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0500) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0515) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0530) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 05:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0545) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0600) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0615) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0630) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 06:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0645) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0700) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0715) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0730) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 07:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0745) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0800) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0815) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0830) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 08:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0845) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0900) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0915) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0930) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 09:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F0945) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1000) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1015) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1030) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 10:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1045) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1100) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1115) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1130) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 11:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1145) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1200) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1215) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1230) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 12:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1245) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1300) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1315) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1330) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 13:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1345) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1400) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1415) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1430) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 14:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1445) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1500) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1515) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1530) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 15:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1545) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1600) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1615) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1630) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 16:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1645) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1700) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1715) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1730) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 17:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1745) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1800) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1815) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1830) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 18:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1845) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1900) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1915) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1930) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 19:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F1945) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2000) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2015) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2030) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 20:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2045) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2100) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2115) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2130) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 21:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2145) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2200) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2215) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2230) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 22:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2245) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:00:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2300) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:15:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2315) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:30:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2330) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]

UNION ALL

SELECT
 S.IDAGENT															AS IDAGENT
,S.DATESCH															AS SCHEDULE_DATE
,S.IDPROGR															AS IDPROGR
,C.ID																AS CLIENT_ID
,C.[NAME]															AS CLIENT_NAME
,P.[NAME]															AS [PROGRAM_NAME]
,CAST(CONVERT(VARCHAR(10), S.DATESCH) + ' 23:45:00' AS DATETIME)	AS INTERVAL_START
,0.00																AS SCHEDULED_SECS
,CASE WHEN SUM(S.F2345) > 0 THEN 900 ELSE 0 END						AS CANCELLED_SECS
FROM  SCHTIMES_CANCEL	S
LEFT JOIN PROGRAM		P ON S.IDPROGR	= P.ID
LEFT JOIN CLIENT		C ON P.IDCLIENT = C.ID
WHERE P.ISSHOW = 1
  AND ( CAST(S.DATESCH AS DATETIME) >= @DTM_BEG AND CAST(S.DATESCH AS DATETIME) < @DTM_END )
  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(C.ID)	   + ',',@CLIENT_ID) > 0   ) --C.ID = @CLIENT_ID
  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(S.IDPROGR) + ',',@PROGRAM_ID)> 0   ) -- P.ID = @PROGRAM_ID
  AND S.PMREQMOVE <> 'Y'
GROUP BY
 S.IDAGENT
,S.DATESCH
,S.IDPROGR
,C.ID
,C.[NAME]
,P.[NAME]
	) SCH
	
	LEFT JOIN	AGENTS					AGT ON SCH.IDAGENT	= AGT.ID
	LEFT JOIN	APPLICANT				APP ON AGT.EMAIL	= APP.EMAIL

	WHERE ( CAST(SCH.SCHEDULE_DATE AS DATETIME) >= @DTM_BEG AND CAST(SCH.SCHEDULE_DATE AS DATETIME) <  @DTM_END )
	  AND ( @CLIENT_ID	IN (',0,') OR CHARINDEX(',' + RTRIM(SCH.CLIENT_ID)  + ',',@CLIENT_ID)	> 0 )
	  AND ( @PROGRAM_ID IN (',0,') OR CHARINDEX(',' + RTRIM(SCH.IDPROGR)	+ ',',@PROGRAM_ID)	> 0 )

	GROUP BY
	 APP.FIRSTNAME
	,APP.MIDDLINIT
	,APP.LASTNAME
	,CASE WHEN APP.CORPORATEW9 = 'Y' THEN APP.CORPORATNAME
		  ELSE '' END
	,APP.AGENTIDENTNUM
	,APP.EMAIL
	,CAST(SCH.SCHEDULE_DATE AS DATETIME)
	,CASE WHEN @INTERVAL = 'D' THEN '00:00'
		  WHEN @INTERVAL = 'H' THEN
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN 
					CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
				 ELSE
					CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
			END
		  WHEN @INTERVAL = 'T' THEN
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (0,15)  THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (30,45) THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':30')
					END
				 ELSE
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (0,15)  THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) IN (30,45) THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':30')
					END
			END
		  ELSE
			CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) = 0 THEN
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 ELSE
							CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':',CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)))
					END
				 ELSE
					CASE WHEN CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)) = 0 THEN
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':00')
						 ELSE
							CONCAT(CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)),':',CONVERT(VARCHAR(2),DATEPART(MI,SCH.INTERVAL_START)))
					END
			END
	 END
	/*,CASE WHEN CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) < 10 THEN 
			CONCAT('0',CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)))
		  ELSE
			CONVERT(VARCHAR(2),DATEPART(HH,SCH.INTERVAL_START)) END	 */
	,SCH.CLIENT_NAME
	,SCH.[PROGRAM_NAME]
	,CASE WHEN ISNULL(APP.MIDDLINIT,'') = '' THEN
			CONCAT(APP.FIRSTNAME,' ',APP.LASTNAME)
		  ELSE
			CONCAT(APP.FIRSTNAME,' ',APP.MIDDLINIT,' ',APP.LASTNAME) END
) DAT


--=================================================================================================
--	RETURN DATASET:
--=================================================================================================

IF @SUPPRESS_ZEROS = 1

	BEGIN

		IF @ONLY_SCHEDULED_TIME = 1
		
		BEGIN
		SELECT 
		 CONVERT(VARCHAR(10),@DTM_BEG,101) + '-' + CONVERT(VARCHAR(10),@DTM_END - 1,101)  AS DATE_RANGE
		,V.*
		FROM	#WSOL_SSRS_SCHEDULE_DETAILS		V
		WHERE   V.SCHEDULED_TIME > 0.00
		ORDER BY 
		 V.SCHEDULE_DATE
		,V.RESOURCE_NAME
		END

		ELSE BEGIN
		SELECT 
		 CONVERT(VARCHAR(10),@DTM_BEG,101) + '-' + CONVERT(VARCHAR(10),@DTM_END - 1,101)  AS DATE_RANGE
		,V.*
		FROM	#WSOL_SSRS_SCHEDULE_DETAILS		V
		WHERE ( V.SCHEDULED_TIME > 0.00 OR V.CANCELLED_TIME > 0.00)
		ORDER BY 
		 V.SCHEDULE_DATE
		,V.RESOURCE_NAME
		END

	END
	ELSE BEGIN
		
		IF @ONLY_SCHEDULED_TIME = 1
		
		BEGIN
		SELECT 
		 CONVERT(VARCHAR(10),@DTM_BEG,101) + '-' + CONVERT(VARCHAR(10),@DTM_END - 1,101)  AS DATE_RANGE
		,V.*
		FROM	#WSOL_SSRS_SCHEDULE_DETAILS		V
		WHERE   V.SCHEDULED_TIME > 0.00
		ORDER BY 
		 V.SCHEDULE_DATE
		,V.RESOURCE_NAME
		END

		ELSE BEGIN
		SELECT 
		 CONVERT(VARCHAR(10),@DTM_BEG,101) + '-' + CONVERT(VARCHAR(10),@DTM_END - 1,101)  AS DATE_RANGE
		,V.*
		FROM	#WSOL_SSRS_SCHEDULE_DETAILS		V
		ORDER BY 
		 V.SCHEDULE_DATE
		,V.RESOURCE_NAME
		END

	END	

--===============================
EARLY_EXIT:
--===============================
--IMPOSSIBLE:  SELECT 1/0    POSSIBLE:  SELECT 0/1

END

GO