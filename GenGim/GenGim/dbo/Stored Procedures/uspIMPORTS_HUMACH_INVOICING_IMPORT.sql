

CREATE PROCEDURE [dbo].[uspIMPORTS_HUMACH_INVOICING_IMPORT]
AS
SET NOCOUNT ON

--  EXECUTE [dbo].[uspIMPORTS_HUMACH_INVOICING_IMPORT]

--  SELECT * FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1 ORDER BY [DATETIME] DESC

--	Durations in file are in seconds.

--=============================================
DECLARE @TENANT_KEY INT
SET @TENANT_KEY =       900901  --HUMACH
--=============================================
DELETE FROM WSOL_TB_IMPORT_ERRORS_FOUND 
WHERE TENANT_KEY = @TENANT_KEY
  AND SUB_GROUP_NAME = 'HUMACH_INVOICING'    --  SELECT * FROM WSOL_TB_IMPORT_ERRORS_FOUND WHERE TENANT_KEY = 900901
--=============================================

--===============================================================================================================================================
--USING @WS_ROW_CREATED_TIME FOR ALL INSERTS WILL ALLOW ME TO DELETE SPECIFIC INSERT PROCESSES/FILES.  MOST IMPORTANT!!!  FOR ALL TABLES.
--  IN CASE OF EMERGENCY, CRACK GLASS.
--===============================================================================================================================================
DECLARE @WS_ROW_CREATED_TIME AS DATETIME
SET @WS_ROW_CREATED_TIME = dbo.getdate()  --CLOSE ENOUGH TO ACTUAL INSERT TIME!
--===================================================================================

--======================================================================
--HANDLE COLUMN HEADER AND JUNK RECORDS:
--======================================================================
INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_BAD
(
BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID)
SELECT
 'JNK'                  --BAD_IMPORTS_CODE  --'Junk Record'
,'ACT'                  --BAD_IMPORTS_FILE_TYPE  --'ACT'IVITY FILE.
,@WS_ROW_CREATED_TIME   --WS_ROW_CREATED_TIME--TEST:,dbo.getdate()  --,TNM.*
,W1.FF_AGENT_FIRST_NAME
,W1.FF_AGENT_LAST_NAME
,W1.FF_AGENT_ID
,W1.FF_CUSTOMER_NAME
,W1.FF_CUSTOMER_ID
,W1.FF_INTERVAL
,W1.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W1.FF_INTERVAL_START_TS
,W1.FF_AGENT_LOGIN_START_TS
,W1.FF_STATE_LOGGED_IN_SECS
,W1.FF_STATE_READY_SECS
,W1.FF_STATE_ASSIGNED_SECS
,W1.FF_STATE_BUSY_SECS
,W1.FF_STATE_NR_SECS
,W1.FF_STATE_NR_01_SECS
,W1.FF_STATE_NR_02_SECS
,W1.FF_STATE_NR_03_SECS
,W1.FF_STATE_NR_04_SECS
,W1.FF_STATE_NR_05_SECS
,W1.FF_STATE_NR_06_SECS
,W1.FF_STATE_NR_07_SECS
,W1.FF_STATE_DIAL_PENDING_SECS
,W1.FF_STATE_UNKNOWN_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.LOGGED_IN_SECS
,W1.READY_SECS
,W1.ASSIGNED_SECS
,W1.BUSY_SECS
,W1.NOT_READY_SECS
,W1.AGENT_UNRESPONSIVE_SECS
,W1.POST_LOGIN_SECS
,W1.BREAK_SECS
,W1.WRAP_SECS
,W1.NR_05_SECS
,W1.NR_06_SECS
,W1.NR_07_SECS
,W1.DIAL_PENDING_SECS
,W1.STATE_UNKNOWN_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.Q_IN_CALLS_IN_AGT_ANS_CT
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.TOTAL_CALLS
,W1.AUTHORIZED_WRAP
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.EMAIL
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID

FROM           WSOL_TB_IMPORTS_HUMACH_INVOICING_1    W1
WHERE ISNULL(W1.FF_AGENT_FIRST_NAME,'') IN ('agentFirstName')

--======================================================================
--DELETE COLUMN HEADER AND JUNK RECORDS;
--======================================================================
DELETE FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
WHERE ISNULL(FF_AGENT_FIRST_NAME,'') IN ('agentFirstName')
--======================================================================

--UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
-- FF_AGENT_LAST_NAME = 'Stewart_ASA'
--WHERE FF_AGENT_LAST_NAME = 'Stewart_AMA' AND FF_AGENT_ID = '6138'

--=============================================================================
--POPULATE ADDITIONAL FIELDS IN WORK (_1) TABLE THAT WEREN'T IN IMPORTED FILE:
--=============================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
-- HOUR_INTERVAL				= CAST(SUBSTRING(FF_INTERVAL_START_TS, 12, 2) AS INT)
 RESOURCE_NAME				= ISNULL(FF_AGENT_FIRST_NAME,'') + ' ' + ISNULL(FF_AGENT_LAST_NAME,'')

,LOGGED_IN_SECS				= CAST(ISNULL(FF_STATE_LOGGED_IN_SECS	,'0.00') AS DECIMAL(10,2))
,READY_SECS					= CAST(ISNULL(FF_STATE_READY_SECS		,'0.00') AS DECIMAL(10,2))
,ASSIGNED_SECS				= CAST(ISNULL(FF_STATE_ASSIGNED_SECS	,'0.00') AS DECIMAL(10,2))
,BUSY_SECS					= CAST(ISNULL(FF_STATE_BUSY_SECS		,'0.00') AS DECIMAL(10,2))
,NOT_READY_SECS				= CAST(ISNULL(FF_STATE_NR_SECS			,'0.00') AS DECIMAL(10,2))
,AGENT_UNRESPONSIVE_SECS	= CAST(ISNULL(FF_STATE_NR_01_SECS		,'0.00') AS DECIMAL(10,2))
,POST_LOGIN_SECS			= CAST(ISNULL(FF_STATE_NR_02_SECS		,'0.00') AS DECIMAL(10,2))
,BREAK_SECS					= CAST(ISNULL(FF_STATE_NR_03_SECS		,'0.00') AS DECIMAL(10,2))
,WRAP_SECS					= CAST(ISNULL(FF_STATE_NR_04_SECS		,'0.00') AS DECIMAL(10,2))
,NR_05_SECS					= CAST(ISNULL(FF_STATE_NR_05_SECS		,'0.00') AS DECIMAL(10,2))
,NR_06_SECS					= CAST(ISNULL(FF_STATE_NR_06_SECS		,'0.00') AS DECIMAL(10,2))
,NR_07_SECS					= CAST(ISNULL(FF_STATE_NR_07_SECS		,'0.00') AS DECIMAL(10,2))
,DIAL_PENDING_SECS			= CAST(ISNULL(FF_STATE_DIAL_PENDING_SECS,'0.00') AS DECIMAL(10,2))
,STATE_UNKNOWN_SECS			= CAST(ISNULL(FF_STATE_UNKNOWN_SECS		,'0.00') AS DECIMAL(10,2))

,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS					= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS					,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS				= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS				,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_ANS_SECS							= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ANS_SECS							,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS					= CAST(ISNULL(FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS					,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS			= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS			,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS			= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS			,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS						= CAST(ISNULL(FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS						,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS				= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS				,'0.00') AS DECIMAL(10,2))
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS		= CAST(ISNULL(FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS		,'0.00') AS DECIMAL(10,2))
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS		= CAST(ISNULL(FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS		,'0.00') AS DECIMAL(10,2))
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	= CAST(ISNULL(FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	,'0.00') AS DECIMAL(10,2))

,Q_IN_CALLS_IN_AGT_ASSIGNED_CT			= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT			,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT	= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT	,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_ANS_CT				= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_ANS_CT				,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_AGT_CALLS_HOLD_CT			= CAST(ISNULL(FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT			,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT		= CAST(ISNULL(FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT		,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_AGT_CALLS_TRANS_CT			= CAST(ISNULL(FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT			,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT		= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT		,'0.00') AS DECIMAL(10,2))
,Q_IN_CALLS_IN_AGT_COMPLETED_CT			= CAST(ISNULL(FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT			,'0.00') AS DECIMAL(10,2))
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT		= CAST(ISNULL(FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT		,'0.00') AS DECIMAL(10,2))
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT	= CAST(ISNULL(FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT	,'0.00') AS DECIMAL(10,2))


UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 [DATETIME] = CAST(REPLACE(REPLACE(FF_INTERVAL_START_TS	,'T',' '),'Z','') AS DATETIME)

DECLARE
 @DTO	AS DATETIMEOFFSET
,@CST	AS DATETIME

SET @DTO = CONVERT(DATETIMEOFFSET, GETDATE()) AT TIME ZONE 'Central Standard Time'
SET @CST = CONVERT(DATETIME, @DTO)

UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 [DATETIME] = DATEADD(hh, -(DATEPART(HH, GETUTCDATE() - @CST)), [DATETIME])

UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 HOUR_INTERVAL = CAST(DATEPART(HH,[DATETIME]) AS INT)
 
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 [DATETIME] = CAST(CONVERT(VARCHAR(10), [DATETIME], 111) + ' ' + CONVERT(VARCHAR(2), HOUR_INTERVAL) + ':00:00.000' AS DATETIME)

UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 TOTAL_CALLS = Q_IN_CALLS_IN_AGT_COMPLETED_CT + NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
 
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS = CASE WHEN CAST(ISNULL(FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS,'0.00') AS DECIMAL(10,2)) > 900.00 THEN '0.00'
											ELSE FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS END
 
-- [DATETIME]	= CAST(CONVERT(VARCHAR(10), LEFT(FF_INTERVAL_START_TS,10), 111) + ' ' + CONVERT(VARCHAR(2), HOUR_INTERVAL) + ':00' AS DATETIME)

UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 STD_TENANT_START_DATE_TIME_KEY = DT.DATE_TIME_KEY
FROM		WSOL_TB_IMPORTS_HUMACH_INVOICING_1	I
INNER JOIN	DATE_TIME							DT   ON DT.CAL_DATE = I.[DATETIME]

--============================================================================
--REMOVE AFTER-HOURS RECORDS FOR i9 SPORTS
--HOURS OF OPERATION = M-F 8AM - 9PM CT
--============================================================================
INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_BAD
(BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
)
SELECT
 'OBH'					--BAD_IMPORTS_CODE		--'Outside Business Hours'
,'ACT'					--BAD_IMPORTS_FILE_TYPE --'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME   --WS_ROW_CREATED_TIME	--TEST:,dbo.getdate()  --,TNM.*
,W1.FF_AGENT_FIRST_NAME
,W1.FF_AGENT_LAST_NAME
,W1.FF_AGENT_ID
,W1.FF_CUSTOMER_NAME
,W1.FF_CUSTOMER_ID
,W1.FF_INTERVAL
,W1.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W1.FF_INTERVAL_START_TS
,W1.FF_AGENT_LOGIN_START_TS
,W1.FF_STATE_LOGGED_IN_SECS
,W1.FF_STATE_READY_SECS
,W1.FF_STATE_ASSIGNED_SECS
,W1.FF_STATE_BUSY_SECS
,W1.FF_STATE_NR_SECS
,W1.FF_STATE_NR_01_SECS
,W1.FF_STATE_NR_02_SECS
,W1.FF_STATE_NR_03_SECS
,W1.FF_STATE_NR_04_SECS
,W1.FF_STATE_NR_05_SECS
,W1.FF_STATE_NR_06_SECS
,W1.FF_STATE_NR_07_SECS
,W1.FF_STATE_DIAL_PENDING_SECS
,W1.FF_STATE_UNKNOWN_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.LOGGED_IN_SECS
,W1.READY_SECS
,W1.ASSIGNED_SECS
,W1.BUSY_SECS
,W1.NOT_READY_SECS
,W1.AGENT_UNRESPONSIVE_SECS
,W1.POST_LOGIN_SECS
,W1.BREAK_SECS
,W1.WRAP_SECS
,W1.NR_05_SECS
,W1.NR_06_SECS
,W1.NR_07_SECS
,W1.DIAL_PENDING_SECS
,W1.STATE_UNKNOWN_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.Q_IN_CALLS_IN_AGT_ANS_CT
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.TOTAL_CALLS
,W1.AUTHORIZED_WRAP
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.EMAIL
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
FROM		WSOL_TB_IMPORTS_HUMACH_INVOICING_1	W1
WHERE FF_CUSTOMER_ID = 190
  AND HOUR_INTERVAL IN (22,23,0,1,2,3,4,5,6,7)
--============================================================================
--DELETE AFTER-HOURS RECORDS FOR i9 SPORTS
--============================================================================
DELETE FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
WHERE FF_CUSTOMER_ID = 190
  AND HOUR_INTERVAL IN (22,23,0,1,2,3,4,5,6,7)
--============================================================================


--============================================================================
--REMOVE WEEKEND RECORDS FOR i9 SPORTS
--HOURS OF OPERATION = M-F 8AM - 9PM CT
--============================================================================
SET DATEFIRST 1

INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_BAD
(BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
)
SELECT
 'OBH'					--BAD_IMPORTS_CODE		--'Outside Business Hours'
,'ACT'					--BAD_IMPORTS_FILE_TYPE --'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME   --WS_ROW_CREATED_TIME	--TEST:,dbo.getdate()  --,TNM.*
,W1.FF_AGENT_FIRST_NAME
,W1.FF_AGENT_LAST_NAME
,W1.FF_AGENT_ID
,W1.FF_CUSTOMER_NAME
,W1.FF_CUSTOMER_ID
,W1.FF_INTERVAL
,W1.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W1.FF_INTERVAL_START_TS
,W1.FF_AGENT_LOGIN_START_TS
,W1.FF_STATE_LOGGED_IN_SECS
,W1.FF_STATE_READY_SECS
,W1.FF_STATE_ASSIGNED_SECS
,W1.FF_STATE_BUSY_SECS
,W1.FF_STATE_NR_SECS
,W1.FF_STATE_NR_01_SECS
,W1.FF_STATE_NR_02_SECS
,W1.FF_STATE_NR_03_SECS
,W1.FF_STATE_NR_04_SECS
,W1.FF_STATE_NR_05_SECS
,W1.FF_STATE_NR_06_SECS
,W1.FF_STATE_NR_07_SECS
,W1.FF_STATE_DIAL_PENDING_SECS
,W1.FF_STATE_UNKNOWN_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.LOGGED_IN_SECS
,W1.READY_SECS
,W1.ASSIGNED_SECS
,W1.BUSY_SECS
,W1.NOT_READY_SECS
,W1.AGENT_UNRESPONSIVE_SECS
,W1.POST_LOGIN_SECS
,W1.BREAK_SECS
,W1.WRAP_SECS
,W1.NR_05_SECS
,W1.NR_06_SECS
,W1.NR_07_SECS
,W1.DIAL_PENDING_SECS
,W1.STATE_UNKNOWN_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.Q_IN_CALLS_IN_AGT_ANS_CT
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.TOTAL_CALLS
,W1.AUTHORIZED_WRAP
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.EMAIL
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
FROM		WSOL_TB_IMPORTS_HUMACH_INVOICING_1	W1
WHERE FF_CUSTOMER_ID = 190
  AND DATEPART(WEEKDAY,[DATETIME]) IN (6,7) -- SATURDAY AND SUNDAY
--============================================================================
--DELETE WEEKEND RECORDS FOR i9 SPORTS
--============================================================================
DELETE FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
WHERE FF_CUSTOMER_ID = 190
  AND DATEPART(WEEKDAY,[DATETIME]) IN (6,7) -- SATURDAY AND SUNDAY
--============================================================================


--============================================================================
--HANDLE INVALID DATE/TIME RECORDS:
--============================================================================
INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_BAD
(BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
)
SELECT
 'DTM'					--BAD_IMPORTS_CODE		--'Invalid Date/Time'
,'ACT'					--BAD_IMPORTS_FILE_TYPE --'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME   --WS_ROW_CREATED_TIME	--TEST:,dbo.getdate()  --,TNM.*
,W1.FF_AGENT_FIRST_NAME
,W1.FF_AGENT_LAST_NAME
,W1.FF_AGENT_ID
,W1.FF_CUSTOMER_NAME
,W1.FF_CUSTOMER_ID
,W1.FF_INTERVAL
,W1.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W1.FF_INTERVAL_START_TS
,W1.FF_AGENT_LOGIN_START_TS
,W1.FF_STATE_LOGGED_IN_SECS
,W1.FF_STATE_READY_SECS
,W1.FF_STATE_ASSIGNED_SECS
,W1.FF_STATE_BUSY_SECS
,W1.FF_STATE_NR_SECS
,W1.FF_STATE_NR_01_SECS
,W1.FF_STATE_NR_02_SECS
,W1.FF_STATE_NR_03_SECS
,W1.FF_STATE_NR_04_SECS
,W1.FF_STATE_NR_05_SECS
,W1.FF_STATE_NR_06_SECS
,W1.FF_STATE_NR_07_SECS
,W1.FF_STATE_DIAL_PENDING_SECS
,W1.FF_STATE_UNKNOWN_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.LOGGED_IN_SECS
,W1.READY_SECS
,W1.ASSIGNED_SECS
,W1.BUSY_SECS
,W1.NOT_READY_SECS
,W1.AGENT_UNRESPONSIVE_SECS
,W1.POST_LOGIN_SECS
,W1.BREAK_SECS
,W1.WRAP_SECS
,W1.NR_05_SECS
,W1.NR_06_SECS
,W1.NR_07_SECS
,W1.DIAL_PENDING_SECS
,W1.STATE_UNKNOWN_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.Q_IN_CALLS_IN_AGT_ANS_CT
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.TOTAL_CALLS
,W1.AUTHORIZED_WRAP
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.EMAIL
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
FROM		WSOL_TB_IMPORTS_HUMACH_INVOICING_1	W1
WHERE ISNULL(W1.STD_TENANT_START_DATE_TIME_KEY,0) = 0
--============================================================================
--DELETE INVALID DATE/TIME RECORDS;
--============================================================================
DELETE FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
WHERE ISNULL(STD_TENANT_START_DATE_TIME_KEY,0) = 0
--============================================================================


--===========================================================================================================================================
--HANDLE DUPLICATES:
--===========================================================================================================================================
INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_BAD
(BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
)
SELECT
 'DUP'					--BAD_IMPORTS_CODE		--'DUPLICATE'
,'ACT'                  --BAD_IMPORTS_FILE_TYPE	--'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME   --WS_ROW_CREATED_TIME	--TEST:,dbo.getdate()  --,TNM.*
,W1.FF_AGENT_FIRST_NAME
,W1.FF_AGENT_LAST_NAME
,W1.FF_AGENT_ID
,W1.FF_CUSTOMER_NAME
,W1.FF_CUSTOMER_ID
,W1.FF_INTERVAL
,W1.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W1.FF_INTERVAL_START_TS
,W1.FF_AGENT_LOGIN_START_TS
,W1.FF_STATE_LOGGED_IN_SECS
,W1.FF_STATE_READY_SECS
,W1.FF_STATE_ASSIGNED_SECS
,W1.FF_STATE_BUSY_SECS
,W1.FF_STATE_NR_SECS
,W1.FF_STATE_NR_01_SECS
,W1.FF_STATE_NR_02_SECS
,W1.FF_STATE_NR_03_SECS
,W1.FF_STATE_NR_04_SECS
,W1.FF_STATE_NR_05_SECS
,W1.FF_STATE_NR_06_SECS
,W1.FF_STATE_NR_07_SECS
,W1.FF_STATE_DIAL_PENDING_SECS
,W1.FF_STATE_UNKNOWN_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.LOGGED_IN_SECS
,W1.READY_SECS
,W1.ASSIGNED_SECS
,W1.BUSY_SECS
,W1.NOT_READY_SECS
,W1.AGENT_UNRESPONSIVE_SECS
,W1.POST_LOGIN_SECS
,W1.BREAK_SECS
,W1.WRAP_SECS
,W1.NR_05_SECS
,W1.NR_06_SECS
,W1.NR_07_SECS
,W1.DIAL_PENDING_SECS
,W1.STATE_UNKNOWN_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W1.Q_IN_CALLS_IN_AGT_ANS_SECS
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W1.Q_IN_CALLS_IN_AGT_ANS_CT
,W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W1.TOTAL_CALLS
,W1.AUTHORIZED_WRAP
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.EMAIL
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
FROM
(	SELECT
	 FF_INTERVAL_START_TS
	,FF_AGENT_ID
	,RESOURCE_NAME
	,FF_CUSTOMER_ID
	,ROW_NUMBER() over (partition by FF_INTERVAL_START_TS, FF_AGENT_ID, RESOURCE_NAME, FF_CUSTOMER_ID
                            order by FF_INTERVAL_START_TS, FF_AGENT_ID, RESOURCE_NAME, FF_CUSTOMER_ID, LOGGED_IN_SECS DESC) ROWNO
	FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
) TNM
LEFT JOIN      WSOL_TB_IMPORTS_HUMACH_INVOICING_1	W1	ON W1.FF_INTERVAL_START_TS	= TNM.FF_INTERVAL_START_TS
													   AND W1.FF_AGENT_ID			= TNM.FF_AGENT_ID
													   AND W1.RESOURCE_NAME			= TNM.RESOURCE_NAME
													   AND W1.FF_CUSTOMER_ID		= TNM.FF_CUSTOMER_ID
WHERE TNM.ROWNO > 1

--===========================================================================================================================================
--DELETE DUPLICATES:
--===========================================================================================================================================
DELETE FROM TNM  
FROM
(	SELECT
	 FF_INTERVAL_START_TS
	,FF_AGENT_ID
	,RESOURCE_NAME
	,FF_CUSTOMER_ID
	,ROW_NUMBER() over (partition by FF_INTERVAL_START_TS, FF_AGENT_ID, RESOURCE_NAME, FF_CUSTOMER_ID
                            order by FF_INTERVAL_START_TS, FF_AGENT_ID, RESOURCE_NAME, FF_CUSTOMER_ID, LOGGED_IN_SECS DESC) ROWNO
	FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
) TNM
WHERE TNM.ROWNO > 1
--===========================================================================================================================================

--  SELECT * FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1 ORDER BY [DATETIME] DESC

--============================================================================================
--DETERMINE ID EXTENSION
--============================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 ID_EXT = CASE WHEN CHARINDEX('_', FF_AGENT_LAST_NAME) = 0 THEN ''
			   WHEN RIGHT(FF_AGENT_LAST_NAME, 3) NOT IN ('ACA','AMA','ARA','ASA','AOA','INS','INR','INB') THEN ''
			   ELSE RIGHT(FF_AGENT_LAST_NAME, 3) END

--===========================================================================================================================================
--SET ANY HOLIDAY FLAGS
--===========================================================================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 AIR_DAY_TYPE = CASE WHEN IG.HAS_HOLIDAYS = 'Y' AND
						 (    ISNULL(IH.HOLIDAY_DATE,'1/1/1900') > CAST('1/1/1901' AS DATETIME) OR
						   ( ISNULL(IHA.HOLIDAY_DATE,'1/1/1900') > CAST('1/1/1901' AS DATETIME) AND ISNULL(IHA.ID_EXT,'') <> '' )
						 )
					  THEN 'H' ELSE 'S' END  --AS AIR_DAY_TYPE  --H=Holiday  --S=Standard
FROM            WSOL_TB_IMPORTS_HUMACH_INVOICING_1               I
INNER JOIN      DATE_TIME										 DT   ON DT.DATE_TIME_KEY       = I.STD_TENANT_START_DATE_TIME_KEY
LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_SD_INVOICE_GROUPS         IG   ON IG.ID_EXT              = I.ID_EXT
LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_SD_INVOICE_HOLIDAYS       IH   ON IH.HOLIDAY_DATE        = CAST(DT.CAL_DATE_STRING AS DATETIME)
LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_SD_INVOICE_HOLIDAYS_ADDL  IHA  ON IHA.HOLIDAY_DATE       = CAST(DT.CAL_DATE_STRING AS DATETIME)
																	 AND IHA.ID_EXT             = I.ID_EXT
																	 
--===========================================================================================================================================
--SET INVOICING FIELDS
--===========================================================================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 TENANT_KEY						= ISNULL(IG.TENANT_KEY,'')
,SCHEDULER_ACL_NAME				= ISNULL(IG.SCHEDULER_ACL_NAME,'')
,AIR_ACW_FONT_COLOR             = 'Black'

,MIN_GUARANTEE_MINUTES          = ISNULL(IG.MIN_GUARANTEE_MINUTES,0)        --varies between scheduler acl names.
,MIN_GUARANTEE_TYPE             = ISNULL(IG.MIN_GUARANTEE_TYPE,'')          --varies between scheduler acl names.
,AUTHORIZED_TO_INVOICE_TYPE     = ISNULL(IG.AUTHORIZED_TO_INVOICE_TYPE,'')  --varies between scheduler acl names.

,HAS_HOLIDAYS    = IG.HAS_HOLIDAYS
,INCLUDE_IN_CAS  = IG.INCLUDE_IN_CAS
,READY_FOR_XML   = IG.READY_FOR_XML
,SHOW_ID_EXTS    = IG.SHOW_ID_EXTS

FROM            WSOL_TB_IMPORTS_HUMACH_INVOICING_1        I
LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_SD_INVOICE_GROUPS  IG  ON IG.ID_EXT    = I.ID_EXT

--=====================================================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_1 SET
 INVOICE_ID  = CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END
--,TENANT_NAME = AIASD.OFFICIAL_ACD_CLIENT_NAME 
FROM          WSOL_TB_IMPORTS_HUMACH_INVOICING_1				AIA 
LEFT JOIN     WSOL_TB_IMPORTS_HUMACH_SD_AIA_STATIC_DEFAULTS		AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT


--========================================================================
-- CHECK FOR BAD DATA FOUND IN IMPORT FILES:
--========================================================================
-- SELECT * FROM WSOL_TB_IMPORT_ERRORS_FOUND WHERE TENANT_KEY = 900901
--========================================================================
DECLARE
 @ERR_CNT  INT
,@RCD_CNT  INT
,@MSG1     VARCHAR(2500)
SET @ERR_CNT  = 0 
SET @RCD_CNT  = 0 
SET @MSG1     = ''

--Check #1:  =======================================================================================================================================================
	SET @RCD_CNT = (	SELECT COUNT(*) FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1 )
	IF @RCD_CNT < 1 BEGIN
		SET @MSG1 = @MSG1 + 'IMPORT ERROR! - File Import Failed.  No Records Were/Could Be Imported.   |   ' 
		SET @ERR_CNT = @ERR_CNT + 1
	END
--Check #2:  =======================================================================================================================================================
--	SET @RCD_CNT  = (	SELECT COUNT(*) FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1  
--						WHERE ISNULL(STD_TENANT_START_DATE_TIME_KEY,0) = 0
--					)  
--	IF @RCD_CNT > 0 BEGIN
--		SET @MSG1 = @MSG1 + 'IMPORT ERROR! - Invalid DATETIME Intervals in HUMACH INVOICING IMPORT File.  Import was Cancelled.  Nothing was Imported.   |   ' 
--		SET @ERR_CNT = @ERR_CNT + 1
--	END
--Check #n:  =======================================================================================================================================================
--	SET @MSG1 = @MSG1 + '2) Something not right with something.  Import was cancelled.  Nothing was Imported.     '
--	--SET @RCD_CNT = (	SELECT COUNT(*)
--	--					FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_1
--	--					WHERE 'something' <> 'somethingelse'
--	--				  )  --If nothing imported in work table, don't need to return error.  That check is done in SSIS currently.


--=============================== INSERT INTO PERMANENT TABLE (No Errors) OR SKIP AND GO TO END (Errors): ==========================================================
IF @ERR_CNT > 0 BEGIN
	--SSIS reads WSOL_TB_IMPORT_ERRORS_FOUND table where TENANT_KEY = 900901, and if record exists, outputs results/error_msg field in an email.
	INSERT INTO WSOL_TB_IMPORT_ERRORS_FOUND(
	TENANT_KEY
,SUB_GROUP_NAME
,ERROR_MSG)
	SELECT 
	 @TENANT_KEY		--TENANT_KEY
	,'HUMACH_INVOICING'	--SUB_GROUP_NAME
	,@MSG1				--ERROR_MSG
	--===========================
	GOTO EARLY_EXIT
	--===========================
END
ELSE BEGIN
	INSERT INTO WSOL_TB_IMPORT_ERRORS_FOUND
	(TENANT_KEY
,SUB_GROUP_NAME
,ERROR_MSG)
	SELECT 
	 @TENANT_KEY		--TENANT_KEY
	,'HUMACH_INVOICING'	--SUB_GROUP_NAME
	,''					--ERROR_MSG  --NEVER SET THIS TO @MSG1 !!!  MUST BE ''.
END


--=======================================================================================
-- GROUP DATA BY HOUR INTERVALS
--=======================================================================================
DELETE FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_2

INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING_2
(FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME
)
SELECT
 MAX(W1.FF_AGENT_FIRST_NAME)
,MAX(W1.FF_AGENT_LAST_NAME)
,W1.FF_AGENT_ID
,MAX(W1.FF_CUSTOMER_NAME)
,W1.FF_CUSTOMER_ID

,''						-- W1.FF_INTERVAL
,''						-- W1.FF_AGENT_PERFORMANCE_INTERVAL_ID

,MIN(CAST(REPLACE(REPLACE(W1.FF_INTERVAL_START_TS	,'T',' '),'Z','') AS DATETIME))
,MIN(CAST(REPLACE(REPLACE(W1.FF_AGENT_LOGIN_START_TS,'T',' '),'Z','') AS DATETIME))

,SUM(CAST(ISNULL(W1.FF_STATE_LOGGED_IN_SECS								,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_READY_SECS									,0)	AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_ASSIGNED_SECS								,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_BUSY_SECS									,0)	AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_SECS									,0)	AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_01_SECS									,0)	AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_02_SECS									,0)	AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_03_SECS									,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_04_SECS									,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_05_SECS									,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_06_SECS									,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_NR_07_SECS									,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_DIAL_PENDING_SECS							,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_STATE_UNKNOWN_SECS								,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS			,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ANS_SECS						,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))

,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT					,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT				,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_ANS_CT							,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT						,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT					,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT					,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT				,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT					,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT					,0) AS INT))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT				,0) AS INT))

,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS			,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS						,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS			,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS				,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_ANS_SECS						,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS					,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS		,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS			,0) AS DECIMAL(10,2)))
,SUM(CAST(ISNULL(W1.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	,0) AS DECIMAL(10,2)))

,MAX(W1.SEQNO_ADDED_TIME)
,MAX(W1.SEQNO)
,MAX(W1.FTP_FILE_NAME)

,MAX(W1.[DATETIME])
,MAX(W1.HOUR_INTERVAL)
,MAX(W1.RESOURCE_NAME)

,SUM(W1.LOGGED_IN_SECS)
,SUM(W1.READY_SECS)
,SUM(W1.ASSIGNED_SECS)
,SUM(W1.BUSY_SECS)
,SUM(W1.NOT_READY_SECS)
,SUM(W1.AGENT_UNRESPONSIVE_SECS)
,SUM(W1.POST_LOGIN_SECS)
,SUM(W1.BREAK_SECS)
,SUM(W1.WRAP_SECS)
,SUM(W1.NR_05_SECS)
,SUM(W1.NR_06_SECS)
,SUM(W1.NR_07_SECS)
,SUM(W1.DIAL_PENDING_SECS)
,SUM(W1.STATE_UNKNOWN_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_ANS_SECS)
,SUM(W1.Q_IN_CALLS_AGT_CALLS_TRANS_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS)
,SUM(W1.Q_IN_CALLS_AGT_CALLS_HOLD_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS)
,SUM(W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS)
,SUM(W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS)
,SUM(W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS)
,SUM(W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS)

,SUM(W1.Q_IN_CALLS_IN_AGT_ASSIGNED_CT)
,SUM(W1.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT)
,SUM(W1.Q_IN_CALLS_IN_AGT_ANS_CT)
,SUM(W1.Q_IN_CALLS_AGT_CALLS_HOLD_CT)
,SUM(W1.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT)
,SUM(W1.Q_IN_CALLS_AGT_CALLS_TRANS_CT)
,SUM(W1.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT)
,SUM(W1.Q_IN_CALLS_IN_AGT_COMPLETED_CT)
,SUM(W1.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT)
,SUM(W1.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT)

,SUM(W1.TOTAL_CALLS)

,NULL	--AUTHORIZED_WRAP
,NULL	--CPROD
,NULL	--MINIMUM_GUARANTEE
,NULL	--AUTHORIZED_MINUTES
,NULL	--EMAIL

,ISNULL(W1.ID_EXT,'')
,MAX(ISNULL(W1.SCHEDULER_ACL_NAME,''))
,W1.STD_TENANT_START_DATE_TIME_KEY
,MAX(W1.CAL_DATE)
,MAX(W1.TENANT_KEY)
,MAX(ISNULL(W1.AIR_DAY_TYPE,''))
,MAX(ISNULL(W1.AIR_ACW_FONT_COLOR,''))
,MAX(ISNULL(W1.MIN_GUARANTEE_MINUTES,0.00))
,MAX(ISNULL(W1.MIN_GUARANTEE_TYPE,''))
,MAX(ISNULL(W1.AUTHORIZED_TO_INVOICE_TYPE,''))
,MAX(ISNULL(W1.HAS_HOLIDAYS,''))
,MAX(ISNULL(W1.INCLUDE_IN_CAS,''))
,MAX(ISNULL(W1.READY_FOR_XML,''))
,MAX(ISNULL(W1.SHOW_ID_EXTS,''))
,ISNULL(W1.INVOICE_ID,'')

,@WS_ROW_CREATED_TIME    --[WS_ROW_CREATED_TIME] [datetime] NOT NULL,
,NULL                    --[WS_ROW_UPDATED_TIME] [datetime] NULL,

FROM		WSOL_TB_IMPORTS_HUMACH_INVOICING_1  W1

LEFT JOIN	WSOL_TB_IMPORTS_HUMACH_INVOICING_2  G	ON G.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
												   AND G.FF_AGENT_ID					= W1.FF_AGENT_ID
												   AND G.FF_CUSTOMER_ID					= W1.FF_CUSTOMER_ID
												   AND G.ID_EXT							= W1.ID_EXT
												   AND G.INVOICE_ID						= W1.INVOICE_ID

WHERE (G.FF_AGENT_ID					IS NULL AND ISNULL(W1.FF_AGENT_ID,'') <> '' )
  AND (G.STD_TENANT_START_DATE_TIME_KEY	IS NULL AND ISNULL(W1.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND (G.FF_CUSTOMER_ID					IS NULL AND ISNULL(W1.FF_CUSTOMER_ID,'') <> '' )
--  AND (G.ID_EXT							IS NULL AND ISNULL(W1.ID_EXT,'') <> '' )
--  AND (G.INVOICE_ID						IS NULL AND ISNULL(W1.INVOICE_ID,'') <> '' )

GROUP BY
 W1.FF_AGENT_ID
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.FF_CUSTOMER_ID
,W1.ID_EXT
,W1.INVOICE_ID

ORDER BY
 W1.FF_CUSTOMER_ID
,W1.FF_AGENT_ID
,W1.STD_TENANT_START_DATE_TIME_KEY


--====================================================================================================
-- POPULATE ADDITIONAL INVOICE FIELDS
--====================================================================================================
---->> AUTHORIZED WRAP (i9 SPORTS)
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_2 SET
 AUTHORIZED_WRAP = CASE WHEN FF_CUSTOMER_ID = 190 THEN	-- 190 = i9 SPORTS
							 CASE WHEN (TOTAL_CALLS * 120.00) > WRAP_SECS THEN
									WRAP_SECS
								  ELSE
									TOTAL_CALLS * 120.00 END	-- TWO MINUTES OF WRAP ALLOWED PER CALL
						ELSE WRAP_SECS END	-- ALL OTHER PROGRAMS
 
---->> CPROD
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_2 SET
 CPROD = CASE WHEN MIN_GUARANTEE_TYPE = 'RB'  THEN
				   READY_SECS + ASSIGNED_SECS + BUSY_SECS
			  WHEN MIN_GUARANTEE_TYPE = 'RBW' THEN
				   READY_SECS + ASSIGNED_SECS + BUSY_SECS + AUTHORIZED_WRAP		-- CHANGED FROM WRAP_SECS TO AUTHORIZED_WRAP ON 12/16/2016
			  ELSE 0.00 END
			  
---->> MINIMUM GUARANTEE  
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_2 SET
 MINIMUM_GUARANTEE = CPROD * (MIN_GUARANTEE_MINUTES / 60.00)

---->> AUTHORIZED MINUTES
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_2 SET
 AUTHORIZED_MINUTES = CASE WHEN AUTHORIZED_TO_INVOICE_TYPE = 'B' THEN
							CASE WHEN MINIMUM_GUARANTEE > (ASSIGNED_SECS + BUSY_SECS) THEN
									MINIMUM_GUARANTEE
								 ELSE (ASSIGNED_SECS + BUSY_SECS) END
						   ELSE 0.00 END


--====================================================================================================
-- SET INVOICE FIELDS TO ZERO FOR WSOL ASAs
--====================================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING_2 SET
 AUTHORIZED_MINUTES = 0.00
WHERE RESOURCE_NAME = 'Joann Lopez_AOA'


-- SELECT * FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_2
--=========================================================================================================================================
-- INSERT DATA INTO PERMANENT TABLE (UPDATE)
--=========================================================================================================================================
UPDATE WSOL_TB_IMPORTS_HUMACH_INVOICING SET
 FF_AGENT_FIRST_NAME									= W2.FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME										= W2.FF_AGENT_LAST_NAME
--,FF_AGENT_ID											= W2.FF_AGENT_ID
,FF_CUSTOMER_NAME										= W2.FF_CUSTOMER_NAME
--,FF_CUSTOMER_ID										= W2.FF_CUSTOMER_ID
,FF_INTERVAL											= W2.FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID						= W2.FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS									= W2.FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS								= W2.FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS								= W2.FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS									= W2.FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS									= W2.FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS										= W2.FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS										= W2.FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS									= W2.FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS									= W2.FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS									= W2.FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS									= W2.FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS									= W2.FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS									= W2.FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS									= W2.FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS								= W2.FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS									= W2.FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS						= W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS				= W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS							= W2.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS						= W2.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS			= W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS			= W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS						= W2.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS		= W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS					= W2.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS			= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS			= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT						= W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT				= W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT							= W2.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT						= W2.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT						= W2.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT						= W2.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT					= W2.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT						= W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT						= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT					= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS					= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS			= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS			= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS					= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS				= W2.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS					= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS					= W2.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS		= W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS						= W2.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS					= W2.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS	= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS					= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS					= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS			= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS			= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS					= W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS				= W2.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS					= W2.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS			= W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS			= W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS					= W2.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	= W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS				= W2.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS							= W2.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS				= W2.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS						= W2.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS					= W2.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS					= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS					= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS					= W2.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS			= W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS							= W2.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS						= W2.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS			= W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS				= W2.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS	= W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME										= W2.SEQNO_ADDED_TIME
,SEQNO													= W2.SEQNO
,FTP_FILE_NAME											= W2.FTP_FILE_NAME
,[DATETIME]												= W2.[DATETIME]
,HOUR_INTERVAL											= W2.HOUR_INTERVAL
,RESOURCE_NAME											= W2.RESOURCE_NAME
,LOGGED_IN_SECS											= W2.LOGGED_IN_SECS
,READY_SECS												= W2.READY_SECS
,ASSIGNED_SECS											= W2.ASSIGNED_SECS
,BUSY_SECS												= W2.BUSY_SECS
,NOT_READY_SECS											= W2.NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS								= W2.AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS										= W2.POST_LOGIN_SECS
,BREAK_SECS												= W2.BREAK_SECS
,WRAP_SECS												= W2.WRAP_SECS
,NR_05_SECS												= W2.NR_05_SECS
,NR_06_SECS												= W2.NR_06_SECS
,NR_07_SECS												= W2.NR_07_SECS
,DIAL_PENDING_SECS										= W2.DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS										= W2.STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS						= W2.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS					= W2.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS								= W2.Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS						= W2.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS				= W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS				= W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS							= W2.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS		= W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS					= W2.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS			= W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS			= W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS		= W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT							= W2.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT					= W2.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT								= W2.Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT							= W2.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT						= W2.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT							= W2.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT						= W2.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT							= W2.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT						= W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT					= W2.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS											= W2.TOTAL_CALLS
,AUTHORIZED_WRAP										= W2.AUTHORIZED_WRAP
,CPROD													= W2.CPROD
,MINIMUM_GUARANTEE										= W2.MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES										= W2.AUTHORIZED_MINUTES
,[EMAIL]												= W2.[EMAIL]
,ID_EXT													= W2.ID_EXT
,SCHEDULER_ACL_NAME										= W2.SCHEDULER_ACL_NAME
--,STD_TENANT_START_DATE_TIME_KEY						= W2.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE												= W2.CAL_DATE
,TENANT_KEY												= W2.TENANT_KEY
,AIR_DAY_TYPE											= W2.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR										= W2.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES									= W2.MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE										= W2.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE								= W2.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS											= W2.HAS_HOLIDAYS
,INCLUDE_IN_CAS											= W2.INCLUDE_IN_CAS
,READY_FOR_XML											= W2.READY_FOR_XML
,SHOW_ID_EXTS											= W2.SHOW_ID_EXTS
--,INVOICE_ID											= W2.INVOICE_ID
--,WS_ROW_CREATED_TIME									= W2.WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME									= W2.WS_ROW_CREATED_TIME

--  SELECT *
FROM            WSOL_TB_IMPORTS_HUMACH_INVOICING_2  W2
----INNER JOIN SHOULD TAKE CARE OF MOST OF THE WORRY IN THE WHERE CLAUSE...
INNER JOIN      WSOL_TB_IMPORTS_HUMACH_INVOICING	G	ON G.STD_TENANT_START_DATE_TIME_KEY = W2.STD_TENANT_START_DATE_TIME_KEY
													   AND G.FF_AGENT_ID					= W2.FF_AGENT_ID
													   AND G.FF_CUSTOMER_ID					= W2.FF_CUSTOMER_ID
													   AND G.INVOICE_ID						= W2.INVOICE_ID
----Where Permanent table key fields match Work table key fields - then we want to update non-key fields!!!:
WHERE G.STD_TENANT_START_DATE_TIME_KEY	= W2.STD_TENANT_START_DATE_TIME_KEY
  AND G.FF_AGENT_ID						= W2.FF_AGENT_ID
  AND G.FF_CUSTOMER_ID					= W2.FF_CUSTOMER_ID
  AND G.INVOICE_ID						= W2.INVOICE_ID


--=========================================================================================================================================
-- INSERT DATA INTO PERMANENT TABLE (NEW) 
--=========================================================================================================================================
INSERT INTO WSOL_TB_IMPORTS_HUMACH_INVOICING
(FF_AGENT_FIRST_NAME
,FF_AGENT_LAST_NAME
,FF_AGENT_ID
,FF_CUSTOMER_NAME
,FF_CUSTOMER_ID
,FF_INTERVAL
,FF_AGENT_PERFORMANCE_INTERVAL_ID
,FF_INTERVAL_START_TS
,FF_AGENT_LOGIN_START_TS
,FF_STATE_LOGGED_IN_SECS
,FF_STATE_READY_SECS
,FF_STATE_ASSIGNED_SECS
,FF_STATE_BUSY_SECS
,FF_STATE_NR_SECS
,FF_STATE_NR_01_SECS
,FF_STATE_NR_02_SECS
,FF_STATE_NR_03_SECS
,FF_STATE_NR_04_SECS
,FF_STATE_NR_05_SECS
,FF_STATE_NR_06_SECS
,FF_STATE_NR_07_SECS
,FF_STATE_DIAL_PENDING_SECS
,FF_STATE_UNKNOWN_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,FF_Q_IN_CALLS_IN_AGT_ANS_CT
,FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,LOGGED_IN_SECS
,READY_SECS
,ASSIGNED_SECS
,BUSY_SECS
,NOT_READY_SECS
,AGENT_UNRESPONSIVE_SECS
,POST_LOGIN_SECS
,BREAK_SECS
,WRAP_SECS
,NR_05_SECS
,NR_06_SECS
,NR_07_SECS
,DIAL_PENDING_SECS
,STATE_UNKNOWN_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,Q_IN_CALLS_IN_AGT_ANS_SECS
,Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,Q_IN_CALLS_IN_AGT_ANS_CT
,Q_IN_CALLS_AGT_CALLS_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,Q_IN_CALLS_AGT_CALLS_TRANS_CT
,Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,Q_IN_CALLS_IN_AGT_COMPLETED_CT
,NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,TOTAL_CALLS
,AUTHORIZED_WRAP
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,EMAIL
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME)
SELECT
 W2.FF_AGENT_FIRST_NAME
,W2.FF_AGENT_LAST_NAME
,W2.FF_AGENT_ID
,W2.FF_CUSTOMER_NAME
,W2.FF_CUSTOMER_ID
,W2.FF_INTERVAL
,W2.FF_AGENT_PERFORMANCE_INTERVAL_ID
,W2.FF_INTERVAL_START_TS
,W2.FF_AGENT_LOGIN_START_TS
,W2.FF_STATE_LOGGED_IN_SECS
,W2.FF_STATE_READY_SECS
,W2.FF_STATE_ASSIGNED_SECS
,W2.FF_STATE_BUSY_SECS
,W2.FF_STATE_NR_SECS
,W2.FF_STATE_NR_01_SECS
,W2.FF_STATE_NR_02_SECS
,W2.FF_STATE_NR_03_SECS
,W2.FF_STATE_NR_04_SECS
,W2.FF_STATE_NR_05_SECS
,W2.FF_STATE_NR_06_SECS
,W2.FF_STATE_NR_07_SECS
,W2.FF_STATE_DIAL_PENDING_SECS
,W2.FF_STATE_UNKNOWN_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_ANS_SECS
,W2.FF_Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W2.FF_Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W2.FF_Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W2.FF_Q_IN_CALLS_IN_AGT_ANS_CT
,W2.FF_Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W2.FF_Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W2.FF_Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W2.FF_Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W2.FF_Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_OTHER_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_RNA_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_BUSY_SECS
,W2.FF_Q_IN_CALLS_OUT_DIALED_DELAY_SECS
,W2.FF_Q_IN_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W2.FF_Q_OUT_CALLS_AGT_CALLS_HOLD_SECS
,W2.FF_Q_OUT_CALLS_AGT_CALLS_TRANS_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_BUSY_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_RNA_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALL_OTHER_SECS
,W2.FF_Q_OUT_CALLS_OUT_AGT_CALLS_HANDLE_SECS
,W2.FF_Q_OUT_CALLS_OUT_DIALED_DELAY_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_ANS_SECS
,W2.FF_Q_OUT_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W2.FF_NON_Q_CALLS_AGT_CALLS_HOLD_SECS
,W2.FF_NON_Q_CALLS_AGT_CALLS_TRANS_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_BUSY_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_OTHER_SECS
,W2.FF_NON_Q_CALLS_OUT_AGT_CALL_RNA_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_ANS_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_ATTEMPT_FAILED_SECS
,W2.FF_NON_Q_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W2.SEQNO_ADDED_TIME
,W2.SEQNO
,W2.FTP_FILE_NAME
,W2.[DATETIME]
,W2.HOUR_INTERVAL
,W2.RESOURCE_NAME
,W2.LOGGED_IN_SECS
,W2.READY_SECS
,W2.ASSIGNED_SECS
,W2.BUSY_SECS
,W2.NOT_READY_SECS
,W2.AGENT_UNRESPONSIVE_SECS
,W2.POST_LOGIN_SECS
,W2.BREAK_SECS
,W2.WRAP_SECS
,W2.NR_05_SECS
,W2.NR_06_SECS
,W2.NR_07_SECS
,W2.DIAL_PENDING_SECS
,W2.STATE_UNKNOWN_SECS
,W2.Q_IN_CALLS_IN_AGT_ASSIGNED_SECS
,W2.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_SECS
,W2.Q_IN_CALLS_IN_AGT_ANS_SECS
,W2.Q_IN_CALLS_AGT_CALLS_TRANS_SECS
,W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TALK_SECS
,W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_TIME_SECS
,W2.Q_IN_CALLS_AGT_CALLS_HOLD_SECS
,W2.Q_IN_CALLS_IN_AGT_COMPLETED_CALL_CONNECTED_SECS
,W2.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_SECS
,W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TALK_SECS
,W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_TIME_SECS
,W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CALL_CONNECTED_SECS
,W2.Q_IN_CALLS_IN_AGT_ASSIGNED_CT
,W2.Q_IN_CALLS_IN_AGT_ASSIGNED_FAILED_CT
,W2.Q_IN_CALLS_IN_AGT_ANS_CT
,W2.Q_IN_CALLS_AGT_CALLS_HOLD_CT
,W2.Q_IN_CALLS_AGT_CALLS_ON_HOLD_CT
,W2.Q_IN_CALLS_AGT_CALLS_TRANS_CT
,W2.Q_IN_CALLS_IN_AGT_CALLS_HANDLE_CT
,W2.Q_IN_CALLS_IN_AGT_COMPLETED_CT
,W2.NON_Q_CALLS_OUT_AGT_CALL_ANS_CT
,W2.NON_Q_CALLS_OUT_AGT_CALL_ATTEMPT_CT
,W2.TOTAL_CALLS
,W2.AUTHORIZED_WRAP
,W2.CPROD
,W2.MINIMUM_GUARANTEE
,W2.AUTHORIZED_MINUTES
,W2.[EMAIL]
,W2.ID_EXT
,W2.SCHEDULER_ACL_NAME
,W2.STD_TENANT_START_DATE_TIME_KEY
,W2.CAL_DATE
,W2.TENANT_KEY
,W2.AIR_DAY_TYPE
,W2.AIR_ACW_FONT_COLOR
,W2.MIN_GUARANTEE_MINUTES
,W2.MIN_GUARANTEE_TYPE
,W2.AUTHORIZED_TO_INVOICE_TYPE
,W2.HAS_HOLIDAYS
,W2.INCLUDE_IN_CAS
,W2.READY_FOR_XML
,W2.SHOW_ID_EXTS
,W2.INVOICE_ID
,@WS_ROW_CREATED_TIME    --[WS_ROW_CREATED_TIME] [datetime] NOT NULL,
,NULL                    --[WS_ROW_UPDATED_TIME] [datetime] NULL,

FROM            WSOL_TB_IMPORTS_HUMACH_INVOICING_2	W2

LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_INVOICING	G   ON G.STD_TENANT_START_DATE_TIME_KEY = W2.STD_TENANT_START_DATE_TIME_KEY
													   AND G.FF_AGENT_ID					= W2.FF_AGENT_ID
													   AND G.FF_CUSTOMER_ID					= W2.FF_CUSTOMER_ID
													   AND G.INVOICE_ID						= W2.INVOICE_ID

WHERE (G.FF_AGENT_ID						IS NULL AND ISNULL(W2.FF_AGENT_ID,'') <> '' )
  AND (G.STD_TENANT_START_DATE_TIME_KEY		IS NULL AND ISNULL(W2.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND (G.FF_CUSTOMER_ID						IS NULL AND ISNULL(W2.FF_CUSTOMER_ID,'') <> '' )
--  AND (G.INVOICE_ID							IS NULL AND ISNULL(W2.INVOICE_ID,'') <> '' )


--======================================================================================================================================
SET DATEFIRST 1  -- = Monday  --SELECT DATEPART(DW,dbo.getdate())  --SELECT @@DATEFIRST AS '1st Day', DATEPART(dw, dbo.getdate()) AS 'Today'
--======================================================================================================================================

--======================================================================
--Need when populating tmp DEW table for insert into _AIA table.
DECLARE 
 @DTM_BEG  DATETIME
,@DTM_END  DATETIME

SET @DTM_BEG = DATEADD(hh,-2,(SELECT MIN([DATETIME]) FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_2))
SET @DTM_END = DATEADD(hh, 2,(SELECT MAX([DATETIME]) FROM WSOL_TB_IMPORTS_HUMACH_INVOICING_2))  
--======================================================================

--============================================================
IF OBJECT_ID('TEMPDB..#DT_EASY_WEEKS') IS NOT NULL BEGIN
   DROP TABLE #DT_EASY_WEEKS
END
CREATE TABLE #DT_EASY_WEEKS
(CAL_DATE_STRING      VARCHAR(10)
,CAL_WEEK_START_DATE  DATETIME
,CAL_WEEK_END_DATE    DATETIME
,PAY_CYCLE_CLOSURE_DATE DATETIME
)
INSERT INTO #DT_EASY_WEEKS
SELECT
 DT.CAL_DATE_STRING
,CASE WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 1 THEN CAST(DT.CAL_DATE_STRING AS DATETIME)
	  WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 7 THEN DATEADD(DD,-6,CAST(DT.CAL_DATE_STRING AS DATETIME))
	  ELSE DATEADD(DD,1,DT.CAL_WEEK_START_DATE) END
,DT.CAL_DATE_STRING
,DT.CAL_DATE_STRING  --PAY_CYCLE_CLOSURE_DATE
FROM DATE_TIME DT
WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
--WHERE DT.CAL_DATE >= CAST('06/01/2011' AS DATETIME) AND DT.CAL_DATE <  CAST('06/20/2011' AS DATETIME)
GROUP BY 
 DT.CAL_DATE_STRING
,CASE WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 1 THEN CAST(DT.CAL_DATE_STRING AS DATETIME)
	  WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 7 THEN DATEADD(DD,-6,CAST(DT.CAL_DATE_STRING AS DATETIME))
	  ELSE DATEADD(DD,1,DT.CAL_WEEK_START_DATE) END
,DT.CAL_DATE_STRING
,DT.CAL_DATE_STRING  --PAY_CYCLE_CLOSURE_DATE
--===========================
UPDATE #DT_EASY_WEEKS SET CAL_WEEK_END_DATE = DATEADD(DD,6,CAL_WEEK_START_DATE)
--110713: WAS: 06/26/2011
UPDATE #DT_EASY_WEEKS SET
 PAY_CYCLE_CLOSURE_DATE = (CASE WHEN (DATEDIFF(DD,CAST('09/29/2013' AS DATETIME),CAL_WEEK_END_DATE) % 14) = 0 THEN
									CAL_WEEK_END_DATE
								ELSE
									DATEADD(DD,7,CAL_WEEK_END_DATE)
								END)
--SELECT * FROM #DT_EASY_WEEKS ORDER BY CAL_DATE_STRING


--=================================================================================
--CREATE TMP TABLE: Currently same structure as:  [YZ_TB_AGENT_INVOICE_AUTOMATION]
--=================================================================================
IF OBJECT_ID('TEMPDB..#WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA') IS NOT NULL BEGIN
   DROP TABLE #WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA
END
CREATE TABLE #WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA
(	[PLATFORM] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_MAP_KEY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[FIELD_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_PROJECT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_ACL_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ACD_ID_EXTENSION] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[OFFICIAL_WSOL_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_WSOL_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[PRIMARY_PROJECT_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DIRECTOR_OF_PROJECT_MANAGEMENT_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_TECHNOLOGY_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CONTRACTOR_SUPPORT_PATHWAY] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_SYSTEM_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY_INVOICE_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[FILE_FORMAT_OF_PUSH] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_PREPARATION_INVOICE_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NEW_ACL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CURRENT_CATS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_ELIGIBLE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_2] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_3] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOD_INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AU_DK_LOGGED_IN_DURATION] [decimal](10, 2) NULL,
	[AU_DK_AVAILABLE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_IB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_OB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_CONVENTIONAL_ACW] [decimal](10, 2) NULL,
	[AU_DK_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_PSEUDO_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_ADJUSTED_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TOTAL_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS] [decimal](10, 2) NULL,
	[AU_DK_XFER_COUNT] [int] NULL,
	[AU_DK_HOLD_COUNT] [int] NULL,
	[AU_DK_CONFERENCE_COUNT] [int] NULL,
	[AU_DK_CONSULT_COUNT] [int] NULL,
	[AU_DK_PUP_COUNT] [int] NULL,
	[AU_DK_OFFERED_COUNT] [int] NULL,
	[AU_DK_HANDLED_COUNT] [int] NULL,
	[AU_DK_IB_HANDLE_COUNT] [int] NULL,
	[AU_DK_OB_HANDLE_COUNT] [int] NULL,
	[AU_DK_RONA_COUNT] [int] NULL,
	[AU_DK_AWR_COUNT] [int] NULL,
	[MINIMUM_GUARANTEE] [decimal](10, 2) NULL,
	[AUTHORIZED_TO_INVOICE] [decimal](10, 2) NULL,
	[WEEK_ENDING_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PAY_CYCLE_CLOSURE_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

	[FTP_FILE_NAME] [varchar](100) NOT NULL,
	[EMAIL] [varchar](100)  NULL,
	[STD_TENANT_START_DATE_TIME_KEY] [int] NOT NULL,
	[CAL_DATE] [datetime] NULL,
	[TENANT_KEY] [int] NOT NULL,
	[AIR_DAY_TYPE] [varchar](1) NOT NULL,
	[AIR_ACW_FONT_COLOR] [varchar](50) NULL,
	[MIN_GUARANTEE_RATE] [decimal](6, 3) NULL,
	[MIN_GUARANTEE_TYPE] [varchar](50) NULL,
	[AUTHORIZED_TO_INVOICE_TYPE] [varchar](50) NULL,
	[HAS_HOLIDAYS] [varchar](1) NULL,
	[INCLUDE_IN_CAS] [varchar](1) NULL,
	[READY_FOR_XML] [varchar](1) NULL,
	[SHOW_ID_EXTS] [varchar](1) NULL,
	[INVOICE_ID] [varchar](50) NULL,
	[RESOURCE_NAME] [varchar](100) NULL,
	[AIRITKDUR] [decimal](10, 2) NULL,
	[AIRIACDUR] [decimal](10, 2) NULL,
	[PAY_GROUP] [int] NULL,
	[WS_ROW_CREATED_TIME] [datetime] NULL,
	[WS_ROW_UPDATED_TIME] [datetime] NULL

)
INSERT INTO #WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA
SELECT 
 AIASD.[PLATFORM]
,AIASD.[STATUS]    
,CASE WHEN CHARINDEX('_',AIA.FF_AGENT_LAST_NAME) > 0 THEN
		LOWER(LEFT(AIA.FF_AGENT_FIRST_NAME,1)) + LOWER(LEFT(AIA.FF_AGENT_LAST_NAME,CHARINDEX('_',AIA.FF_AGENT_LAST_NAME) - 1)) + RIGHT(AIA.FF_AGENT_LAST_NAME,3)
	  ELSE
		LOWER(LEFT(AIA.FF_AGENT_FIRST_NAME,1)) + LOWER(AIA.FF_AGENT_LAST_NAME) END  --INVOICE_MAP_KEY
,AIASD.FIELD_NAME
,AIASD.SCHEDULER_PROJECT_ID
,AIASD.SCHEDULER_ACL_NAME
,AIASD.ACD_ID_EXTENSION
,AIASD.OFFICIAL_WSOL_CLIENT_ID
,AIASD.OFFICIAL_WSOL_CLIENT_NAME
,AIASD.OFFICIAL_ACD_CLIENT_ID
,AIASD.OFFICIAL_ACD_CLIENT_NAME
,AIASD.PRIMARY_PROJECT_MANAGER_ID
,AIASD.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIASD.AGENT_TECHNOLOGY_MANAGER_ID
,AIASD.CONTRACTOR_SUPPORT_PATHWAY
,AIASD.INVOICE_SYSTEM_ID
,AIASD.HOLIDAY_INVOICE_ID
,CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN 'Yes' ELSE 'No' END  AS HOLIDAY   --AIR_DAY_TYPE:  'H'=Holiday  'S'=Standard (not holiday)
,AIASD.FILE_FORMAT_OF_PUSH
,AIASD.AGENT_PREPARATION_INVOICE_ID
,AIASD.NEW_ACL
,AIASD.CURRENT_CATS
,AIASD.CATS_ID
,AIASD.PATS_ID
,AIASD.SMART_ELIGIBLE
,AIASD.SMART_TIER_1
,AIASD.SMART_TIER_2
,AIASD.SMART_TIER_3
,AIASD.INTERVAL
,DT.CAL_DATE_STRING     --[DATE]             
,DT.LABEL_HH24 + ':00'  --HOD_INTERVAL

,ISNULL(AIA.LOGGED_IN_SECS, 0)	--AU_DK_LOGGED_IN_DURATION				--DATA IS IN SECONDS
,ISNULL(AIA.READY_SECS, 0)		--AU_DK_AVAILABLE_DURATION				--DATA IS IN SECONDS

,ISNULL(AIA.BUSY_SECS, 0)		--AU_DK_TALK_DURATION					--DATA IS IN SECONDS
,0								--AU_DK_IB_TALK_DURATION
,0								--AU_DK_OB_TALK_DURATION

,ISNULL(AIA.AUTHORIZED_WRAP, 0) --AU_DK_CONVENTIONAL_ACW				--DATA IS IN SECONDS
,ISNULL(AIA.NOT_READY_SECS, 0)	--AU_DK_NR_DURATION						--DATA IS IN SECONDS
,0								--AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,0								--AU_DK_ADJUSTED_NR_DURATION
,ISNULL(AIA.CPROD, 0)		    --AU_DK_TOTAL_PRODUCTIVE_DURATION		--DATA IS IN SECONDS
,ISNULL(AIA.CPROD, 0)		    --AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS	--DATA IS IN SECONDS

,0  --AU_DK_XFER_COUNT
,0  --AU_DK_HOLD_COUNT
,0  --AU_DK_CONFERENCE_COUNT
,0  --AU_DK_CONSULT_COUNT
,0  --AU_DK_PUP_COUNT

,0  --AU_DK_OFFERED_COUNT
,0  --AU_DK_HANDLED_COUNT
,0  --AU_DK_IB_HANDLE_COUNT
,0  --AU_DK_OB_HANDLE_COUNT
						
,0   --AU_DK_RONA_COUNT
,0   --AU_DK_AWR_COUNT

,ISNULL(AIA.MINIMUM_GUARANTEE, 0)	--MINIMUM_GUARANTEE			--DATA IS IN SECONDS
,ISNULL(AIA.AUTHORIZED_MINUTES, 0)	--AUTHORIZED_TO_INVOICE		--DATA IS IN SECONDS

,CONVERT(VARCHAR(10),DEW.CAL_WEEK_END_DATE,101)      --AS WEEK_ENDING_DATE       --EVERY SUNDAY.--,AIA.WEEK_ENDING_DATE             --HAVE TO CALCULATE !!!!!!!!!!!
,CONVERT(VARCHAR(10),DEW.PAY_CYCLE_CLOSURE_DATE,101) --AS PAY_CYCLE_CLOSURE_DATE --EVERY OTHER SUNDAY, FROM A STARTING SUNDAY OF 10/31/11.--,AIA.PAY_CYCLE_CLOSURE_DATE       --HAVE TO CALCULATE !!!!!!!!!!!

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,DT.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_MINUTES
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID		--CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END  --AS INVOICE_ID 
,AIA.RESOURCE_NAME
,0					--AIRITKDUR
,0					--AIRIACDUR
,0					--PAY_GROUP
,dbo.getdate()  --	[WS_ROW_CREATED_TIME] [datetime] NULL,
,NULL       --	[WS_ROW_UPDATED_TIME] [datetime] NULL
	
--SELECT * FROM WSOL_TB_IMPORTS_HUMACH_SD_AIA_STATIC_DEFAULTS ORDER BY OFFICIAL_WSOL_CLIENT_ID
--SELECT TOP 1000 *
FROM            WSOL_TB_IMPORTS_HUMACH_INVOICING_2            AIA
 
--ONLY WANT TO INCLUDE VALID ID_EXT IN _AIA TABLE -- ID EXTS THAT HAVE MINIMUM GUARANTEE AND AUTHORIZED MINUTE FORMULAS AND STATIC DEFAULTS SET UP
INNER JOIN      WSOL_TB_IMPORTS_HUMACH_SD_AIA_STATIC_DEFAULTS AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT
INNER JOIN      WSOL_TB_IMPORTS_HUMACH_SD_INVOICE_GROUPS      CASG  ON CASG.ID_EXT            = AIASD.ACD_ID_EXTENSION	

INNER JOIN      DATE_TIME									  DT    ON DT.DATE_TIME_KEY       = AIA.STD_TENANT_START_DATE_TIME_KEY

LEFT JOIN       #DT_EASY_WEEKS								  DEW   ON DEW.CAL_DATE_STRING    = DT.CAL_DATE_STRING

WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
  AND (ISNULL(AIASD.ACD_ID_EXTENSION,'') <> '')
--AND (ISNULL(AIA.PAY_GROUP,'') = 0)  -- THIS CAN BE SET TO ONLY INCLUDE CERTAIN PAY GROUPS IN THE XML PUSH

--  INNER JOIN TO AIASD TABLE INSURES ONLY RECORDS WITH VALID ID EXTENSIONS ARE PUT IN _AIA TABLE/XML REPORT/FILE...
--  SAME FOR INVOICE_GROUPS...

--  SELECT * FROM WSOL_TB_IMPORTS_HUMACH_INVOICING WHERE ISNULL(ID_EXT,'') = ''


--===================================================================
--UPDATE YZ_TB_...UV_ANT_AIA TABLE:
--===================================================================
--SELECT TOP 100 * FROM WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA
UPDATE WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA SET
 [PLATFORM]							= W1.[PLATFORM]
,[STATUS]							= W1.[STATUS]
--,INVOICE_MAP_KEY					= W1.INVOICE_MAP_KEY
,FIELD_NAME							= W1.FIELD_NAME
,SCHEDULER_PROJECT_ID				= W1.SCHEDULER_PROJECT_ID
,SCHEDULER_ACL_NAME					= W1.SCHEDULER_ACL_NAME
--,ACD_ID_EXTENSION					= W1.ACD_ID_EXTENSION
,OFFICIAL_WSOL_CLIENT_ID			= W1.OFFICIAL_WSOL_CLIENT_ID
,OFFICIAL_WSOL_CLIENT_NAME			= W1.OFFICIAL_WSOL_CLIENT_NAME
,OFFICIAL_ACD_CLIENT_ID				= W1.OFFICIAL_ACD_CLIENT_ID
,OFFICIAL_ACD_CLIENT_NAME			= W1.OFFICIAL_ACD_CLIENT_NAME
,PRIMARY_PROJECT_MANAGER_ID			= W1.PRIMARY_PROJECT_MANAGER_ID
,DIRECTOR_OF_PROJECT_MANAGEMENT_ID	= W1.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AGENT_TECHNOLOGY_MANAGER_ID		= W1.AGENT_TECHNOLOGY_MANAGER_ID
,CONTRACTOR_SUPPORT_PATHWAY			= W1.CONTRACTOR_SUPPORT_PATHWAY
,INVOICE_SYSTEM_ID					= W1.INVOICE_SYSTEM_ID
,HOLIDAY_INVOICE_ID					= W1.HOLIDAY_INVOICE_ID
,HOLIDAY							= W1.HOLIDAY
,FILE_FORMAT_OF_PUSH				= W1.FILE_FORMAT_OF_PUSH
,AGENT_PREPARATION_INVOICE_ID		= W1.AGENT_PREPARATION_INVOICE_ID
,NEW_ACL							= W1.NEW_ACL
,CURRENT_CATS						= W1.CURRENT_CATS
,CATS_ID							= W1.CATS_ID
,PATS_ID							= W1.PATS_ID
,SMART_ELIGIBLE						= W1.SMART_ELIGIBLE
,SMART_TIER_1						= W1.SMART_TIER_1
,SMART_TIER_2						= W1.SMART_TIER_2
,SMART_TIER_3						= W1.SMART_TIER_3
,INTERVAL							= W1.INTERVAL
,[DATE]								= W1.[DATE]
,HOD_INTERVAL						= W1.HOD_INTERVAL
,AU_DK_LOGGED_IN_DURATION			= W1.AU_DK_LOGGED_IN_DURATION
,AU_DK_AVAILABLE_DURATION			= W1.AU_DK_AVAILABLE_DURATION
,AU_DK_TALK_DURATION				= W1.AU_DK_TALK_DURATION
,AU_DK_IB_TALK_DURATION				= W1.AU_DK_IB_TALK_DURATION
,AU_DK_OB_TALK_DURATION				= W1.AU_DK_OB_TALK_DURATION
,AU_DK_CONVENTIONAL_ACW				= W1.AU_DK_CONVENTIONAL_ACW
,AU_DK_NR_DURATION					= W1.AU_DK_NR_DURATION
,AU_DK_PSEUDO_PRODUCTIVE_DURATION   = W1.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AU_DK_ADJUSTED_NR_DURATION         = W1.AU_DK_ADJUSTED_NR_DURATION
,AU_DK_TOTAL_PRODUCTIVE_DURATION    = W1.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS = W1.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AU_DK_XFER_COUNT					= W1.AU_DK_XFER_COUNT
,AU_DK_HOLD_COUNT					= W1.AU_DK_HOLD_COUNT
,AU_DK_CONFERENCE_COUNT				= W1.AU_DK_CONFERENCE_COUNT
,AU_DK_CONSULT_COUNT				= W1.AU_DK_CONSULT_COUNT
,AU_DK_PUP_COUNT					= W1.AU_DK_PUP_COUNT
,AU_DK_OFFERED_COUNT				= W1.AU_DK_OFFERED_COUNT
,AU_DK_HANDLED_COUNT				= W1.AU_DK_HANDLED_COUNT
,AU_DK_IB_HANDLE_COUNT				= W1.AU_DK_IB_HANDLE_COUNT
,AU_DK_OB_HANDLE_COUNT				= W1.AU_DK_OB_HANDLE_COUNT
,AU_DK_RONA_COUNT					= W1.AU_DK_RONA_COUNT
,AU_DK_AWR_COUNT					= W1.AU_DK_AWR_COUNT
,MINIMUM_GUARANTEE					= W1.MINIMUM_GUARANTEE
,AUTHORIZED_TO_INVOICE				= W1.AUTHORIZED_TO_INVOICE
,WEEK_ENDING_DATE					= W1.WEEK_ENDING_DATE
,PAY_CYCLE_CLOSURE_DATE				= W1.PAY_CYCLE_CLOSURE_DATE

--FIELDS ABOVE ARE IN XML FILE.   FIELDS BELOW ARE NOT IN XML FILE!!!:

,FTP_FILE_NAME						= W1.FTP_FILE_NAME
,EMAIL								= W1.EMAIL
--,STD_TENANT_START_DATE_TIME_KEY	= W1.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W1.CAL_DATE
,TENANT_KEY							= W1.TENANT_KEY
,AIR_DAY_TYPE						= W1.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W1.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE					= W1.MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE					= W1.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W1.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W1.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W1.INCLUDE_IN_CAS
,READY_FOR_XML						= W1.READY_FOR_XML
,SHOW_ID_EXTS						= W1.SHOW_ID_EXTS
,INVOICE_ID							= W1.INVOICE_ID
,RESOURCE_NAME						= W1.RESOURCE_NAME

,PAY_GROUP							= W1.PAY_GROUP
,AIRITKDUR							= W1.AIRITKDUR
,AIRIACDUR							= W1.AIRIACDUR

--,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

FROM            #WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA   W1

INNER JOIN      WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA    UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
														AND UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION
														AND UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY )
  AND ( UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION )
  AND ( UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY )


--================================================
--INSERT TMP TABLE FIELDS INTO YZ_TB_... TABLE:
--================================================
INSERT INTO [WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA]
SELECT 
 AIA.[PLATFORM]
,AIA.[STATUS]
,AIA.INVOICE_MAP_KEY
,AIA.FIELD_NAME
,AIA.SCHEDULER_PROJECT_ID
,AIA.SCHEDULER_ACL_NAME
,AIA.ACD_ID_EXTENSION
,AIA.OFFICIAL_WSOL_CLIENT_ID
,AIA.OFFICIAL_WSOL_CLIENT_NAME
,AIA.OFFICIAL_ACD_CLIENT_ID
,AIA.OFFICIAL_ACD_CLIENT_NAME
,AIA.PRIMARY_PROJECT_MANAGER_ID
,AIA.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIA.AGENT_TECHNOLOGY_MANAGER_ID
,AIA.CONTRACTOR_SUPPORT_PATHWAY
,AIA.INVOICE_SYSTEM_ID
,AIA.HOLIDAY_INVOICE_ID
,AIA.HOLIDAY
,AIA.FILE_FORMAT_OF_PUSH
,AIA.AGENT_PREPARATION_INVOICE_ID
,AIA.NEW_ACL
,AIA.CURRENT_CATS
,AIA.CATS_ID
,AIA.PATS_ID
,AIA.SMART_ELIGIBLE
,AIA.SMART_TIER_1
,AIA.SMART_TIER_2
,AIA.SMART_TIER_3
,AIA.INTERVAL
,AIA.[DATE]
,AIA.HOD_INTERVAL
,AIA.AU_DK_LOGGED_IN_DURATION
,AIA.AU_DK_AVAILABLE_DURATION
,AIA.AU_DK_TALK_DURATION
,AIA.AU_DK_IB_TALK_DURATION
,AIA.AU_DK_OB_TALK_DURATION
,AIA.AU_DK_CONVENTIONAL_ACW
,AIA.AU_DK_NR_DURATION
,AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AIA.AU_DK_ADJUSTED_NR_DURATION
,AIA.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AIA.AU_DK_XFER_COUNT
,AIA.AU_DK_HOLD_COUNT
,AIA.AU_DK_CONFERENCE_COUNT
,AIA.AU_DK_CONSULT_COUNT
,AIA.AU_DK_PUP_COUNT
,AIA.AU_DK_OFFERED_COUNT
,AIA.AU_DK_HANDLED_COUNT
,AIA.AU_DK_IB_HANDLE_COUNT
,AIA.AU_DK_OB_HANDLE_COUNT
,AIA.AU_DK_RONA_COUNT
,AIA.AU_DK_AWR_COUNT
,AIA.MINIMUM_GUARANTEE
,AIA.AUTHORIZED_TO_INVOICE
,AIA.WEEK_ENDING_DATE
,AIA.PAY_CYCLE_CLOSURE_DATE

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,AIA.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_RATE
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID
,AIA.RESOURCE_NAME
,AIA.PAY_GROUP
,AIA.AIRITKDUR
,AIA.AIRIACDUR
,AIA.WS_ROW_CREATED_TIME
,AIA.WS_ROW_UPDATED_TIME

--Where Permanent table is Null and Work table is not Null - then we want to add the data!!!:

FROM            #WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA   AIA
LEFT JOIN       WSOL_TB_IMPORTS_HUMACH_UV_ANT_AIA    UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = AIA.STD_TENANT_START_DATE_TIME_KEY
														AND UV.ACD_ID_EXTENSION               = AIA.ACD_ID_EXTENSION
														AND UV.INVOICE_MAP_KEY                = AIA.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY IS NULL AND ISNULL(AIA.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND ( UV.ACD_ID_EXTENSION               IS NULL AND ISNULL(AIA.ACD_ID_EXTENSION,'') <> '' )
  AND ( UV.INVOICE_MAP_KEY                IS NULL AND ISNULL(AIA.INVOICE_MAP_KEY,'') <> '' )

--=============================================
EARLY_EXIT:
--=============================================