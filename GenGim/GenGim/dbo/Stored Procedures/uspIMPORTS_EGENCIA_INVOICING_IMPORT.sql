
CREATE PROCEDURE [dbo].[uspIMPORTS_EGENCIA_INVOICING_IMPORT]
AS
SET NOCOUNT ON

--  EXECUTE [dbo].[uspIMPORTS_EGENCIA_INVOICING_IMPORT]

--  SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1

--	Data is received in Pacific Time Zone.  Data will be converted to Central Time Zone.
--  Durations are in seconds by 30 minute intervals.

--=================================================================================================
DECLARE @TENANT_KEY INT
SET @TENANT_KEY = 106  -- Egencia CLIENT_ID in WSOL Database
--=================================================================================================
DELETE FROM WSOL_TB_IMPORT_ERRORS_FOUND
WHERE TENANT_KEY		= @TENANT_KEY
  AND SUB_GROUP_NAME	= 'EGENCIA_INVOICING'
  --  SELECT * FROM WSOL_TB_IMPORT_ERRORS_FOUND WHERE TENANT_KEY = 106
--=================================================================================================

--===========================================================================================================
--  USING @WS_ROW_CREATED_TIME FOR ALL INSERTS WILL ALLOW TO DELETE SPECIFIC INSERT PROCESSES/FILES.
--  IN CASE OF EMERGENCY, BREAK GLASS.
--===========================================================================================================
DECLARE @WS_ROW_CREATED_TIME AS DATETIME
SET @WS_ROW_CREATED_TIME = DBO.GETDATE()  --CLOSE ENOUGH TO ACTUAL INSERT TIME!
--===========================================================================================================

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
--==============================================================
--	DETERMINE DATE OF DATA AND UPDATE WORK TABLE
--==============================================================
IF OBJECT_ID('TEMPDB..#EGENCIA_GET_DATE') IS NOT NULL BEGIN
   DROP TABLE #EGENCIA_GET_DATE
END
CREATE TABLE #EGENCIA_GET_DATE
(DATE_STRING	VARCHAR(50)
,FTP_FILE_NAME	VARCHAR(100)
)
INSERT INTO #EGENCIA_GET_DATE
SELECT
 W1.FF_HOUR
,W1.FTP_FILE_NAME
FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 W1
WHERE W1.FF_LOGIN_ID = 'Date:'

UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 DATA_DATE =  EGE.DATE_STRING
FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 I
INNER JOIN #EGENCIA_GET_DATE EGE ON EGE.FTP_FILE_NAME = I.FTP_FILE_NAME

--==============================================================
--	DETERMINE CMS GROUP FOR DATA AND UPDATE WORK TABLE
--==============================================================
IF OBJECT_ID('TEMPDB..#EGENCIA_GET_CMS_GROUP') IS NOT NULL BEGIN
   DROP TABLE #EGENCIA_GET_CMS_GROUP
END
CREATE TABLE #EGENCIA_GET_CMS_GROUP
(CMS_GROUP		VARCHAR(100)
,FTP_FILE_NAME	VARCHAR(100)
)
INSERT INTO #EGENCIA_GET_CMS_GROUP
SELECT
 W1.FF_HOUR
,W1.FTP_FILE_NAME
FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 W1
WHERE W1.FF_LOGIN_ID = 'Agent Group:'

UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 CMS_GROUP =  EGE.CMS_GROUP
FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 I
INNER JOIN #EGENCIA_GET_CMS_GROUP EGE ON EGE.FTP_FILE_NAME = I.FTP_FILE_NAME

--======================================================
--	CLEANUP WORK (_1) TABLE:
--======================================================
DELETE FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 
WHERE FF_LOGIN_ID = 'Date:'
   OR FF_LOGIN_ID = 'Agent Group:'
   OR FF_LOGIN_ID = 'Login ID'
   OR FF_LOGIN_ID = 'Totals'
   OR FF_LOGIN_ID = ''

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
--============================================================================================
--	POPULATE ADDITIONAL FIELDS IN WORK (_1) TABLE THAT WEREN'T IN IMPORTED FILE:
--============================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 DATETIME_PT				= CAST((DATA_DATE + ' ' + FF_HOUR) AS DATETIME)
,STAFFED_SECS				= ISNULL(CAST(FF_STAFFED_TIME		AS DECIMAL(10,2)),0.00)
,AVAILABLE_SECS				= ISNULL(CAST(FF_AVAIL_TIME			AS DECIMAL(10,2)),0.00)
,ACD_SECS					= ISNULL(CAST(FF_ACD_TIME			AS DECIMAL(10,2)),0.00)
,OTHER_SECS					= ISNULL(CAST(FF_OTHER_TIME			AS DECIMAL(10,2)),0.00)
,ACW_SECS					= ISNULL(CAST(FF_ACW_TIME			AS DECIMAL(10,2)),0.00)
,RING_SECS					= ISNULL(CAST(FF_AGENT_RING_TIME	AS DECIMAL(10,2)),0.00)
,AUX_0_DEFAULT_SECS			= ISNULL(CAST(FF_AUX_0_DEFAULT		AS DECIMAL(10,2)),0.00)
,AUX_1_BREAK_SECS			= ISNULL(CAST(FF_AUX_1_BREAK		AS DECIMAL(10,2)),0.00)
,AUX_2_COACHING_SECS		= ISNULL(CAST(FF_AUX_2_COACHING		AS DECIMAL(10,2)),0.00)
,AUX_3_MEETING_SECS			= ISNULL(CAST(FF_AUX_3_MEETING		AS DECIMAL(10,2)),0.00)
,AUX_4_PROJECT_SECS			= ISNULL(CAST(FF_AUX_4_PROJECT		AS DECIMAL(10,2)),0.00)
,AUX_5_EGE_TRAINING_SECS	= ISNULL(CAST(FF_AUX_5_EGE_TRAINING	AS DECIMAL(10,2)),0.00)
,AUX_6_OUTBOUND_SECS		= ISNULL(CAST(FF_AUX_6_OUTBOUND		AS DECIMAL(10,2)),0.00)
,AUX_7_EMAIL_SECS			= ISNULL(CAST(FF_AUX_7_EMAIL		AS DECIMAL(10,2)),0.00)
,AUX_8_QUEUE_WORK_SECS		= ISNULL(CAST(FF_AUX_8_QUEUE_WORK	AS DECIMAL(10,2)),0.00)
,AUX_9_SYSTEM_DOWN_SECS		= ISNULL(CAST(FF_AUX_9_SYSTEM_DOWN	AS DECIMAL(10,2)),0.00)
,AUX_10_EXCHANGE_SECS		= ISNULL(CAST(FF_AUX_10_EXCHANGE	AS DECIMAL(10,2)),0.00)
,AUX_11_PERSONAL_SECS		= ISNULL(CAST(FF_AUX_11_PERSONAL	AS DECIMAL(10,2)),0.00)
,AUX_34_SECS				= ISNULL(CAST(FF_TI_AUXTIME_34		AS DECIMAL(10,2)),0.00)
,AUX_35_SECS				= ISNULL(CAST(FF_TI_AUXTIME_35		AS DECIMAL(10,2)),0.00)
,AUX_37_SECS				= ISNULL(CAST(FF_TI_AUXTIME_37		AS DECIMAL(10,2)),0.00)
,AUX_40_SECS				= ISNULL(CAST(FF_TI_AUXTIME_40		AS DECIMAL(10,2)),0.00)
,TOTAL_AUX_SECS				= ISNULL(CAST(FF_AUX_TIME			AS DECIMAL(10,2)),0.00)
,TENANT_KEY					= @TENANT_KEY

--============================================================================================
-- CORRECT DURATIONS FOR DAYLIGHT SAVINGS TIME ***** ONLY WHEN APPLICABLE *****
--============================================================================================
/*UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 STAFFED_SECS				= STAFFED_SECS				/ 2.00
,AVAILABLE_SECS				= AVAILABLE_SECS			/ 2.00
,ACD_SECS					= ACD_SECS					/ 2.00
,OTHER_SECS					= OTHER_SECS				/ 2.00
,ACW_SECS					= ACW_SECS					/ 2.00
,RING_SECS					= RING_SECS					/ 2.00
,AUX_0_DEFAULT_SECS			= AUX_0_DEFAULT_SECS		/ 2.00
,AUX_1_BREAK_SECS			= AUX_1_BREAK_SECS			/ 2.00
,AUX_2_COACHING_SECS		= AUX_2_COACHING_SECS		/ 2.00
,AUX_3_MEETING_SECS			= AUX_3_MEETING_SECS		/ 2.00
,AUX_4_PROJECT_SECS			= AUX_4_PROJECT_SECS		/ 2.00
,AUX_5_EGE_TRAINING_SECS	= AUX_5_EGE_TRAINING_SECS	/ 2.00
,AUX_6_OUTBOUND_SECS		= AUX_6_OUTBOUND_SECS		/ 2.00
,AUX_7_EMAIL_SECS			= AUX_7_EMAIL_SECS			/ 2.00
,AUX_8_QUEUE_WORK_SECS		= AUX_8_QUEUE_WORK_SECS		/ 2.00
,AUX_9_SYSTEM_DOWN_SECS		= AUX_9_SYSTEM_DOWN_SECS	/ 2.00
,AUX_10_EXCHANGE_SECS		= AUX_10_EXCHANGE_SECS		/ 2.00
,AUX_11_PERSONAL_SECS		= AUX_11_PERSONAL_SECS		/ 2.00
,AUX_34_SECS				= AUX_34_SECS				/ 2.00
,AUX_35_SECS				= AUX_35_SECS				/ 2.00
,AUX_37_SECS				= AUX_37_SECS				/ 2.00
,AUX_40_SECS				= AUX_40_SECS				/ 2.00
,TOTAL_AUX_SECS				= TOTAL_AUX_SECS			/ 2.00
WHERE FF_HOUR IN ('1:00','1:30')
*/

--===================================================================================
--	POPULATE ADDITIONAL FIELDS IN WORK (_1) TABLE THAT WEREN'T IN IMPORTED FILE:
--===================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 DATETIME_CT	= DATEADD(HH,+2,DATETIME_PT)
,[DATETIME]		= DATETIME_PT
,HOUR_INTERVAL	= DATEPART(HH,DATETIME_PT)
,OUTBOUND_SECS	= AUX_6_OUTBOUND_SECS + AUX_35_SECS
,EMAIL_SECS		= AUX_7_EMAIL_SECS + AUX_34_SECS
,PROJECT_SECS	= AUX_4_PROJECT_SECS + AUX_37_SECS
,MEETING_SECS	= AUX_3_MEETING_SECS + AUX_40_SECS

--================================================================================================================================================================================================
--	POPULATE INITIAL INVOICE VALUES
--================================================================================================================================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 PROD_BILLING_SECS				= AVAILABLE_SECS + ACD_SECS + OTHER_SECS + ACW_SECS + AUX_0_DEFAULT_SECS + OUTBOUND_SECS + EMAIL_SECS + AUX_10_EXCHANGE_SECS + RING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS	= AVAILABLE_SECS + ACD_SECS + OTHER_SECS + ACW_SECS + AUX_0_DEFAULT_SECS + OUTBOUND_SECS + EMAIL_SECS + AUX_10_EXCHANGE_SECS
,AUTHORIZED_RESOURCE_SECS		= AVAILABLE_SECS + ACD_SECS + OTHER_SECS + ACW_SECS + AUX_0_DEFAULT_SECS + OUTBOUND_SECS + EMAIL_SECS + AUX_10_EXCHANGE_SECS + PROJECT_SECS + MEETING_SECS 

--===================================================================================================
--	UPDATE DATETIME KEY
--===================================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 STD_TENANT_START_DATE_TIME_KEY = DT.DATE_TIME_KEY
FROM		WSOL_TB_IMPORTS_EGENCIA_INVOICING_1	I
INNER JOIN	DATE_TIME							DT	ON DT.CAL_DATE = I.DATETIME_PT

--===================================================================================================
--	SET WEEKEND FLAG (SAT 08:00 - SUN 23:59 CT) (SAT 06:00 - SUN 21:59 PT)
--===================================================================================================
SET DATEFIRST 1  -- = Monday  

UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 WEEKEND = CASE WHEN ( DATEPART(DW, DATETIME_PT) = 6 AND CAST(HOUR_INTERVAL AS INT) > 5  ) THEN 'Y'	-- > SAT 05:00 
				WHEN ( DATEPART(DW, DATETIME_PT) = 7 AND CAST(HOUR_INTERVAL AS INT) < 22 ) THEN 'Y'	-- < SUN 22:00
				ELSE 'N' END

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1

--===============================================
--HANDLE INVALID DATE/TIME RECORDS:
--===============================================
INSERT INTO WSOL_TB_IMPORTS_EGENCIA_INVOICING_BAD
(
 BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_LOGIN_ID
,FF_HOUR
,FF_STAFFED_TIME
,FF_AVAIL_TIME
,FF_ACD_TIME
,FF_OTHER_TIME
,FF_ACW_TIME
,FF_AGENT_RING_TIME
,FF_AUX_TIME
,FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK
,FF_AUX_2_COACHING
,FF_AUX_3_MEETING
,FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99
,CMS_GROUP
,DATA_DATE
,DATETIME_CT
,DATETIME_PT
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,STAFFED_SECS
,AVAILABLE_SECS
,ACD_SECS
,OTHER_SECS
,ACW_SECS
,RING_SECS
,AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS
,AUX_34_SECS
,AUX_35_SECS
,AUX_37_SECS
,AUX_40_SECS
,OUTBOUND_SECS
,EMAIL_SECS
,PROJECT_SECS
,MEETING_SECS
,TOTAL_AUX_SECS
,PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS
,WEEKEND
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,[EMAIL]
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
)
SELECT
 'DTM'					--BAD_IMPORTS_CODE		--'Invalid Datetime'
,'ACT'                  --BAD_IMPORTS_FILE_TYPE	--'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME	--WS_ROW_CREATED_TIME
,W1.FF_LOGIN_ID
,W1.FF_HOUR
,W1.FF_STAFFED_TIME
,W1.FF_AVAIL_TIME
,W1.FF_ACD_TIME
,W1.FF_OTHER_TIME
,W1.FF_ACW_TIME
,W1.FF_AGENT_RING_TIME
,W1.FF_AUX_TIME
,W1.FF_AUX_0_DEFAULT
,W1.FF_AUX_1_BREAK
,W1.FF_AUX_2_COACHING
,W1.FF_AUX_3_MEETING
,W1.FF_AUX_4_PROJECT
,W1.FF_AUX_5_EGE_TRAINING
,W1.FF_AUX_6_OUTBOUND
,W1.FF_AUX_7_EMAIL
,W1.FF_AUX_8_QUEUE_WORK
,W1.FF_AUX_9_SYSTEM_DOWN
,W1.FF_AUX_10_EXCHANGE
,W1.FF_AUX_11_PERSONAL
,W1.FF_TI_AUXTIME_12
,W1.FF_TI_AUXTIME_13
,W1.FF_TI_AUXTIME_14
,W1.FF_TI_AUXTIME_15
,W1.FF_TI_AUXTIME_16
,W1.FF_TI_AUXTIME_17
,W1.FF_TI_AUXTIME_18
,W1.FF_TI_AUXTIME_19
,W1.FF_TI_AUXTIME_20
,W1.FF_TI_AUXTIME_21
,W1.FF_TI_AUXTIME_22
,W1.FF_TI_AUXTIME_23
,W1.FF_TI_AUXTIME_24
,W1.FF_TI_AUXTIME_25
,W1.FF_TI_AUXTIME_26
,W1.FF_TI_AUXTIME_27
,W1.FF_TI_AUXTIME_28
,W1.FF_TI_AUXTIME_29
,W1.FF_TI_AUXTIME_30
,W1.FF_TI_AUXTIME_31
,W1.FF_TI_AUXTIME_32
,W1.FF_TI_AUXTIME_33
,W1.FF_TI_AUXTIME_34
,W1.FF_TI_AUXTIME_35
,W1.FF_TI_AUXTIME_36
,W1.FF_TI_AUXTIME_37
,W1.FF_TI_AUXTIME_38
,W1.FF_TI_AUXTIME_39
,W1.FF_TI_AUXTIME_40
,W1.FF_TI_AUXTIME_41
,W1.FF_TI_AUXTIME_42
,W1.FF_TI_AUXTIME_43
,W1.FF_TI_AUXTIME_44
,W1.FF_TI_AUXTIME_45
,W1.FF_TI_AUXTIME_46
,W1.FF_TI_AUXTIME_47
,W1.FF_TI_AUXTIME_48
,W1.FF_TI_AUXTIME_49
,W1.FF_TI_AUXTIME_50
,W1.FF_TI_AUXTIME_51
,W1.FF_TI_AUXTIME_52
,W1.FF_TI_AUXTIME_53
,W1.FF_TI_AUXTIME_54
,W1.FF_TI_AUXTIME_55
,W1.FF_TI_AUXTIME_56
,W1.FF_TI_AUXTIME_57
,W1.FF_TI_AUXTIME_58
,W1.FF_TI_AUXTIME_59
,W1.FF_TI_AUXTIME_60
,W1.FF_TI_AUXTIME_61
,W1.FF_TI_AUXTIME_62
,W1.FF_TI_AUXTIME_63
,W1.FF_TI_AUXTIME_64
,W1.FF_TI_AUXTIME_65
,W1.FF_TI_AUXTIME_66
,W1.FF_TI_AUXTIME_67
,W1.FF_TI_AUXTIME_68
,W1.FF_TI_AUXTIME_69
,W1.FF_TI_AUXTIME_70
,W1.FF_TI_AUXTIME_71
,W1.FF_TI_AUXTIME_72
,W1.FF_TI_AUXTIME_73
,W1.FF_TI_AUXTIME_74
,W1.FF_TI_AUXTIME_75
,W1.FF_TI_AUXTIME_76
,W1.FF_TI_AUXTIME_77
,W1.FF_TI_AUXTIME_78
,W1.FF_TI_AUXTIME_79
,W1.FF_TI_AUXTIME_80
,W1.FF_TI_AUXTIME_81
,W1.FF_TI_AUXTIME_82
,W1.FF_TI_AUXTIME_83
,W1.FF_TI_AUXTIME_84
,W1.FF_TI_AUXTIME_85
,W1.FF_TI_AUXTIME_86
,W1.FF_TI_AUXTIME_87
,W1.FF_TI_AUXTIME_88
,W1.FF_TI_AUXTIME_89
,W1.FF_TI_AUXTIME_90
,W1.FF_TI_AUXTIME_91
,W1.FF_TI_AUXTIME_92
,W1.FF_TI_AUXTIME_93
,W1.FF_TI_AUXTIME_94
,W1.FF_TI_AUXTIME_95
,W1.FF_TI_AUXTIME_96
,W1.FF_TI_AUXTIME_97
,W1.FF_TI_AUXTIME_98
,W1.FF_TI_AUXTIME_99
,W1.CMS_GROUP
,W1.DATA_DATE
,W1.DATETIME_CT
,W1.DATETIME_PT
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.STAFFED_SECS
,W1.AVAILABLE_SECS
,W1.ACD_SECS
,W1.OTHER_SECS
,W1.ACW_SECS
,W1.RING_SECS
,W1.AUX_0_DEFAULT_SECS
,W1.AUX_1_BREAK_SECS
,W1.AUX_2_COACHING_SECS
,W1.AUX_3_MEETING_SECS
,W1.AUX_4_PROJECT_SECS
,W1.AUX_5_EGE_TRAINING_SECS
,W1.AUX_6_OUTBOUND_SECS
,W1.AUX_7_EMAIL_SECS
,W1.AUX_8_QUEUE_WORK_SECS
,W1.AUX_9_SYSTEM_DOWN_SECS
,W1.AUX_10_EXCHANGE_SECS
,W1.AUX_11_PERSONAL_SECS
,W1.AUX_34_SECS
,W1.AUX_35_SECS
,W1.AUX_37_SECS
,W1.AUX_40_SECS
,W1.OUTBOUND_SECS
,W1.EMAIL_SECS
,W1.PROJECT_SECS
,W1.MEETING_SECS
,W1.TOTAL_AUX_SECS
,W1.PROD_BILLING_SECS
,W1.AUTHORIZED_CSAT_SAT_KEY_SECS
,W1.AUTHORIZED_RESOURCE_SECS
,W1.LINE_OF_BUSINESS
,W1.WEEKEND
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.[EMAIL]
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
--SELECT *
FROM           WSOL_TB_IMPORTS_EGENCIA_INVOICING_1   W1
WHERE  ISNULL(W1.STD_TENANT_START_DATE_TIME_KEY,0) = 0

--======================================================================
--DELETE INVALID DATE/TIME RECORDS;
--======================================================================
DELETE FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
WHERE ISNULL(STD_TENANT_START_DATE_TIME_KEY,0) = 0
--======================================================================

--===========================================================================================================
--HANDLE DUPLICATES:
--===========================================================================================================
INSERT INTO WSOL_TB_IMPORTS_EGENCIA_INVOICING_BAD
(
 BAD_IMPORTS_CODE
,BAD_IMPORTS_FILE_TYPE
,WS_ROW_CREATED_TIME
,FF_LOGIN_ID
,FF_HOUR
,FF_STAFFED_TIME
,FF_AVAIL_TIME
,FF_ACD_TIME
,FF_OTHER_TIME
,FF_ACW_TIME
,FF_AGENT_RING_TIME
,FF_AUX_TIME
,FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK
,FF_AUX_2_COACHING
,FF_AUX_3_MEETING
,FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99
,CMS_GROUP
,DATA_DATE
,DATETIME_CT
,DATETIME_PT
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,STAFFED_SECS
,AVAILABLE_SECS
,ACD_SECS
,OTHER_SECS
,ACW_SECS
,RING_SECS
,AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS
,AUX_34_SECS
,AUX_35_SECS
,AUX_37_SECS
,AUX_40_SECS
,OUTBOUND_SECS
,EMAIL_SECS
,PROJECT_SECS
,MEETING_SECS
,TOTAL_AUX_SECS
,PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS
,WEEKEND
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,[EMAIL]
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
)
SELECT
 'DUP'					--BAD_IMPORTS_CODE		--'DUPLICATE'
,'ACT'                  --BAD_IMPORTS_FILE_TYPE --'ACT'IVITY FILE
,@WS_ROW_CREATED_TIME	--WS_ROW_CREATED_TIME
,W1.FF_LOGIN_ID
,W1.FF_HOUR
,W1.FF_STAFFED_TIME
,W1.FF_AVAIL_TIME
,W1.FF_ACD_TIME
,W1.FF_OTHER_TIME
,W1.FF_ACW_TIME
,W1.FF_AGENT_RING_TIME
,W1.FF_AUX_TIME
,W1.FF_AUX_0_DEFAULT
,W1.FF_AUX_1_BREAK
,W1.FF_AUX_2_COACHING
,W1.FF_AUX_3_MEETING
,W1.FF_AUX_4_PROJECT
,W1.FF_AUX_5_EGE_TRAINING
,W1.FF_AUX_6_OUTBOUND
,W1.FF_AUX_7_EMAIL
,W1.FF_AUX_8_QUEUE_WORK
,W1.FF_AUX_9_SYSTEM_DOWN
,W1.FF_AUX_10_EXCHANGE
,W1.FF_AUX_11_PERSONAL
,W1.FF_TI_AUXTIME_12
,W1.FF_TI_AUXTIME_13
,W1.FF_TI_AUXTIME_14
,W1.FF_TI_AUXTIME_15
,W1.FF_TI_AUXTIME_16
,W1.FF_TI_AUXTIME_17
,W1.FF_TI_AUXTIME_18
,W1.FF_TI_AUXTIME_19
,W1.FF_TI_AUXTIME_20
,W1.FF_TI_AUXTIME_21
,W1.FF_TI_AUXTIME_22
,W1.FF_TI_AUXTIME_23
,W1.FF_TI_AUXTIME_24
,W1.FF_TI_AUXTIME_25
,W1.FF_TI_AUXTIME_26
,W1.FF_TI_AUXTIME_27
,W1.FF_TI_AUXTIME_28
,W1.FF_TI_AUXTIME_29
,W1.FF_TI_AUXTIME_30
,W1.FF_TI_AUXTIME_31
,W1.FF_TI_AUXTIME_32
,W1.FF_TI_AUXTIME_33
,W1.FF_TI_AUXTIME_34
,W1.FF_TI_AUXTIME_35
,W1.FF_TI_AUXTIME_36
,W1.FF_TI_AUXTIME_37
,W1.FF_TI_AUXTIME_38
,W1.FF_TI_AUXTIME_39
,W1.FF_TI_AUXTIME_40
,W1.FF_TI_AUXTIME_41
,W1.FF_TI_AUXTIME_42
,W1.FF_TI_AUXTIME_43
,W1.FF_TI_AUXTIME_44
,W1.FF_TI_AUXTIME_45
,W1.FF_TI_AUXTIME_46
,W1.FF_TI_AUXTIME_47
,W1.FF_TI_AUXTIME_48
,W1.FF_TI_AUXTIME_49
,W1.FF_TI_AUXTIME_50
,W1.FF_TI_AUXTIME_51
,W1.FF_TI_AUXTIME_52
,W1.FF_TI_AUXTIME_53
,W1.FF_TI_AUXTIME_54
,W1.FF_TI_AUXTIME_55
,W1.FF_TI_AUXTIME_56
,W1.FF_TI_AUXTIME_57
,W1.FF_TI_AUXTIME_58
,W1.FF_TI_AUXTIME_59
,W1.FF_TI_AUXTIME_60
,W1.FF_TI_AUXTIME_61
,W1.FF_TI_AUXTIME_62
,W1.FF_TI_AUXTIME_63
,W1.FF_TI_AUXTIME_64
,W1.FF_TI_AUXTIME_65
,W1.FF_TI_AUXTIME_66
,W1.FF_TI_AUXTIME_67
,W1.FF_TI_AUXTIME_68
,W1.FF_TI_AUXTIME_69
,W1.FF_TI_AUXTIME_70
,W1.FF_TI_AUXTIME_71
,W1.FF_TI_AUXTIME_72
,W1.FF_TI_AUXTIME_73
,W1.FF_TI_AUXTIME_74
,W1.FF_TI_AUXTIME_75
,W1.FF_TI_AUXTIME_76
,W1.FF_TI_AUXTIME_77
,W1.FF_TI_AUXTIME_78
,W1.FF_TI_AUXTIME_79
,W1.FF_TI_AUXTIME_80
,W1.FF_TI_AUXTIME_81
,W1.FF_TI_AUXTIME_82
,W1.FF_TI_AUXTIME_83
,W1.FF_TI_AUXTIME_84
,W1.FF_TI_AUXTIME_85
,W1.FF_TI_AUXTIME_86
,W1.FF_TI_AUXTIME_87
,W1.FF_TI_AUXTIME_88
,W1.FF_TI_AUXTIME_89
,W1.FF_TI_AUXTIME_90
,W1.FF_TI_AUXTIME_91
,W1.FF_TI_AUXTIME_92
,W1.FF_TI_AUXTIME_93
,W1.FF_TI_AUXTIME_94
,W1.FF_TI_AUXTIME_95
,W1.FF_TI_AUXTIME_96
,W1.FF_TI_AUXTIME_97
,W1.FF_TI_AUXTIME_98
,W1.FF_TI_AUXTIME_99
,W1.CMS_GROUP
,W1.DATA_DATE
,W1.DATETIME_CT
,W1.DATETIME_PT
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.STAFFED_SECS
,W1.AVAILABLE_SECS
,W1.ACD_SECS
,W1.OTHER_SECS
,W1.ACW_SECS
,W1.RING_SECS
,W1.AUX_0_DEFAULT_SECS
,W1.AUX_1_BREAK_SECS
,W1.AUX_2_COACHING_SECS
,W1.AUX_3_MEETING_SECS
,W1.AUX_4_PROJECT_SECS
,W1.AUX_5_EGE_TRAINING_SECS
,W1.AUX_6_OUTBOUND_SECS
,W1.AUX_7_EMAIL_SECS
,W1.AUX_8_QUEUE_WORK_SECS
,W1.AUX_9_SYSTEM_DOWN_SECS
,W1.AUX_10_EXCHANGE_SECS
,W1.AUX_11_PERSONAL_SECS
,W1.AUX_34_SECS
,W1.AUX_35_SECS
,W1.AUX_37_SECS
,W1.AUX_40_SECS
,W1.OUTBOUND_SECS
,W1.EMAIL_SECS
,W1.PROJECT_SECS
,W1.MEETING_SECS
,W1.TOTAL_AUX_SECS
,W1.PROD_BILLING_SECS
,W1.AUTHORIZED_CSAT_SAT_KEY_SECS
,W1.AUTHORIZED_RESOURCE_SECS
,W1.LINE_OF_BUSINESS
,W1.WEEKEND
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.[EMAIL]
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
FROM
(	SELECT
	 [DATETIME]
	,FF_LOGIN_ID
	,ROW_NUMBER() over (partition by [DATETIME], FF_LOGIN_ID
                            order by [DATETIME], FF_LOGIN_ID, STAFFED_SECS DESC) ROWNO
	FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
) TNM
LEFT JOIN      WSOL_TB_IMPORTS_EGENCIA_INVOICING_1	W1   ON W1.[DATETIME]		= TNM.[DATETIME]
														AND W1.FF_LOGIN_ID		= TNM.FF_LOGIN_ID
WHERE TNM.ROWNO > 1

--===========================================================================================================
--DELETE DUPLICATES:
--===========================================================================================================
DELETE FROM TNM
FROM
(	SELECT
	 [DATETIME]
	,FF_LOGIN_ID
	,ROW_NUMBER() over (partition by [DATETIME], FF_LOGIN_ID
                            order by [DATETIME], FF_LOGIN_ID, STAFFED_SECS DESC) ROWNO
	FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
) TNM
WHERE TNM.ROWNO > 1
--===========================================================================================================

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_AIA_AGENT_MAPPING
--===========================================================================================================
--	UPDATE FIELDS FROM MAPPING DATA AND ADDITIONAL INVOICE FIELDS
--===========================================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
  EMAIL				= ISNULL(IAM.EMAIL_ADDRESS,'')
 ,LINE_OF_BUSINESS	= ISNULL(IAM.SKILL,'')
 ,ID_EXT			= CASE WHEN IAM.SKILL = 'Resource'	THEN 'ERA'
						   WHEN IAM.SKILL = 'C-Select'	THEN 'ECS'
						   WHEN IAM.SKILL = 'KEY'		THEN 'EKA'
						   WHEN IAM.SKILL = 'SAT'		THEN 'ESA'
						   WHEN IAM.SKILL = 'SME'		THEN 'ESM'
						   ELSE '' END
 ,RESOURCE_NAME		= ISNULL(IAM.RESOURCE_NAME,'')
 FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1			I
 LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_AIA_AGENT_MAPPING		IAM  ON IAM.INVOICE_MAP_KEY = I.FF_LOGIN_ID

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_AIA_AGENT_MAPPING

--	SELECT DISTINCT(ID_EXT) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1

--===================================================================================================================================================
--SET ADDITIONAL INVOICE FIELDS
--===================================================================================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET	-- SELECT
  AIR_DAY_TYPE = CASE WHEN IG.HAS_HOLIDAYS = 'Y' AND
						 (    ISNULL(IH.HOLIDAY_DATE,'1/1/1900') > CAST('1/1/1901' AS DATETIME) OR
						   ( ISNULL(IHA.HOLIDAY_DATE,'1/1/1900') > CAST('1/1/1901' AS DATETIME) AND ISNULL(IHA.ID_EXT,'') <> '' )
						 )
					  THEN 'H' ELSE 'S' END  --AS AIR_DAY_TYPE  --H=Holiday  --S=Standard
 FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1				I
 INNER JOIN      DATE_TIME											DT	ON DT.DATE_TIME_KEY       = I.STD_TENANT_START_DATE_TIME_KEY
 LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_GROUPS			IG	ON IG.ID_EXT              = I.ID_EXT
 LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_HOLIDAYS		IH	ON IH.HOLIDAY_DATE        = CAST(DT.CAL_DATE_STRING AS DATETIME)
 LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_HOLIDAYS_ADDL	IHA ON IHA.HOLIDAY_DATE       = CAST(DT.CAL_DATE_STRING AS DATETIME)
																	   AND IHA.ID_EXT             = I.ID_EXT

UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
  AIR_ACW_FONT_COLOR             = 'Black'
 ,MIN_GUARANTEE_MINUTES          = ISNULL(IG.MIN_GUARANTEE_MINUTES,0)        --varies between scheduler acl names.
 ,MIN_GUARANTEE_TYPE             = ISNULL(IG.MIN_GUARANTEE_TYPE,'')          --varies between scheduler acl names.
 ,AUTHORIZED_TO_INVOICE_TYPE     = ISNULL(IG.AUTHORIZED_TO_INVOICE_TYPE,'')  --varies between scheduler acl names.

 ,HAS_HOLIDAYS    = IG.HAS_HOLIDAYS
 ,INCLUDE_IN_CAS  = IG.INCLUDE_IN_CAS
 ,READY_FOR_XML   = IG.READY_FOR_XML
 ,SHOW_ID_EXTS    = IG.SHOW_ID_EXTS
 FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1		I
 LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_GROUPS	IG  ON IG.ID_EXT    = I.ID_EXT
												
--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1

/*
UPDATE WSOL_TB_IMPORTS_MONAT_INVOICING_1 SET
   INVOICE_ID         = CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END
  ,SCHEDULER_ACL_NAME = CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END
 FROM            WSOL_TB_IMPORTS_MONAT_INVOICING_1				AIA 
 LEFT JOIN       WSOL_TB_IMPORTS_MONAT_SD_AIA_STATIC_DEFAULTS	AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT
 */

--======================================================================
--	CHECK FOR BAD DATA FOUND IN IMPORT .CSV FILES:
--======================================================================
--	SELECT * FROM WSOL_TB_IMPORT_ERRORS_FOUND WHERE TENANT_KEY = 106
--======================================================================
DECLARE
 @ERR_CNT  INT
,@RCD_CNT  INT
,@MSG1     VARCHAR(2500)
SET @ERR_CNT  = 0 
SET @RCD_CNT  = 0 
SET @MSG1     = ''
--Check #1:  ==============================================================================================================================
	SET @RCD_CNT = (SELECT COUNT(*) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1)
	IF @RCD_CNT < 1 BEGIN
		SET @MSG1 = @MSG1 + 'ERROR!  File Import Failed.  No Records Were/Could Be Imported.   |   ' 
		SET @ERR_CNT = @ERR_CNT + 1
	END

--Check #2:  ==============================================================================================================================
	SET @RCD_CNT = (SELECT COUNT(*) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 WHERE STAFFED_SECS > 1800)
	IF @RCD_CNT > 1 BEGIN
		SET @MSG1 = @MSG1 + 'ERROR! Values Greater than 1800.  File Import Failed.  No Records Were/Could Be Imported.   |   ' 
		SET @ERR_CNT = @ERR_CNT + 1
	END

--=============================== INSERT INTO PERMANENT TABLE (No errors) OR SKIP AND GO TO END (Errors):
IF @ERR_CNT > 0 BEGIN
INSERT INTO WSOL_TB_IMPORT_ERRORS_FOUND
(
 TENANT_KEY
,SUB_GROUP_NAME
,ERROR_MSG)
	SELECT 
	 @TENANT_KEY			--TENANT_KEY
	,'EGENCIA_INVOICING'	--SUB_GROUP_NAME
	,@MSG1					--ERROR_MSG
	--===========================
	GOTO EARLY_EXIT
	--===========================
END
ELSE BEGIN
	--MUST RETURN AT LEAST ONE RECORD TO SSIS
INSERT INTO WSOL_TB_IMPORT_ERRORS_FOUND
(TENANT_KEY
,SUB_GROUP_NAME
,ERROR_MSG)
	SELECT 
	 @TENANT_KEY			--TENANT_KEY
	,'EGENCIA_INVOICING'	--SUB_GROUP_NAME
	,''						--ERROR_MSG
END

--===============================================
-- CALCULATE PAYMENT VALUES
--===============================================
-- SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_1
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 CPROD = CASE WHEN LINE_OF_BUSINESS IN ('Resource','SME')		THEN AUTHORIZED_RESOURCE_SECS
			  WHEN LINE_OF_BUSINESS IN ('C-Select','SAT','KEY') THEN AUTHORIZED_CSAT_SAT_KEY_SECS
			  ELSE 0.00 END

UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_1 SET
 MINIMUM_GUARANTEE  = CPROD
,AUTHORIZED_MINUTES	= CPROD

--SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_SA_WA
--=============================================
--UPDATE PERMANENT SA/WA TABLE
--=============================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_SA_WA SET
-- FF_LOGIN_ID						= W1.FF_LOGIN_ID
 FF_HOUR							= W1.FF_HOUR
,FF_STAFFED_TIME					= W1.FF_STAFFED_TIME
,FF_AVAIL_TIME						= W1.FF_AVAIL_TIME
,FF_ACD_TIME						= W1.FF_ACD_TIME
,FF_OTHER_TIME						= W1.FF_OTHER_TIME
,FF_ACW_TIME						= W1.FF_ACW_TIME
,FF_AGENT_RING_TIME					= W1.FF_AGENT_RING_TIME
,FF_AUX_TIME						= W1.FF_AUX_TIME
,FF_AUX_0_DEFAULT					= W1.FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK						= W1.FF_AUX_1_BREAK
,FF_AUX_2_COACHING					= W1.FF_AUX_2_COACHING
,FF_AUX_3_MEETING					= W1.FF_AUX_3_MEETING
,FF_AUX_4_PROJECT					= W1.FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING				= W1.FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND					= W1.FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL						= W1.FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK				= W1.FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN				= W1.FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE					= W1.FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL					= W1.FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12					= W1.FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13					= W1.FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14					= W1.FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15					= W1.FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16					= W1.FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17					= W1.FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18					= W1.FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19					= W1.FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20					= W1.FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21					= W1.FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22					= W1.FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23					= W1.FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24					= W1.FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25					= W1.FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26					= W1.FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27					= W1.FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28					= W1.FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29					= W1.FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30					= W1.FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31					= W1.FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32					= W1.FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33					= W1.FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34					= W1.FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35					= W1.FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36					= W1.FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37					= W1.FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38					= W1.FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39					= W1.FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40					= W1.FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41					= W1.FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42					= W1.FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43					= W1.FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44					= W1.FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45					= W1.FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46					= W1.FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47					= W1.FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48					= W1.FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49					= W1.FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50					= W1.FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51					= W1.FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52					= W1.FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53					= W1.FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54					= W1.FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55					= W1.FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56					= W1.FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57					= W1.FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58					= W1.FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59					= W1.FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60					= W1.FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61					= W1.FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62					= W1.FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63					= W1.FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64					= W1.FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65					= W1.FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66					= W1.FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67					= W1.FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68					= W1.FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69					= W1.FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70					= W1.FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71					= W1.FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72					= W1.FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73					= W1.FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74					= W1.FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75					= W1.FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76					= W1.FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77					= W1.FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78					= W1.FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79					= W1.FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80					= W1.FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81					= W1.FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82					= W1.FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83					= W1.FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84					= W1.FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85					= W1.FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86					= W1.FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87					= W1.FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88					= W1.FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89					= W1.FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90					= W1.FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91					= W1.FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92					= W1.FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93					= W1.FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94					= W1.FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95					= W1.FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96					= W1.FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97					= W1.FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98					= W1.FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99					= W1.FF_TI_AUXTIME_99
,CMS_GROUP							= W1.CMS_GROUP
,DATA_DATE							= W1.DATA_DATE
,DATETIME_CT						= W1.DATETIME_CT
,DATETIME_PT						= W1.DATETIME_PT
,[DATETIME]							= W1.[DATETIME]
,HOUR_INTERVAL						= W1.HOUR_INTERVAL
,RESOURCE_NAME						= W1.RESOURCE_NAME
,STAFFED_SECS						= W1.STAFFED_SECS
,AVAILABLE_SECS						= W1.AVAILABLE_SECS
,ACD_SECS							= W1.ACD_SECS
,OTHER_SECS							= W1.OTHER_SECS
,ACW_SECS							= W1.ACW_SECS
,RING_SECS							= W1.RING_SECS
,AUX_0_DEFAULT_SECS					= W1.AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS					= W1.AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS				= W1.AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS					= W1.AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS					= W1.AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS			= W1.AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS				= W1.AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS					= W1.AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS				= W1.AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS				= W1.AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS				= W1.AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS				= W1.AUX_11_PERSONAL_SECS
,AUX_34_SECS						= W1.AUX_34_SECS
,AUX_35_SECS						= W1.AUX_35_SECS
,AUX_37_SECS						= W1.AUX_37_SECS
,AUX_40_SECS						= W1.AUX_40_SECS
,OUTBOUND_SECS						= W1.OUTBOUND_SECS
,EMAIL_SECS							= W1.EMAIL_SECS
,PROJECT_SECS						= W1.PROJECT_SECS
,MEETING_SECS						= W1.MEETING_SECS
,TOTAL_AUX_SECS						= W1.TOTAL_AUX_SECS
,PROD_BILLING_SECS					= W1.PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS		= W1.AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS			= W1.AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS					= W1.LINE_OF_BUSINESS
,WEEKEND							= W1.WEEKEND
,CPROD								= W1.CPROD
,MINIMUM_GUARANTEE					= W1.MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES					= W1.AUTHORIZED_MINUTES
,[EMAIL]							= W1.EMAIL
--,ID_EXT							= W1.ID_EXT
,SCHEDULER_ACL_NAME					= W1.SCHEDULER_ACL_NAME
--,STD_TENANT_START_DATE_TIME_KEY	= W1.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W1.CAL_DATE
,TENANT_KEY							= W1.TENANT_KEY
,AIR_DAY_TYPE						= W1.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W1.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES				= W1.MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE					= W1.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W1.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W1.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W1.INCLUDE_IN_CAS
,READY_FOR_XML						= W1.READY_FOR_XML
,SHOW_ID_EXTS						= W1.SHOW_ID_EXTS
,INVOICE_ID							= W1.INVOICE_ID

,SEQNO_ADDED_TIME					= W1.SEQNO_ADDED_TIME
,SEQNO								= W1.SEQNO
,FTP_FILE_NAME						= W1.FTP_FILE_NAME

--,WS_ROW_CREATED_TIME				= NULL
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

--  SELECT *
FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1  W1
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SA_WA		 G   ON G.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
														AND G.ID_EXT                         = W1.ID_EXT
														AND G.FF_LOGIN_ID					 = W1.FF_LOGIN_ID

----Where Permanent table key fields match Work table key fields - then we want to update non-key fields!!!:
WHERE G.STD_TENANT_START_DATE_TIME_KEY	= W1.STD_TENANT_START_DATE_TIME_KEY
  AND G.ID_EXT							= W1.ID_EXT
  AND G.FF_LOGIN_ID						= W1.FF_LOGIN_ID

--=============================================
--INSERT INTO PERMANENT SA/WA IMPORT TABLE:
--=============================================
INSERT INTO WSOL_TB_IMPORTS_EGENCIA_SA_WA
(
 FF_LOGIN_ID
,FF_HOUR
,FF_STAFFED_TIME
,FF_AVAIL_TIME
,FF_ACD_TIME
,FF_OTHER_TIME
,FF_ACW_TIME
,FF_AGENT_RING_TIME
,FF_AUX_TIME
,FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK
,FF_AUX_2_COACHING
,FF_AUX_3_MEETING
,FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99
,CMS_GROUP
,DATA_DATE
,DATETIME_CT
,DATETIME_PT
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,STAFFED_SECS
,AVAILABLE_SECS
,ACD_SECS
,OTHER_SECS
,ACW_SECS
,RING_SECS
,AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS
,AUX_34_SECS
,AUX_35_SECS
,AUX_37_SECS
,AUX_40_SECS
,OUTBOUND_SECS
,EMAIL_SECS
,PROJECT_SECS
,MEETING_SECS
,TOTAL_AUX_SECS
,PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS
,WEEKEND
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,[EMAIL]
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME
)
SELECT
 W1.FF_LOGIN_ID
,W1.FF_HOUR
,W1.FF_STAFFED_TIME
,W1.FF_AVAIL_TIME
,W1.FF_ACD_TIME
,W1.FF_OTHER_TIME
,W1.FF_ACW_TIME
,W1.FF_AGENT_RING_TIME
,W1.FF_AUX_TIME
,W1.FF_AUX_0_DEFAULT
,W1.FF_AUX_1_BREAK
,W1.FF_AUX_2_COACHING
,W1.FF_AUX_3_MEETING
,W1.FF_AUX_4_PROJECT
,W1.FF_AUX_5_EGE_TRAINING
,W1.FF_AUX_6_OUTBOUND
,W1.FF_AUX_7_EMAIL
,W1.FF_AUX_8_QUEUE_WORK
,W1.FF_AUX_9_SYSTEM_DOWN
,W1.FF_AUX_10_EXCHANGE
,W1.FF_AUX_11_PERSONAL
,W1.FF_TI_AUXTIME_12
,W1.FF_TI_AUXTIME_13
,W1.FF_TI_AUXTIME_14
,W1.FF_TI_AUXTIME_15
,W1.FF_TI_AUXTIME_16
,W1.FF_TI_AUXTIME_17
,W1.FF_TI_AUXTIME_18
,W1.FF_TI_AUXTIME_19
,W1.FF_TI_AUXTIME_20
,W1.FF_TI_AUXTIME_21
,W1.FF_TI_AUXTIME_22
,W1.FF_TI_AUXTIME_23
,W1.FF_TI_AUXTIME_24
,W1.FF_TI_AUXTIME_25
,W1.FF_TI_AUXTIME_26
,W1.FF_TI_AUXTIME_27
,W1.FF_TI_AUXTIME_28
,W1.FF_TI_AUXTIME_29
,W1.FF_TI_AUXTIME_30
,W1.FF_TI_AUXTIME_31
,W1.FF_TI_AUXTIME_32
,W1.FF_TI_AUXTIME_33
,W1.FF_TI_AUXTIME_34
,W1.FF_TI_AUXTIME_35
,W1.FF_TI_AUXTIME_36
,W1.FF_TI_AUXTIME_37
,W1.FF_TI_AUXTIME_38
,W1.FF_TI_AUXTIME_39
,W1.FF_TI_AUXTIME_40
,W1.FF_TI_AUXTIME_41
,W1.FF_TI_AUXTIME_42
,W1.FF_TI_AUXTIME_43
,W1.FF_TI_AUXTIME_44
,W1.FF_TI_AUXTIME_45
,W1.FF_TI_AUXTIME_46
,W1.FF_TI_AUXTIME_47
,W1.FF_TI_AUXTIME_48
,W1.FF_TI_AUXTIME_49
,W1.FF_TI_AUXTIME_50
,W1.FF_TI_AUXTIME_51
,W1.FF_TI_AUXTIME_52
,W1.FF_TI_AUXTIME_53
,W1.FF_TI_AUXTIME_54
,W1.FF_TI_AUXTIME_55
,W1.FF_TI_AUXTIME_56
,W1.FF_TI_AUXTIME_57
,W1.FF_TI_AUXTIME_58
,W1.FF_TI_AUXTIME_59
,W1.FF_TI_AUXTIME_60
,W1.FF_TI_AUXTIME_61
,W1.FF_TI_AUXTIME_62
,W1.FF_TI_AUXTIME_63
,W1.FF_TI_AUXTIME_64
,W1.FF_TI_AUXTIME_65
,W1.FF_TI_AUXTIME_66
,W1.FF_TI_AUXTIME_67
,W1.FF_TI_AUXTIME_68
,W1.FF_TI_AUXTIME_69
,W1.FF_TI_AUXTIME_70
,W1.FF_TI_AUXTIME_71
,W1.FF_TI_AUXTIME_72
,W1.FF_TI_AUXTIME_73
,W1.FF_TI_AUXTIME_74
,W1.FF_TI_AUXTIME_75
,W1.FF_TI_AUXTIME_76
,W1.FF_TI_AUXTIME_77
,W1.FF_TI_AUXTIME_78
,W1.FF_TI_AUXTIME_79
,W1.FF_TI_AUXTIME_80
,W1.FF_TI_AUXTIME_81
,W1.FF_TI_AUXTIME_82
,W1.FF_TI_AUXTIME_83
,W1.FF_TI_AUXTIME_84
,W1.FF_TI_AUXTIME_85
,W1.FF_TI_AUXTIME_86
,W1.FF_TI_AUXTIME_87
,W1.FF_TI_AUXTIME_88
,W1.FF_TI_AUXTIME_89
,W1.FF_TI_AUXTIME_90
,W1.FF_TI_AUXTIME_91
,W1.FF_TI_AUXTIME_92
,W1.FF_TI_AUXTIME_93
,W1.FF_TI_AUXTIME_94
,W1.FF_TI_AUXTIME_95
,W1.FF_TI_AUXTIME_96
,W1.FF_TI_AUXTIME_97
,W1.FF_TI_AUXTIME_98
,W1.FF_TI_AUXTIME_99
,W1.CMS_GROUP
,W1.DATA_DATE
,W1.DATETIME_CT
,W1.DATETIME_PT
,W1.[DATETIME]
,W1.HOUR_INTERVAL
,W1.RESOURCE_NAME
,W1.STAFFED_SECS
,W1.AVAILABLE_SECS
,W1.ACD_SECS
,W1.OTHER_SECS
,W1.ACW_SECS
,W1.RING_SECS
,W1.AUX_0_DEFAULT_SECS
,W1.AUX_1_BREAK_SECS
,W1.AUX_2_COACHING_SECS
,W1.AUX_3_MEETING_SECS
,W1.AUX_4_PROJECT_SECS
,W1.AUX_5_EGE_TRAINING_SECS
,W1.AUX_6_OUTBOUND_SECS
,W1.AUX_7_EMAIL_SECS
,W1.AUX_8_QUEUE_WORK_SECS
,W1.AUX_9_SYSTEM_DOWN_SECS
,W1.AUX_10_EXCHANGE_SECS
,W1.AUX_11_PERSONAL_SECS
,W1.AUX_34_SECS
,W1.AUX_35_SECS
,W1.AUX_37_SECS
,W1.AUX_40_SECS
,W1.OUTBOUND_SECS
,W1.EMAIL_SECS
,W1.PROJECT_SECS
,W1.MEETING_SECS
,W1.TOTAL_AUX_SECS
,W1.PROD_BILLING_SECS
,W1.AUTHORIZED_CSAT_SAT_KEY_SECS
,W1.AUTHORIZED_RESOURCE_SECS
,W1.LINE_OF_BUSINESS
,W1.WEEKEND
,W1.CPROD
,W1.MINIMUM_GUARANTEE
,W1.AUTHORIZED_MINUTES
,W1.[EMAIL]
,W1.ID_EXT
,W1.SCHEDULER_ACL_NAME
,W1.STD_TENANT_START_DATE_TIME_KEY
,W1.CAL_DATE
,W1.TENANT_KEY
,W1.AIR_DAY_TYPE
,W1.AIR_ACW_FONT_COLOR
,W1.MIN_GUARANTEE_MINUTES
,W1.MIN_GUARANTEE_TYPE
,W1.AUTHORIZED_TO_INVOICE_TYPE
,W1.HAS_HOLIDAYS
,W1.INCLUDE_IN_CAS
,W1.READY_FOR_XML
,W1.SHOW_ID_EXTS
,W1.INVOICE_ID
,W1.SEQNO_ADDED_TIME
,W1.SEQNO
,W1.FTP_FILE_NAME
,@WS_ROW_CREATED_TIME    --[WS_ROW_CREATED_TIME] [datetime] NOT NULL,
,NULL                    --[WS_ROW_UPDATED_TIME] [datetime] NULL,

FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1  W1

LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_SA_WA		 G   ON G.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
														AND G.ID_EXT                         = W1.ID_EXT
														AND G.FF_LOGIN_ID					 = W1.FF_LOGIN_ID

WHERE (G.FF_LOGIN_ID					IS NULL AND ISNULL(W1.FF_LOGIN_ID					,'') <> '' )
  AND (G.STD_TENANT_START_DATE_TIME_KEY	IS NULL AND ISNULL(W1.STD_TENANT_START_DATE_TIME_KEY, 0) <>  0 )
--AND (G.INVOICE_ID						IS NULL AND ISNULL(W1.INVOICE_ID					,'') <> '' )			
--AND (G.ID_EXT							IS NULL AND ISNULL(W1.ID_EXT						,'') <> '' )

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_SA_WA ORDER BY SEQNO

--=============================================================================
--	GROUP DATA IN HOURLY INTERVALS
--=============================================================================
DELETE FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_2

INSERT INTO WSOL_TB_IMPORTS_EGENCIA_INVOICING_2
(
 FF_LOGIN_ID
,FF_HOUR
,FF_STAFFED_TIME
,FF_AVAIL_TIME
,FF_ACD_TIME
,FF_OTHER_TIME
,FF_ACW_TIME
,FF_AGENT_RING_TIME
,FF_AUX_TIME
,FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK
,FF_AUX_2_COACHING
,FF_AUX_3_MEETING
,FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99
,CMS_GROUP
,DATA_DATE
,DATETIME_CT
,DATETIME_PT
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,STAFFED_SECS
,AVAILABLE_SECS
,ACD_SECS
,OTHER_SECS
,ACW_SECS
,RING_SECS
,AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS
,AUX_34_SECS
,AUX_35_SECS
,AUX_37_SECS
,AUX_40_SECS
,OUTBOUND_SECS
,EMAIL_SECS
,PROJECT_SECS
,MEETING_SECS
,TOTAL_AUX_SECS
,PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS
,WEEKEND
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,[EMAIL]
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME
)
SELECT
 W1.FF_LOGIN_ID
,NULL																--AS FF_HOUR
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_STAFFED_TIME		AS INT)))	--AS FF_STAFFED_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AVAIL_TIME			AS INT)))	--AS FF_AVAIL_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_ACD_TIME			AS INT)))	--AS FF_ACD_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_OTHER_TIME			AS INT)))	--AS FF_OTHER_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_ACW_TIME			AS INT)))	--AS FF_ACW_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AGENT_RING_TIME	AS INT)))	--AS FF_AGENT_RING_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_TIME			AS INT)))	--AS FF_AUX_TIME
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_0_DEFAULT		AS INT)))	--AS FF_AUX_0_DEFAULT
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_1_BREAK		AS INT)))	--AS FF_AUX_1_BREAK
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_2_COACHING		AS INT)))	--AS FF_AUX_2_COACHING
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_3_MEETING		AS INT)))	--AS FF_AUX_3_MEETING
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_4_PROJECT		AS INT)))	--AS FF_AUX_4_PROJECT
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_5_EGE_TRAINING	AS INT)))	--AS FF_AUX_5_EGE_TRAINING
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_6_OUTBOUND		AS INT)))	--AS FF_AUX_6_OUTBOUND
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_7_EMAIL		AS INT)))	--AS FF_AUX_7_EMAIL
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_8_QUEUE_WORK	AS INT)))	--AS FF_AUX_8_QUEUE_WORK
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_9_SYSTEM_DOWN	AS INT)))	--AS FF_AUX_9_SYSTEM_DOWN
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_10_EXCHANGE	AS INT)))	--AS FF_AUX_10_EXCHANGE
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_AUX_11_PERSONAL	AS INT)))	--AS FF_AUX_11_PERSONAL
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_12		AS INT)))	--AS FF_TI_AUXTIME_12
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_13		AS INT)))	--AS FF_TI_AUXTIME_13
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_14		AS INT)))	--AS FF_TI_AUXTIME_14
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_15		AS INT)))	--AS FF_TI_AUXTIME_15
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_16		AS INT)))	--AS FF_TI_AUXTIME_16
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_17		AS INT)))	--AS FF_TI_AUXTIME_17
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_18		AS INT)))	--AS FF_TI_AUXTIME_18
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_19		AS INT)))	--AS FF_TI_AUXTIME_19
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_20		AS INT)))	--AS FF_TI_AUXTIME_20
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_21		AS INT)))	--AS FF_TI_AUXTIME_21
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_22		AS INT)))	--AS FF_TI_AUXTIME_22
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_23		AS INT)))	--AS FF_TI_AUXTIME_23
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_24		AS INT)))	--AS FF_TI_AUXTIME_24
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_25		AS INT)))	--AS FF_TI_AUXTIME_25
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_26		AS INT)))	--AS FF_TI_AUXTIME_26
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_27		AS INT)))	--AS FF_TI_AUXTIME_27
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_28		AS INT)))	--AS FF_TI_AUXTIME_28
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_29		AS INT)))	--AS FF_TI_AUXTIME_29
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_30		AS INT)))	--AS FF_TI_AUXTIME_30
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_31		AS INT)))	--AS FF_TI_AUXTIME_31
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_32		AS INT)))	--AS FF_TI_AUXTIME_32
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_33		AS INT)))	--AS FF_TI_AUXTIME_33
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_34		AS INT)))	--AS FF_TI_AUXTIME_34
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_35		AS INT)))	--AS FF_TI_AUXTIME_35
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_36		AS INT)))	--AS FF_TI_AUXTIME_36
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_37		AS INT)))	--AS FF_TI_AUXTIME_37
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_38		AS INT)))	--AS FF_TI_AUXTIME_38
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_39		AS INT)))	--AS FF_TI_AUXTIME_39
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_40		AS INT)))	--AS FF_TI_AUXTIME_40
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_41		AS INT)))	--AS FF_TI_AUXTIME_41
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_42		AS INT)))	--AS FF_TI_AUXTIME_42
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_43		AS INT)))	--AS FF_TI_AUXTIME_43
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_44		AS INT)))	--AS FF_TI_AUXTIME_44
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_45		AS INT)))	--AS FF_TI_AUXTIME_45
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_46		AS INT)))	--AS FF_TI_AUXTIME_46
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_47		AS INT)))	--AS FF_TI_AUXTIME_47
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_48		AS INT)))	--AS FF_TI_AUXTIME_48
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_49		AS INT)))	--AS FF_TI_AUXTIME_49
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_50		AS INT)))	--AS FF_TI_AUXTIME_50
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_51		AS INT)))	--AS FF_TI_AUXTIME_51
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_52		AS INT)))	--AS FF_TI_AUXTIME_52
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_53		AS INT)))	--AS FF_TI_AUXTIME_53
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_54		AS INT)))	--AS FF_TI_AUXTIME_54
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_55		AS INT)))	--AS FF_TI_AUXTIME_55
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_56		AS INT)))	--AS FF_TI_AUXTIME_56
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_57		AS INT)))	--AS FF_TI_AUXTIME_57
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_58		AS INT)))	--AS FF_TI_AUXTIME_58
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_59		AS INT)))	--AS FF_TI_AUXTIME_59
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_60		AS INT)))	--AS FF_TI_AUXTIME_60																										
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_61		AS INT)))	--AS FF_TI_AUXTIME_61
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_62		AS INT)))	--AS FF_TI_AUXTIME_62
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_63		AS INT)))	--AS FF_TI_AUXTIME_63
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_64		AS INT)))	--AS FF_TI_AUXTIME_64
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_65		AS INT)))	--AS FF_TI_AUXTIME_65
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_66		AS INT)))	--AS FF_TI_AUXTIME_66
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_67		AS INT)))	--AS FF_TI_AUXTIME_67
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_68		AS INT)))	--AS FF_TI_AUXTIME_68
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_69		AS INT)))	--AS FF_TI_AUXTIME_69
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_70		AS INT)))	--AS FF_TI_AUXTIME_70																										
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_71		AS INT)))	--AS FF_TI_AUXTIME_71
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_72		AS INT)))	--AS FF_TI_AUXTIME_72
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_73		AS INT)))	--AS FF_TI_AUXTIME_73
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_74		AS INT)))	--AS FF_TI_AUXTIME_74
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_75		AS INT)))	--AS FF_TI_AUXTIME_75
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_76		AS INT)))	--AS FF_TI_AUXTIME_76
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_77		AS INT)))	--AS FF_TI_AUXTIME_77
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_78		AS INT)))	--AS FF_TI_AUXTIME_78
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_79		AS INT)))	--AS FF_TI_AUXTIME_79
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_80		AS INT)))	--AS FF_TI_AUXTIME_80																										
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_81		AS INT)))	--AS FF_TI_AUXTIME_81
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_82		AS INT)))	--AS FF_TI_AUXTIME_82
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_83		AS INT)))	--AS FF_TI_AUXTIME_83
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_84		AS INT)))	--AS FF_TI_AUXTIME_84
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_85		AS INT)))	--AS FF_TI_AUXTIME_85
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_86		AS INT)))	--AS FF_TI_AUXTIME_86
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_87		AS INT)))	--AS FF_TI_AUXTIME_87
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_88		AS INT)))	--AS FF_TI_AUXTIME_88
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_89		AS INT)))	--AS FF_TI_AUXTIME_89
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_90		AS INT)))	--AS FF_TI_AUXTIME_90																										
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_91		AS INT)))	--AS FF_TI_AUXTIME_91
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_92		AS INT)))	--AS FF_TI_AUXTIME_92
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_93		AS INT)))	--AS FF_TI_AUXTIME_93
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_94		AS INT)))	--AS FF_TI_AUXTIME_94
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_95		AS INT)))	--AS FF_TI_AUXTIME_95
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_96		AS INT)))	--AS FF_TI_AUXTIME_96
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_97		AS INT)))	--AS FF_TI_AUXTIME_97
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_98		AS INT)))	--AS FF_TI_AUXTIME_98
,CONVERT(VARCHAR(50), SUM(CAST(W1.FF_TI_AUXTIME_99		AS INT)))	--AS FF_TI_AUXTIME_99
,MAX(ISNULL(W1.CMS_GROUP,''))										--AS CMS_GROUP
,W1.DATA_DATE
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		DATEADD(HH,+2,CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME))
	  ELSE
		DATEADD(HH,+2,CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME))
	  END											--AS DATETIME_CT
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME)
	  ELSE
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME)
	  END											--AS DATETIME_PT
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME)
	  ELSE
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME)
	  END											--AS DATETIME
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST(LEFT(W1.FF_HOUR,1) AS INT)
	  ELSE
		CAST(LEFT(W1.FF_HOUR,2) AS INT)
	  END											--AS HOUR_INTERVAL
,MAX(ISNULL(W1.RESOURCE_NAME				,''))	--AS RESOURCE_NAME
,SUM(ISNULL(W1.STAFFED_SECS					,0.00))	--AS STAFFED_SECS																										
,SUM(ISNULL(W1.AVAILABLE_SECS				,0.00))	--AS AVAILABLE_SECS																										
,SUM(ISNULL(W1.ACD_SECS						,0.00))	--AS ACD_SECS
,SUM(ISNULL(W1.OTHER_SECS					,0.00))	--AS OTHER_SECS
,SUM(ISNULL(W1.ACW_SECS						,0.00))	--AS ACW_SECS
,SUM(ISNULL(W1.RING_SECS					,0.00))	--AS RING_SECS
,SUM(ISNULL(W1.AUX_0_DEFAULT_SECS			,0.00))	--AS AUX_0_DEFAULT_SECS
,SUM(ISNULL(W1.AUX_1_BREAK_SECS				,0.00))	--AS AUX_1_BREAK_SECS
,SUM(ISNULL(W1.AUX_2_COACHING_SECS			,0.00))	--AS AUX_2_COACHING_SECS
,SUM(ISNULL(W1.AUX_3_MEETING_SECS			,0.00))	--AS AUX_3_MEETING_SECS
,SUM(ISNULL(W1.AUX_4_PROJECT_SECS			,0.00))	--AS AUX_4_PROJECT_SECS
,SUM(ISNULL(W1.AUX_5_EGE_TRAINING_SECS		,0.00))	--AS AUX_5_EGE_TRAINING_SECS
,SUM(ISNULL(W1.AUX_6_OUTBOUND_SECS			,0.00))	--AS AUX_6_OUTBOUND_SECS
,SUM(ISNULL(W1.AUX_7_EMAIL_SECS				,0.00))	--AS AUX_7_EMAIL_SECS
,SUM(ISNULL(W1.AUX_8_QUEUE_WORK_SECS		,0.00))	--AS AUX_8_QUEUE_WORK_SECS
,SUM(ISNULL(W1.AUX_9_SYSTEM_DOWN_SECS		,0.00))	--AS AUX_9_SYSTEM_DOWN_SECS
,SUM(ISNULL(W1.AUX_10_EXCHANGE_SECS			,0.00))	--AS AUX_10_EXCHANGE_SECS
,SUM(ISNULL(W1.AUX_11_PERSONAL_SECS			,0.00))	--AS AUX_11_PERSONAL_SECS
,SUM(ISNULL(W1.AUX_34_SECS					,0.00))	--AS AUX_34_SECS
,SUM(ISNULL(W1.AUX_35_SECS					,0.00))	--AS AUX_35_SECS
,SUM(ISNULL(W1.AUX_37_SECS					,0.00))	--AS AUX_37_SECS
,SUM(ISNULL(W1.AUX_40_SECS					,0.00))	--AS AUX_40_SECS
,SUM(ISNULL(W1.OUTBOUND_SECS				,0.00))	--AS OUTBOUND_SECS
,SUM(ISNULL(W1.EMAIL_SECS					,0.00))	--AS EMAIL_SECS
,SUM(ISNULL(W1.PROJECT_SECS					,0.00))	--AS PROJECT_SECS
,SUM(ISNULL(W1.MEETING_SECS					,0.00))	--AS MEETING_SECS
,SUM(ISNULL(W1.TOTAL_AUX_SECS				,0.00))	--AS TOTAL_AUX_SECS
,SUM(ISNULL(W1.PROD_BILLING_SECS			,0.00))	--AS PROD_BILLING_SECS
,SUM(ISNULL(W1.AUTHORIZED_CSAT_SAT_KEY_SECS	,0.00))	--AS AUTHORIZED_CSAT_SAT_KEY_SECS
,SUM(ISNULL(W1.AUTHORIZED_RESOURCE_SECS		,0.00))	--AS AURHORIZED_RESOURCE_SECS
,MAX(ISNULL(W1.LINE_OF_BUSINESS				,''))	--AS LINE_OF_BUSINESS
,MAX(ISNULL(W1.WEEKEND						,''))	--AS WEEKEND
,SUM(ISNULL(W1.CPROD						,0.00))	--AS CPROD
,SUM(ISNULL(W1.MINIMUM_GUARANTEE			,0.00))	--AS MINIMUM_GUARANTEE
,SUM(ISNULL(W1.AUTHORIZED_MINUTES			,0.00))	--AS AUTHORIZED_MINUTES
,MAX(ISNULL(W1.[EMAIL],''))							--AS EMAIL
,W1.ID_EXT
,MAX(ISNULL(W1.SCHEDULER_ACL_NAME,''))				--AS SCHEDULER_ACL_NAME
,NULL												--AS STD_TENANT_START_DATE_TIME_KEY
,NULL												--AS CAL_DATE
,MAX(ISNULL(W1.TENANT_KEY,0))						--AS TENANT_KEY
,MIN(ISNULL(W1.AIR_DAY_TYPE,''))					--AS AIR_DAY_TYPE
,MAX(ISNULL(W1.AIR_ACW_FONT_COLOR,''))				--AS AIR_ACW_FONT_COLOR
,MAX(ISNULL(W1.MIN_GUARANTEE_MINUTES,0.000))		--AS MIN_GUARANTEE_MINUTES
,MAX(ISNULL(W1.MIN_GUARANTEE_TYPE,''))				--AS MIN_GUARANTEE_TYPE
,MAX(ISNULL(W1.AUTHORIZED_TO_INVOICE_TYPE,''))		--AS AUTHORIZED_TO_INVOICE_TYPE
,MIN(ISNULL(W1.HAS_HOLIDAYS,''))					--AS HAS_HOLIDAYS
,MIN(ISNULL(W1.INCLUDE_IN_CAS,''))					--AS INCLUDE_IN_CAS
,MIN(ISNULL(W1.READY_FOR_XML,''))					--AS READY_FOR_XML
,MIN(ISNULL(W1.SHOW_ID_EXTS,''))					--AS SHOW_ID_EXTS
,MIN(ISNULL(W1.INVOICE_ID,''))						--AS INVOICE_ID
,MAX(W1.SEQNO_ADDED_TIME)							--AS SEQNO_ADDED_TIME
,MIN(W1.SEQNO)										--AS SEQNO
,MAX(W1.FTP_FILE_NAME)								--AS FTP_FILE_NAME
,@WS_ROW_CREATED_TIME								--[WS_ROW_CREATED_TIME] [datetime] NOT NULL,
,NULL												--[WS_ROW_UPDATED_TIME] [datetime] NULL,

FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_1  W1

GROUP BY
 W1.FF_LOGIN_ID
,W1.DATA_DATE
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		DATEADD(HH,+2,CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME))
	  ELSE
		DATEADD(HH,+2,CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME))
	  END											--AS DATETIME_CT
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME)
	  ELSE
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME)
	  END											--AS DATETIME_PT
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,1) + ':00:00') AS DATETIME)
	  ELSE
		CAST((W1.DATA_DATE + ' ' + LEFT(W1.FF_HOUR,2) + ':00:00') AS DATETIME)
	  END											--AS DATETIME
,CASE WHEN CHARINDEX(':',W1.FF_HOUR) = 2 THEN
		CAST(LEFT(W1.FF_HOUR,1) AS INT)
	  ELSE
		CAST(LEFT(W1.FF_HOUR,2) AS INT)
	  END											--AS HOUR_INTERVAL
,W1.ID_EXT

ORDER BY
 MIN(W1.SEQNO)

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_2 ORDER BY SEQNO

--===================================================================================================
--	UPDATE DATETIME KEY
--===================================================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING_2 SET
 STD_TENANT_START_DATE_TIME_KEY = DT.DATE_TIME_KEY
FROM		WSOL_TB_IMPORTS_EGENCIA_INVOICING_2	I
INNER JOIN	DATE_TIME							DT	ON DT.CAL_DATE = I.DATETIME_PT

--===============================================
SET DATEFIRST 1  -- = Monday  
--===============================================
DECLARE 
 @DTM_BEG  DATETIME
,@DTM_END  DATETIME
,@DTM_MAX  DATETIME

SET @DTM_BEG = DATEADD(hh,-2,(SELECT MIN([DATETIME]) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_2))
SET @DTM_END = DATEADD(hh, 2,(SELECT MAX([DATETIME]) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_2))
SET @DTM_MAX = DATEADD(hh, 0,(SELECT MAX([DATETIME]) FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING_2))

--SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING
--=============================================
--UPDATE PERMANENT INVOICE TABLE
--=============================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_INVOICING SET
-- FF_LOGIN_ID						= W2.FF_LOGIN_ID
 FF_HOUR							= W2.FF_HOUR
,FF_STAFFED_TIME					= W2.FF_STAFFED_TIME
,FF_AVAIL_TIME						= W2.FF_AVAIL_TIME
,FF_ACD_TIME						= W2.FF_ACD_TIME
,FF_OTHER_TIME						= W2.FF_OTHER_TIME
,FF_ACW_TIME						= W2.FF_ACW_TIME
,FF_AGENT_RING_TIME					= W2.FF_AGENT_RING_TIME
,FF_AUX_TIME						= W2.FF_AUX_TIME
,FF_AUX_0_DEFAULT					= W2.FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK						= W2.FF_AUX_1_BREAK
,FF_AUX_2_COACHING					= W2.FF_AUX_2_COACHING
,FF_AUX_3_MEETING					= W2.FF_AUX_3_MEETING
,FF_AUX_4_PROJECT					= W2.FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING				= W2.FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND					= W2.FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL						= W2.FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK				= W2.FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN				= W2.FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE					= W2.FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL					= W2.FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12					= W2.FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13					= W2.FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14					= W2.FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15					= W2.FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16					= W2.FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17					= W2.FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18					= W2.FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19					= W2.FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20					= W2.FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21					= W2.FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22					= W2.FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23					= W2.FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24					= W2.FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25					= W2.FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26					= W2.FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27					= W2.FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28					= W2.FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29					= W2.FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30					= W2.FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31					= W2.FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32					= W2.FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33					= W2.FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34					= W2.FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35					= W2.FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36					= W2.FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37					= W2.FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38					= W2.FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39					= W2.FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40					= W2.FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41					= W2.FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42					= W2.FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43					= W2.FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44					= W2.FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45					= W2.FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46					= W2.FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47					= W2.FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48					= W2.FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49					= W2.FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50					= W2.FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51					= W2.FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52					= W2.FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53					= W2.FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54					= W2.FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55					= W2.FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56					= W2.FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57					= W2.FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58					= W2.FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59					= W2.FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60					= W2.FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61					= W2.FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62					= W2.FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63					= W2.FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64					= W2.FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65					= W2.FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66					= W2.FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67					= W2.FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68					= W2.FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69					= W2.FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70					= W2.FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71					= W2.FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72					= W2.FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73					= W2.FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74					= W2.FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75					= W2.FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76					= W2.FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77					= W2.FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78					= W2.FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79					= W2.FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80					= W2.FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81					= W2.FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82					= W2.FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83					= W2.FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84					= W2.FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85					= W2.FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86					= W2.FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87					= W2.FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88					= W2.FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89					= W2.FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90					= W2.FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91					= W2.FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92					= W2.FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93					= W2.FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94					= W2.FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95					= W2.FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96					= W2.FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97					= W2.FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98					= W2.FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99					= W2.FF_TI_AUXTIME_99
,CMS_GROUP							= W2.CMS_GROUP
,DATA_DATE							= W2.DATA_DATE
,DATETIME_CT						= W2.DATETIME_CT
,DATETIME_PT						= W2.DATETIME_PT
,[DATETIME]							= W2.[DATETIME]
,HOUR_INTERVAL						= W2.HOUR_INTERVAL
,RESOURCE_NAME						= W2.RESOURCE_NAME
,STAFFED_SECS						= W2.STAFFED_SECS
,AVAILABLE_SECS						= W2.AVAILABLE_SECS
,ACD_SECS							= W2.ACD_SECS
,OTHER_SECS							= W2.OTHER_SECS
,ACW_SECS							= W2.ACW_SECS
,RING_SECS							= W2.RING_SECS
,AUX_0_DEFAULT_SECS					= W2.AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS					= W2.AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS				= W2.AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS					= W2.AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS					= W2.AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS			= W2.AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS				= W2.AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS					= W2.AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS				= W2.AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS				= W2.AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS				= W2.AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS				= W2.AUX_11_PERSONAL_SECS
,AUX_34_SECS						= W2.AUX_34_SECS
,AUX_35_SECS						= W2.AUX_35_SECS
,AUX_37_SECS						= W2.AUX_37_SECS
,AUX_40_SECS						= W2.AUX_40_SECS
,OUTBOUND_SECS						= W2.OUTBOUND_SECS
,EMAIL_SECS							= W2.EMAIL_SECS
,PROJECT_SECS						= W2.PROJECT_SECS
,MEETING_SECS						= W2.MEETING_SECS
,TOTAL_AUX_SECS						= W2.TOTAL_AUX_SECS
,PROD_BILLING_SECS					= W2.PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS		= W2.AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS			= W2.AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS					= W2.LINE_OF_BUSINESS
,WEEKEND							= W2.WEEKEND
,CPROD								= W2.CPROD
,MINIMUM_GUARANTEE					= W2.MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES					= W2.AUTHORIZED_MINUTES
,[EMAIL]							= W2.EMAIL
--,ID_EXT							= W2.ID_EXT
,SCHEDULER_ACL_NAME					= W2.SCHEDULER_ACL_NAME
--,STD_TENANT_START_DATE_TIME_KEY	= W2.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W2.CAL_DATE
,TENANT_KEY							= W2.TENANT_KEY
,AIR_DAY_TYPE						= W2.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W2.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES				= W2.MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE					= W2.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W2.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W2.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W2.INCLUDE_IN_CAS
,READY_FOR_XML						= W2.READY_FOR_XML
,SHOW_ID_EXTS						= W2.SHOW_ID_EXTS
,INVOICE_ID							= W2.INVOICE_ID

,SEQNO_ADDED_TIME					= W2.SEQNO_ADDED_TIME
,SEQNO								= W2.SEQNO
,FTP_FILE_NAME						= W2.FTP_FILE_NAME

--,WS_ROW_CREATED_TIME				= NULL
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

--  SELECT *
FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_2  W2
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_INVOICING    G   ON G.STD_TENANT_START_DATE_TIME_KEY = W2.STD_TENANT_START_DATE_TIME_KEY
														AND G.ID_EXT                         = W2.ID_EXT
														AND G.FF_LOGIN_ID					 = W2.FF_LOGIN_ID

----Where Permanent table key fields match Work table key fields - then we want to update non-key fields!!!:
WHERE G.STD_TENANT_START_DATE_TIME_KEY	= W2.STD_TENANT_START_DATE_TIME_KEY
  AND G.ID_EXT							= W2.ID_EXT
  AND G.FF_LOGIN_ID						= W2.FF_LOGIN_ID

--=============================================
--INSERT INTO PERMANENT IMPORT TABLE:
--=============================================
INSERT INTO WSOL_TB_IMPORTS_EGENCIA_INVOICING
(
 FF_LOGIN_ID
,FF_HOUR
,FF_STAFFED_TIME
,FF_AVAIL_TIME
,FF_ACD_TIME
,FF_OTHER_TIME
,FF_ACW_TIME
,FF_AGENT_RING_TIME
,FF_AUX_TIME
,FF_AUX_0_DEFAULT
,FF_AUX_1_BREAK
,FF_AUX_2_COACHING
,FF_AUX_3_MEETING
,FF_AUX_4_PROJECT
,FF_AUX_5_EGE_TRAINING
,FF_AUX_6_OUTBOUND
,FF_AUX_7_EMAIL
,FF_AUX_8_QUEUE_WORK
,FF_AUX_9_SYSTEM_DOWN
,FF_AUX_10_EXCHANGE
,FF_AUX_11_PERSONAL
,FF_TI_AUXTIME_12
,FF_TI_AUXTIME_13
,FF_TI_AUXTIME_14
,FF_TI_AUXTIME_15
,FF_TI_AUXTIME_16
,FF_TI_AUXTIME_17
,FF_TI_AUXTIME_18
,FF_TI_AUXTIME_19
,FF_TI_AUXTIME_20
,FF_TI_AUXTIME_21
,FF_TI_AUXTIME_22
,FF_TI_AUXTIME_23
,FF_TI_AUXTIME_24
,FF_TI_AUXTIME_25
,FF_TI_AUXTIME_26
,FF_TI_AUXTIME_27
,FF_TI_AUXTIME_28
,FF_TI_AUXTIME_29
,FF_TI_AUXTIME_30
,FF_TI_AUXTIME_31
,FF_TI_AUXTIME_32
,FF_TI_AUXTIME_33
,FF_TI_AUXTIME_34
,FF_TI_AUXTIME_35
,FF_TI_AUXTIME_36
,FF_TI_AUXTIME_37
,FF_TI_AUXTIME_38
,FF_TI_AUXTIME_39
,FF_TI_AUXTIME_40
,FF_TI_AUXTIME_41
,FF_TI_AUXTIME_42
,FF_TI_AUXTIME_43
,FF_TI_AUXTIME_44
,FF_TI_AUXTIME_45
,FF_TI_AUXTIME_46
,FF_TI_AUXTIME_47
,FF_TI_AUXTIME_48
,FF_TI_AUXTIME_49
,FF_TI_AUXTIME_50
,FF_TI_AUXTIME_51
,FF_TI_AUXTIME_52
,FF_TI_AUXTIME_53
,FF_TI_AUXTIME_54
,FF_TI_AUXTIME_55
,FF_TI_AUXTIME_56
,FF_TI_AUXTIME_57
,FF_TI_AUXTIME_58
,FF_TI_AUXTIME_59
,FF_TI_AUXTIME_60
,FF_TI_AUXTIME_61
,FF_TI_AUXTIME_62
,FF_TI_AUXTIME_63
,FF_TI_AUXTIME_64
,FF_TI_AUXTIME_65
,FF_TI_AUXTIME_66
,FF_TI_AUXTIME_67
,FF_TI_AUXTIME_68
,FF_TI_AUXTIME_69
,FF_TI_AUXTIME_70
,FF_TI_AUXTIME_71
,FF_TI_AUXTIME_72
,FF_TI_AUXTIME_73
,FF_TI_AUXTIME_74
,FF_TI_AUXTIME_75
,FF_TI_AUXTIME_76
,FF_TI_AUXTIME_77
,FF_TI_AUXTIME_78
,FF_TI_AUXTIME_79
,FF_TI_AUXTIME_80
,FF_TI_AUXTIME_81
,FF_TI_AUXTIME_82
,FF_TI_AUXTIME_83
,FF_TI_AUXTIME_84
,FF_TI_AUXTIME_85
,FF_TI_AUXTIME_86
,FF_TI_AUXTIME_87
,FF_TI_AUXTIME_88
,FF_TI_AUXTIME_89
,FF_TI_AUXTIME_90
,FF_TI_AUXTIME_91
,FF_TI_AUXTIME_92
,FF_TI_AUXTIME_93
,FF_TI_AUXTIME_94
,FF_TI_AUXTIME_95
,FF_TI_AUXTIME_96
,FF_TI_AUXTIME_97
,FF_TI_AUXTIME_98
,FF_TI_AUXTIME_99
,CMS_GROUP
,DATA_DATE
,DATETIME_CT
,DATETIME_PT
,[DATETIME]
,HOUR_INTERVAL
,RESOURCE_NAME
,STAFFED_SECS
,AVAILABLE_SECS
,ACD_SECS
,OTHER_SECS
,ACW_SECS
,RING_SECS
,AUX_0_DEFAULT_SECS
,AUX_1_BREAK_SECS
,AUX_2_COACHING_SECS
,AUX_3_MEETING_SECS
,AUX_4_PROJECT_SECS
,AUX_5_EGE_TRAINING_SECS
,AUX_6_OUTBOUND_SECS
,AUX_7_EMAIL_SECS
,AUX_8_QUEUE_WORK_SECS
,AUX_9_SYSTEM_DOWN_SECS
,AUX_10_EXCHANGE_SECS
,AUX_11_PERSONAL_SECS
,AUX_34_SECS
,AUX_35_SECS
,AUX_37_SECS
,AUX_40_SECS
,OUTBOUND_SECS
,EMAIL_SECS
,PROJECT_SECS
,MEETING_SECS
,TOTAL_AUX_SECS
,PROD_BILLING_SECS
,AUTHORIZED_CSAT_SAT_KEY_SECS
,AUTHORIZED_RESOURCE_SECS
,LINE_OF_BUSINESS
,WEEKEND
,CPROD
,MINIMUM_GUARANTEE
,AUTHORIZED_MINUTES
,[EMAIL]
,ID_EXT
,SCHEDULER_ACL_NAME
,STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE
,TENANT_KEY
,AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_MINUTES
,MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS
,INCLUDE_IN_CAS
,READY_FOR_XML
,SHOW_ID_EXTS
,INVOICE_ID
,SEQNO_ADDED_TIME
,SEQNO
,FTP_FILE_NAME
,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME
)
SELECT
 W2.FF_LOGIN_ID
,W2.FF_HOUR
,W2.FF_STAFFED_TIME
,W2.FF_AVAIL_TIME
,W2.FF_ACD_TIME
,W2.FF_OTHER_TIME
,W2.FF_ACW_TIME
,W2.FF_AGENT_RING_TIME
,W2.FF_AUX_TIME
,W2.FF_AUX_0_DEFAULT
,W2.FF_AUX_1_BREAK
,W2.FF_AUX_2_COACHING
,W2.FF_AUX_3_MEETING
,W2.FF_AUX_4_PROJECT
,W2.FF_AUX_5_EGE_TRAINING
,W2.FF_AUX_6_OUTBOUND
,W2.FF_AUX_7_EMAIL
,W2.FF_AUX_8_QUEUE_WORK
,W2.FF_AUX_9_SYSTEM_DOWN
,W2.FF_AUX_10_EXCHANGE
,W2.FF_AUX_11_PERSONAL
,W2.FF_TI_AUXTIME_12
,W2.FF_TI_AUXTIME_13
,W2.FF_TI_AUXTIME_14
,W2.FF_TI_AUXTIME_15
,W2.FF_TI_AUXTIME_16
,W2.FF_TI_AUXTIME_17
,W2.FF_TI_AUXTIME_18
,W2.FF_TI_AUXTIME_19
,W2.FF_TI_AUXTIME_20
,W2.FF_TI_AUXTIME_21
,W2.FF_TI_AUXTIME_22
,W2.FF_TI_AUXTIME_23
,W2.FF_TI_AUXTIME_24
,W2.FF_TI_AUXTIME_25
,W2.FF_TI_AUXTIME_26
,W2.FF_TI_AUXTIME_27
,W2.FF_TI_AUXTIME_28
,W2.FF_TI_AUXTIME_29
,W2.FF_TI_AUXTIME_30
,W2.FF_TI_AUXTIME_31
,W2.FF_TI_AUXTIME_32
,W2.FF_TI_AUXTIME_33
,W2.FF_TI_AUXTIME_34
,W2.FF_TI_AUXTIME_35
,W2.FF_TI_AUXTIME_36
,W2.FF_TI_AUXTIME_37
,W2.FF_TI_AUXTIME_38
,W2.FF_TI_AUXTIME_39
,W2.FF_TI_AUXTIME_40
,W2.FF_TI_AUXTIME_41
,W2.FF_TI_AUXTIME_42
,W2.FF_TI_AUXTIME_43
,W2.FF_TI_AUXTIME_44
,W2.FF_TI_AUXTIME_45
,W2.FF_TI_AUXTIME_46
,W2.FF_TI_AUXTIME_47
,W2.FF_TI_AUXTIME_48
,W2.FF_TI_AUXTIME_49
,W2.FF_TI_AUXTIME_50
,W2.FF_TI_AUXTIME_51
,W2.FF_TI_AUXTIME_52
,W2.FF_TI_AUXTIME_53
,W2.FF_TI_AUXTIME_54
,W2.FF_TI_AUXTIME_55
,W2.FF_TI_AUXTIME_56
,W2.FF_TI_AUXTIME_57
,W2.FF_TI_AUXTIME_58
,W2.FF_TI_AUXTIME_59
,W2.FF_TI_AUXTIME_60
,W2.FF_TI_AUXTIME_61
,W2.FF_TI_AUXTIME_62
,W2.FF_TI_AUXTIME_63
,W2.FF_TI_AUXTIME_64
,W2.FF_TI_AUXTIME_65
,W2.FF_TI_AUXTIME_66
,W2.FF_TI_AUXTIME_67
,W2.FF_TI_AUXTIME_68
,W2.FF_TI_AUXTIME_69
,W2.FF_TI_AUXTIME_70
,W2.FF_TI_AUXTIME_71
,W2.FF_TI_AUXTIME_72
,W2.FF_TI_AUXTIME_73
,W2.FF_TI_AUXTIME_74
,W2.FF_TI_AUXTIME_75
,W2.FF_TI_AUXTIME_76
,W2.FF_TI_AUXTIME_77
,W2.FF_TI_AUXTIME_78
,W2.FF_TI_AUXTIME_79
,W2.FF_TI_AUXTIME_80
,W2.FF_TI_AUXTIME_81
,W2.FF_TI_AUXTIME_82
,W2.FF_TI_AUXTIME_83
,W2.FF_TI_AUXTIME_84
,W2.FF_TI_AUXTIME_85
,W2.FF_TI_AUXTIME_86
,W2.FF_TI_AUXTIME_87
,W2.FF_TI_AUXTIME_88
,W2.FF_TI_AUXTIME_89
,W2.FF_TI_AUXTIME_90
,W2.FF_TI_AUXTIME_91
,W2.FF_TI_AUXTIME_92
,W2.FF_TI_AUXTIME_93
,W2.FF_TI_AUXTIME_94
,W2.FF_TI_AUXTIME_95
,W2.FF_TI_AUXTIME_96
,W2.FF_TI_AUXTIME_97
,W2.FF_TI_AUXTIME_98
,W2.FF_TI_AUXTIME_99
,W2.CMS_GROUP
,W2.DATA_DATE
,W2.DATETIME_CT
,W2.DATETIME_PT
,W2.[DATETIME]
,W2.HOUR_INTERVAL
,W2.RESOURCE_NAME
,W2.STAFFED_SECS
,W2.AVAILABLE_SECS
,W2.ACD_SECS
,W2.OTHER_SECS
,W2.ACW_SECS
,W2.RING_SECS
,W2.AUX_0_DEFAULT_SECS
,W2.AUX_1_BREAK_SECS
,W2.AUX_2_COACHING_SECS
,W2.AUX_3_MEETING_SECS
,W2.AUX_4_PROJECT_SECS
,W2.AUX_5_EGE_TRAINING_SECS
,W2.AUX_6_OUTBOUND_SECS
,W2.AUX_7_EMAIL_SECS
,W2.AUX_8_QUEUE_WORK_SECS
,W2.AUX_9_SYSTEM_DOWN_SECS
,W2.AUX_10_EXCHANGE_SECS
,W2.AUX_11_PERSONAL_SECS
,W2.AUX_34_SECS
,W2.AUX_35_SECS
,W2.AUX_37_SECS
,W2.AUX_40_SECS
,W2.OUTBOUND_SECS
,W2.EMAIL_SECS
,W2.PROJECT_SECS
,W2.MEETING_SECS
,W2.TOTAL_AUX_SECS
,W2.PROD_BILLING_SECS
,W2.AUTHORIZED_CSAT_SAT_KEY_SECS
,W2.AUTHORIZED_RESOURCE_SECS
,W2.LINE_OF_BUSINESS
,W2.WEEKEND
,W2.CPROD
,W2.MINIMUM_GUARANTEE
,W2.AUTHORIZED_MINUTES
,W2.[EMAIL]
,W2.ID_EXT
,W2.SCHEDULER_ACL_NAME
,W2.STD_TENANT_START_DATE_TIME_KEY
,W2.CAL_DATE
,W2.TENANT_KEY
,W2.AIR_DAY_TYPE
,W2.AIR_ACW_FONT_COLOR
,W2.MIN_GUARANTEE_MINUTES
,W2.MIN_GUARANTEE_TYPE
,W2.AUTHORIZED_TO_INVOICE_TYPE
,W2.HAS_HOLIDAYS
,W2.INCLUDE_IN_CAS
,W2.READY_FOR_XML
,W2.SHOW_ID_EXTS
,W2.INVOICE_ID
,W2.SEQNO_ADDED_TIME
,W2.SEQNO
,W2.FTP_FILE_NAME
,@WS_ROW_CREATED_TIME    --[WS_ROW_CREATED_TIME] [datetime] NOT NULL,
,NULL                    --[WS_ROW_UPDATED_TIME] [datetime] NULL,

FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_2  W2

LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_INVOICING    G   ON G.STD_TENANT_START_DATE_TIME_KEY = W2.STD_TENANT_START_DATE_TIME_KEY
														AND G.ID_EXT                         = W2.ID_EXT
														AND G.FF_LOGIN_ID					 = W2.FF_LOGIN_ID

WHERE (G.FF_LOGIN_ID					IS NULL AND ISNULL(W2.FF_LOGIN_ID					,'') <> '' )
  AND (G.STD_TENANT_START_DATE_TIME_KEY	IS NULL AND ISNULL(W2.STD_TENANT_START_DATE_TIME_KEY, 0) <>  0 )
--AND (G.INVOICE_ID						IS NULL AND ISNULL(W2.INVOICE_ID					,'') <> '' )			
--AND (G.ID_EXT							IS NULL AND ISNULL(W2.ID_EXT						,'') <> '' )

--	SELECT * FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING ORDER BY SEQNO

--===============================================================
SET DATEFIRST 1  -- = Monday
--===============================================================

IF OBJECT_ID('TEMPDB..#DT_EASY_WEEKS') IS NOT NULL BEGIN
   DROP TABLE #DT_EASY_WEEKS
END
CREATE TABLE #DT_EASY_WEEKS
(CAL_DATE_STRING		VARCHAR(10)
,CAL_WEEK_START_DATE	DATETIME
,CAL_WEEK_END_DATE		DATETIME
,PAY_CYCLE_CLOSURE_DATE DATETIME
)
INSERT INTO #DT_EASY_WEEKS
SELECT
 DT.CAL_DATE_STRING
,CASE WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 1 THEN CAST(DT.CAL_DATE_STRING AS DATETIME)
	  WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 7 THEN DATEADD(DD,-6,CAST(DT.CAL_DATE_STRING AS DATETIME))
	  ELSE DATEADD(DD,1,DT.CAL_WEEK_START_DATE) END
,DT.CAL_DATE_STRING
,DT.CAL_DATE_STRING  --PAY_CYCLE_CLOSURE_DATE
FROM DATE_TIME DT
WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
GROUP BY 
 DT.CAL_DATE_STRING
,CASE WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 1 THEN CAST(DT.CAL_DATE_STRING AS DATETIME)
	  WHEN DATEPART(DW,CAST(DT.CAL_DATE_STRING AS DATETIME)) = 7 THEN DATEADD(DD,-6,CAST(DT.CAL_DATE_STRING AS DATETIME))
	  ELSE DATEADD(DD,1,DT.CAL_WEEK_START_DATE) END
,DT.CAL_DATE_STRING
,DT.CAL_DATE_STRING  --PAY_CYCLE_CLOSURE_DATE
--===========================
UPDATE #DT_EASY_WEEKS SET CAL_WEEK_END_DATE = DATEADD(DD,6,CAL_WEEK_START_DATE)

UPDATE #DT_EASY_WEEKS SET
 PAY_CYCLE_CLOSURE_DATE = CASE WHEN DATEPART(DD,@DTM_MAX) >= 1 AND DATEPART(DD,@DTM_MAX) < 16 THEN
									CAST(CONVERT(VARCHAR(10), CONVERT(VARCHAR(2),MONTH(@DTM_MAX)) + CONVERT(VARCHAR(4),'/15/') + CONVERT(VARCHAR(4),YEAR(@DTM_MAX)),101) AS DATETIME)
							   WHEN DATEPART(DD,@DTM_MAX) > 15 THEN 
									DATEADD(D,-1,DATEADD(M,DATEDIFF(M,0,@DTM_MAX)+1,0))
							   END 
							   
 --SELECT * FROM #DT_EASY_WEEKS ORDER BY CAL_DATE_STRING

--==================================
--	CREATE TMP TABLE:
--==================================
IF OBJECT_ID('TEMPDB..#WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA') IS NOT NULL BEGIN
   DROP TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA
END
CREATE TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA
(	[PLATFORM] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_MAP_KEY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[FIELD_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_PROJECT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_ACL_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ACD_ID_EXTENSION] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[OFFICIAL_WSOL_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_WSOL_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[PRIMARY_PROJECT_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DIRECTOR_OF_PROJECT_MANAGEMENT_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_TECHNOLOGY_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CONTRACTOR_SUPPORT_PATHWAY] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_SYSTEM_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY_INVOICE_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[FILE_FORMAT_OF_PUSH] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_PREPARATION_INVOICE_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NEW_ACL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CURRENT_CATS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_ELIGIBLE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_2] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_3] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOD_INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AU_DK_LOGGED_IN_DURATION] [decimal](10, 2) NULL,
	[AU_DK_AVAILABLE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_IB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_OB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_CONVENTIONAL_ACW] [decimal](10, 2) NULL,
	[AU_DK_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_PSEUDO_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_ADJUSTED_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TOTAL_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS] [decimal](10, 2) NULL,
	[AU_DK_XFER_COUNT] [int] NULL,
	[AU_DK_HOLD_COUNT] [int] NULL,
	[AU_DK_CONFERENCE_COUNT] [int] NULL,
	[AU_DK_CONSULT_COUNT] [int] NULL,
	[AU_DK_PUP_COUNT] [int] NULL,
	[AU_DK_OFFERED_COUNT] [int] NULL,
	[AU_DK_HANDLED_COUNT] [int] NULL,
	[AU_DK_IB_HANDLE_COUNT] [int] NULL,
	[AU_DK_OB_HANDLE_COUNT] [int] NULL,
	[AU_DK_RONA_COUNT] [int] NULL,
	[AU_DK_AWR_COUNT] [int] NULL,
	[MINIMUM_GUARANTEE] [decimal](10, 2) NULL,
	[AUTHORIZED_TO_INVOICE] [decimal](10, 2) NULL,
	[WEEK_ENDING_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PAY_CYCLE_CLOSURE_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

	[FTP_FILE_NAME] [varchar](100) NOT NULL,
	[EMAIL] [varchar](100)  NULL,
	[STD_TENANT_START_DATE_TIME_KEY] [int] NOT NULL,
	[CAL_DATE] [datetime] NULL,
	[TENANT_KEY] [int] NOT NULL,
	[AIR_DAY_TYPE] [varchar](1) NOT NULL,
	[AIR_ACW_FONT_COLOR] [varchar](50) NULL,
	[MIN_GUARANTEE_RATE] [decimal](6, 3) NULL,
	[MIN_GUARANTEE_TYPE] [varchar](50) NULL,
	[AUTHORIZED_TO_INVOICE_TYPE] [varchar](50) NULL,
	[HAS_HOLIDAYS] [varchar](1) NULL,
	[INCLUDE_IN_CAS] [varchar](1) NULL,
	[READY_FOR_XML] [varchar](1) NULL,
	[SHOW_ID_EXTS] [varchar](1) NULL,
	[INVOICE_ID] [varchar](100) NULL,
	[RESOURCE_NAME] [varchar](100) NULL,
	[AIRITKDUR] [decimal](10, 2) NULL,
	[AIRIACDUR] [decimal](10, 2) NULL,
	[WS_ROW_CREATED_TIME] [datetime] NULL,
	[WS_ROW_UPDATED_TIME] [datetime] NULL

)
INSERT INTO #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA
SELECT 
 AIASD.[PLATFORM]
,AIASD.[STATUS]    
,AIA.FF_LOGIN_ID  --INVOICE_MAP_KEY
,AIASD.FIELD_NAME
,AIASD.SCHEDULER_PROJECT_ID
,AIASD.SCHEDULER_ACL_NAME
,AIASD.ACD_ID_EXTENSION
,AIASD.OFFICIAL_WSOL_CLIENT_ID
,AIASD.OFFICIAL_WSOL_CLIENT_NAME
,AIASD.OFFICIAL_ACD_CLIENT_ID
,AIASD.OFFICIAL_ACD_CLIENT_NAME
,AIASD.PRIMARY_PROJECT_MANAGER_ID
,AIASD.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIASD.AGENT_TECHNOLOGY_MANAGER_ID
,AIASD.CONTRACTOR_SUPPORT_PATHWAY
,AIASD.INVOICE_SYSTEM_ID
,AIASD.HOLIDAY_INVOICE_ID
,'No'	--CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN 'Yes' ELSE 'No' END  AS HOLIDAY   --AIR_DAY_TYPE:  'H'=Holiday  'S'=Standard (not holiday)
,AIASD.FILE_FORMAT_OF_PUSH
,AIASD.AGENT_PREPARATION_INVOICE_ID
,AIASD.NEW_ACL
,AIASD.CURRENT_CATS
,AIASD.CATS_ID
,AIASD.PATS_ID
,AIASD.SMART_ELIGIBLE
,AIASD.SMART_TIER_1
,AIASD.SMART_TIER_2
,AIASD.SMART_TIER_3
,AIASD.INTERVAL
,DT.CAL_DATE_STRING		--[DATE]             
,DT.LABEL_HH24 + ':00'	--HOD_INTERVAL

,AIA.STAFFED_SECS		--AU_DK_LOGGED_IN_DURATION
,AIA.AVAILABLE_SECS		--AU_DK_AVAILABLE_DURATION

,AIA.ACD_SECS			--AU_DK_TALK_DURATION
,0						--AU_DK_IB_TALK_DURATION
,0						--AU_DK_OB_TALK_DURATION

,AIA.ACW_SECS			--AU_DK_CONVENTIONAL_ACW
,CASE WHEN AIA.LINE_OF_BUSINESS IN ('Resource','SME') THEN
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS + 
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS
	  ELSE
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS +
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS +
		AIA.AUX_3_MEETING_SECS + AIA.AUX_4_PROJECT_SECS + AUX_37_SECS + AUX_40_SECS
	  END		        --AU_DK_NR_DURATION
,0												--AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,0												--AU_DK_ADJUSTED_NR_DURATION
,AIA.CPROD										--AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.CPROD										--AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS  

,0		--AU_DK_XFER_COUNT
,0		--AU_DK_HOLD_COUNT
,0		--AU_DK_CONFERENCE_COUNT
,0		--AU_DK_CONSULT_COUNT
,0		--AU_DK_PUP_COUNT

,0		--AU_DK_OFFERED_COUNT
,0		--AU_DK_HANDLED_COUNT
,0		--AU_DK_IB_HANDLE_COUNT
,0		--AU_DK_OB_HANDLE_COUNT
													
,0		--AU_DK_RONA_COUNT
,0		--AU_DK_AWR_COUNT

,AIA.MINIMUM_GUARANTEE	--MINIMUM_GUARANTEE
,AIA.AUTHORIZED_MINUTES	--AUTHORIZED_TO_INVOICE

,CONVERT(VARCHAR(10),DEW.CAL_WEEK_END_DATE,101)      --AS WEEK_ENDING_DATE       --EVERY SUNDAY.--,AIA.WEEK_ENDING_DATE             --HAVE TO CALCULATE !!!!!!!!!!!
,CONVERT(VARCHAR(10),DEW.PAY_CYCLE_CLOSURE_DATE,101) --AS PAY_CYCLE_CLOSURE_DATE --EVERY OTHER SUNDAY, FROM A STARTING SUNDAY OF 10/31/11.--,AIA.PAY_CYCLE_CLOSURE_DATE       --HAVE TO CALCULATE !!!!!!!!!!!

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,DT.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_MINUTES
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID  --CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END  --AS INVOICE_ID 
,AIA.RESOURCE_NAME
,NULL			--AIA.AIRITKDUR
,NULL			--AIA.AIRIACDUR
,dbo.GETDATE()  --	[WS_ROW_CREATED_TIME] [datetime] NULL,
,NULL			--	[WS_ROW_UPDATED_TIME] [datetime] NULL
	
--SELECT TOP 1000 *
FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_2            AIA 
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_AIA_STATIC_DEFAULTS AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_GROUPS      CASG  ON CASG.ID_EXT            = AIASD.ACD_ID_EXTENSION	

INNER JOIN      DATE_TIME									   DT    ON DT.DATE_TIME_KEY       = AIA.STD_TENANT_START_DATE_TIME_KEY

LEFT JOIN       #DT_EASY_WEEKS								   DEW   ON DEW.CAL_DATE_STRING    = DT.CAL_DATE_STRING

WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
  AND (ISNULL(AIASD.ACD_ID_EXTENSION,'') <> '')
  AND (ISNULL(AIA.RESOURCE_NAME,'') <> '')
  --AND AIA.AUT2 <> 0.00											--<<<<<---- FILTER OUT RECORDS WHERE AUTHORIZED TIME = 0.00


--==========================================================================
--UPDATE WSOL_TB_...UV_ANT_AIA TABLE:
--==========================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA SET
 [PLATFORM]							= W1.[PLATFORM]
,[STATUS]							= W1.[STATUS]
--,INVOICE_MAP_KEY					= W1.INVOICE_MAP_KEY
,FIELD_NAME							= W1.FIELD_NAME
,SCHEDULER_PROJECT_ID				= W1.SCHEDULER_PROJECT_ID
,SCHEDULER_ACL_NAME					= W1.SCHEDULER_ACL_NAME
--,ACD_ID_EXTENSION					= W1.ACD_ID_EXTENSION
,OFFICIAL_WSOL_CLIENT_ID			= W1.OFFICIAL_WSOL_CLIENT_ID
,OFFICIAL_WSOL_CLIENT_NAME			= W1.OFFICIAL_WSOL_CLIENT_NAME
,OFFICIAL_ACD_CLIENT_ID				= W1.OFFICIAL_ACD_CLIENT_ID
,OFFICIAL_ACD_CLIENT_NAME			= W1.OFFICIAL_ACD_CLIENT_NAME
,PRIMARY_PROJECT_MANAGER_ID			= W1.PRIMARY_PROJECT_MANAGER_ID
,DIRECTOR_OF_PROJECT_MANAGEMENT_ID	= W1.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AGENT_TECHNOLOGY_MANAGER_ID		= W1.AGENT_TECHNOLOGY_MANAGER_ID
,CONTRACTOR_SUPPORT_PATHWAY			= W1.CONTRACTOR_SUPPORT_PATHWAY
,INVOICE_SYSTEM_ID					= W1.INVOICE_SYSTEM_ID
,HOLIDAY_INVOICE_ID					= W1.HOLIDAY_INVOICE_ID
,HOLIDAY							= W1.HOLIDAY
,FILE_FORMAT_OF_PUSH				= W1.FILE_FORMAT_OF_PUSH
,AGENT_PREPARATION_INVOICE_ID		= W1.AGENT_PREPARATION_INVOICE_ID
,NEW_ACL							= W1.NEW_ACL
,CURRENT_CATS						= W1.CURRENT_CATS
,CATS_ID							= W1.CATS_ID
,PATS_ID							= W1.PATS_ID
,SMART_ELIGIBLE						= W1.SMART_ELIGIBLE
,SMART_TIER_1						= W1.SMART_TIER_1
,SMART_TIER_2						= W1.SMART_TIER_2
,SMART_TIER_3						= W1.SMART_TIER_3
,INTERVAL							= W1.INTERVAL
,[DATE]								= W1.[DATE]
,HOD_INTERVAL						= W1.HOD_INTERVAL
,AU_DK_LOGGED_IN_DURATION			= W1.AU_DK_LOGGED_IN_DURATION
,AU_DK_AVAILABLE_DURATION			= W1.AU_DK_AVAILABLE_DURATION
,AU_DK_TALK_DURATION				= W1.AU_DK_TALK_DURATION
,AU_DK_IB_TALK_DURATION				= W1.AU_DK_IB_TALK_DURATION
,AU_DK_OB_TALK_DURATION				= W1.AU_DK_OB_TALK_DURATION
,AU_DK_CONVENTIONAL_ACW				= W1.AU_DK_CONVENTIONAL_ACW
,AU_DK_NR_DURATION					= W1.AU_DK_NR_DURATION
,AU_DK_PSEUDO_PRODUCTIVE_DURATION   = W1.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AU_DK_ADJUSTED_NR_DURATION         = W1.AU_DK_ADJUSTED_NR_DURATION
,AU_DK_TOTAL_PRODUCTIVE_DURATION    = W1.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS = W1.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AU_DK_XFER_COUNT					= W1.AU_DK_XFER_COUNT
,AU_DK_HOLD_COUNT					= W1.AU_DK_HOLD_COUNT
,AU_DK_CONFERENCE_COUNT				= W1.AU_DK_CONFERENCE_COUNT
,AU_DK_CONSULT_COUNT				= W1.AU_DK_CONSULT_COUNT
,AU_DK_PUP_COUNT					= W1.AU_DK_PUP_COUNT
,AU_DK_OFFERED_COUNT				= W1.AU_DK_OFFERED_COUNT
,AU_DK_HANDLED_COUNT				= W1.AU_DK_HANDLED_COUNT
,AU_DK_IB_HANDLE_COUNT				= W1.AU_DK_IB_HANDLE_COUNT
,AU_DK_OB_HANDLE_COUNT				= W1.AU_DK_OB_HANDLE_COUNT
,AU_DK_RONA_COUNT					= W1.AU_DK_RONA_COUNT
,AU_DK_AWR_COUNT					= W1.AU_DK_AWR_COUNT
,MINIMUM_GUARANTEE					= W1.MINIMUM_GUARANTEE
,AUTHORIZED_TO_INVOICE				= W1.AUTHORIZED_TO_INVOICE
,WEEK_ENDING_DATE					= W1.WEEK_ENDING_DATE
,PAY_CYCLE_CLOSURE_DATE				= W1.PAY_CYCLE_CLOSURE_DATE

--FIELDS ABOVE ARE IN XML FILE.   FIELDS BELOW ARE NOT IN XML FILE!!!:
,FTP_FILE_NAME						= W1.FTP_FILE_NAME
,EMAIL								= W1.EMAIL

--,STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W1.CAL_DATE
,TENANT_KEY							= W1.TENANT_KEY
,AIR_DAY_TYPE						= W1.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W1.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE					= W1.MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE					= W1.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W1.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W1.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W1.INCLUDE_IN_CAS
,READY_FOR_XML						= W1.READY_FOR_XML
,SHOW_ID_EXTS						= W1.SHOW_ID_EXTS
,INVOICE_ID							= W1.INVOICE_ID
,RESOURCE_NAME						= W1.RESOURCE_NAME

,AIRITKDUR							= W1.AIRITKDUR
,AIRIACDUR							= W1.AIRIACDUR

--,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA   W1

INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA    UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
														 AND UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION
														 AND UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY )
  AND ( UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION )
  AND ( UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY )


--=====================================================
--INSERT TMP TABLE FIELDS INTO WSOL_TB_... TABLE:
--=====================================================
INSERT INTO [WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA]
SELECT 
 AIA.[PLATFORM]
,AIA.[STATUS]
,AIA.INVOICE_MAP_KEY
,AIA.FIELD_NAME
,AIA.SCHEDULER_PROJECT_ID
,AIA.SCHEDULER_ACL_NAME
,AIA.ACD_ID_EXTENSION
,AIA.OFFICIAL_WSOL_CLIENT_ID
,AIA.OFFICIAL_WSOL_CLIENT_NAME
,AIA.OFFICIAL_ACD_CLIENT_ID
,AIA.OFFICIAL_ACD_CLIENT_NAME
,AIA.PRIMARY_PROJECT_MANAGER_ID
,AIA.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIA.AGENT_TECHNOLOGY_MANAGER_ID
,AIA.CONTRACTOR_SUPPORT_PATHWAY
,AIA.INVOICE_SYSTEM_ID
,AIA.HOLIDAY_INVOICE_ID
,AIA.HOLIDAY
,AIA.FILE_FORMAT_OF_PUSH
,AIA.AGENT_PREPARATION_INVOICE_ID
,AIA.NEW_ACL
,AIA.CURRENT_CATS
,AIA.CATS_ID
,AIA.PATS_ID
,AIA.SMART_ELIGIBLE
,AIA.SMART_TIER_1
,AIA.SMART_TIER_2
,AIA.SMART_TIER_3
,AIA.INTERVAL
,AIA.[DATE]
,AIA.HOD_INTERVAL
,AIA.AU_DK_LOGGED_IN_DURATION
,AIA.AU_DK_AVAILABLE_DURATION
,AIA.AU_DK_TALK_DURATION
,AIA.AU_DK_IB_TALK_DURATION
,AIA.AU_DK_OB_TALK_DURATION
,AIA.AU_DK_CONVENTIONAL_ACW
,AIA.AU_DK_NR_DURATION
,AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AIA.AU_DK_ADJUSTED_NR_DURATION
,AIA.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AIA.AU_DK_XFER_COUNT
,AIA.AU_DK_HOLD_COUNT
,AIA.AU_DK_CONFERENCE_COUNT
,AIA.AU_DK_CONSULT_COUNT
,AIA.AU_DK_PUP_COUNT
,AIA.AU_DK_OFFERED_COUNT
,AIA.AU_DK_HANDLED_COUNT
,AIA.AU_DK_IB_HANDLE_COUNT
,AIA.AU_DK_OB_HANDLE_COUNT
,AIA.AU_DK_RONA_COUNT
,AIA.AU_DK_AWR_COUNT
,AIA.MINIMUM_GUARANTEE
,AIA.AUTHORIZED_TO_INVOICE
,AIA.WEEK_ENDING_DATE
,AIA.PAY_CYCLE_CLOSURE_DATE

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,AIA.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_RATE
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID
,AIA.RESOURCE_NAME
,AIA.AIRITKDUR
,AIA.AIRIACDUR
,AIA.WS_ROW_CREATED_TIME
,AIA.WS_ROW_UPDATED_TIME

--Where Permanent table is Null and Work table is not Null - then we want to add the data!!!:

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA   AIA
LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA    UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = AIA.STD_TENANT_START_DATE_TIME_KEY
														 AND UV.ACD_ID_EXTENSION               = AIA.ACD_ID_EXTENSION
														 AND UV.INVOICE_MAP_KEY                = AIA.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY IS NULL AND ISNULL(AIA.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND ( UV.ACD_ID_EXTENSION               IS NULL AND ISNULL(AIA.ACD_ID_EXTENSION,'') <> '' )
  AND ( UV.INVOICE_MAP_KEY                IS NULL AND ISNULL(AIA.INVOICE_MAP_KEY,'') <> '' )


--===============================================
--	CREATE TMP TABLE FOR WEEKEND RECORDS:																<<<<<<<<<<<< WEEKEND RECORDS <<<<<<<<<<<<<<<<<<<<<<<<<<
--===============================================
IF OBJECT_ID('TEMPDB..#WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND') IS NOT NULL BEGIN
   DROP TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND
END
CREATE TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND
(	[PLATFORM] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_MAP_KEY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[FIELD_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_PROJECT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_ACL_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ACD_ID_EXTENSION] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[OFFICIAL_WSOL_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_WSOL_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[PRIMARY_PROJECT_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DIRECTOR_OF_PROJECT_MANAGEMENT_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_TECHNOLOGY_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CONTRACTOR_SUPPORT_PATHWAY] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_SYSTEM_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY_INVOICE_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[FILE_FORMAT_OF_PUSH] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_PREPARATION_INVOICE_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NEW_ACL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CURRENT_CATS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_ELIGIBLE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_2] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_3] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOD_INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AU_DK_LOGGED_IN_DURATION] [decimal](10, 2) NULL,
	[AU_DK_AVAILABLE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_IB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_OB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_CONVENTIONAL_ACW] [decimal](10, 2) NULL,
	[AU_DK_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_PSEUDO_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_ADJUSTED_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TOTAL_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS] [decimal](10, 2) NULL,
	[AU_DK_XFER_COUNT] [int] NULL,
	[AU_DK_HOLD_COUNT] [int] NULL,
	[AU_DK_CONFERENCE_COUNT] [int] NULL,
	[AU_DK_CONSULT_COUNT] [int] NULL,
	[AU_DK_PUP_COUNT] [int] NULL,
	[AU_DK_OFFERED_COUNT] [int] NULL,
	[AU_DK_HANDLED_COUNT] [int] NULL,
	[AU_DK_IB_HANDLE_COUNT] [int] NULL,
	[AU_DK_OB_HANDLE_COUNT] [int] NULL,
	[AU_DK_RONA_COUNT] [int] NULL,
	[AU_DK_AWR_COUNT] [int] NULL,
	[MINIMUM_GUARANTEE] [decimal](10, 2) NULL,
	[AUTHORIZED_TO_INVOICE] [decimal](10, 2) NULL,
	[WEEK_ENDING_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PAY_CYCLE_CLOSURE_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

	[FTP_FILE_NAME] [varchar](100) NOT NULL,
	[EMAIL] [varchar](100)  NULL,
	[STD_TENANT_START_DATE_TIME_KEY] [int] NOT NULL,
	[CAL_DATE] [datetime] NULL,
	[TENANT_KEY] [int] NOT NULL,
	[AIR_DAY_TYPE] [varchar](1) NOT NULL,
	[AIR_ACW_FONT_COLOR] [varchar](50) NULL,
	[MIN_GUARANTEE_RATE] [decimal](6, 3) NULL,
	[MIN_GUARANTEE_TYPE] [varchar](50) NULL,
	[AUTHORIZED_TO_INVOICE_TYPE] [varchar](50) NULL,
	[HAS_HOLIDAYS] [varchar](1) NULL,
	[INCLUDE_IN_CAS] [varchar](1) NULL,
	[READY_FOR_XML] [varchar](1) NULL,
	[SHOW_ID_EXTS] [varchar](1) NULL,
	[INVOICE_ID] [varchar](100) NULL,
	[RESOURCE_NAME] [varchar](100) NULL,
	[AIRITKDUR] [decimal](10, 2) NULL,
	[AIRIACDUR] [decimal](10, 2) NULL,
	[WS_ROW_CREATED_TIME] [datetime] NULL,
	[WS_ROW_UPDATED_TIME] [datetime] NULL

)
INSERT INTO #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND
SELECT 
 AIASD.[PLATFORM]
,AIASD.[STATUS]    
,AIA.FF_LOGIN_ID  --INVOICE_MAP_KEY
,AIASD.FIELD_NAME
,AIASD.SCHEDULER_PROJECT_ID
,AIASD.SCHEDULER_ACL_NAME
,'EWE'											--AIASD.ACD_ID_EXTENSION	<<<<< WEEKEND ONLY
,AIASD.OFFICIAL_WSOL_CLIENT_ID
,AIASD.OFFICIAL_WSOL_CLIENT_NAME
,AIASD.OFFICIAL_ACD_CLIENT_ID
,AIASD.OFFICIAL_ACD_CLIENT_NAME
,AIASD.PRIMARY_PROJECT_MANAGER_ID
,AIASD.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIASD.AGENT_TECHNOLOGY_MANAGER_ID
,AIASD.CONTRACTOR_SUPPORT_PATHWAY
,'Egencia W'									--AIASD.INVOICE_SYSTEM_ID	<<<<< WEEKEND ONLY
,AIASD.HOLIDAY_INVOICE_ID
,'No'	--CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN 'Yes' ELSE 'No' END  AS HOLIDAY   --AIR_DAY_TYPE:  'H'=Holiday  'S'=Standard (not holiday)
,AIASD.FILE_FORMAT_OF_PUSH
,AIASD.AGENT_PREPARATION_INVOICE_ID
,AIASD.NEW_ACL
,AIASD.CURRENT_CATS
,AIASD.CATS_ID
,AIASD.PATS_ID
,AIASD.SMART_ELIGIBLE
,AIASD.SMART_TIER_1
,AIASD.SMART_TIER_2
,AIASD.SMART_TIER_3
,AIASD.INTERVAL
,DT.CAL_DATE_STRING		--[DATE]             
,DT.LABEL_HH24 + ':00'	--HOD_INTERVAL

,AIA.STAFFED_SECS		--AU_DK_LOGGED_IN_DURATION
,AIA.AVAILABLE_SECS		--AU_DK_AVAILABLE_DURATION

,AIA.ACD_SECS			--AU_DK_TALK_DURATION
,0						--AU_DK_IB_TALK_DURATION
,0						--AU_DK_OB_TALK_DURATION

,AIA.ACW_SECS			--AU_DK_CONVENTIONAL_ACW
,CASE WHEN AIA.LINE_OF_BUSINESS IN ('Resource','SME') THEN
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS + 
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS
	  ELSE
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS +
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS +
		AIA.AUX_3_MEETING_SECS + AIA.AUX_4_PROJECT_SECS + AUX_37_SECS + AUX_40_SECS
	  END		        --AU_DK_NR_DURATION
,0												--AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,0												--AU_DK_ADJUSTED_NR_DURATION
,AIA.CPROD										--AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.CPROD										--AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS  

,0		--AU_DK_XFER_COUNT
,0		--AU_DK_HOLD_COUNT
,0		--AU_DK_CONFERENCE_COUNT
,0		--AU_DK_CONSULT_COUNT
,0		--AU_DK_PUP_COUNT

,0		--AU_DK_OFFERED_COUNT
,0		--AU_DK_HANDLED_COUNT
,0		--AU_DK_IB_HANDLE_COUNT
,0		--AU_DK_OB_HANDLE_COUNT
													
,0		--AU_DK_RONA_COUNT
,0		--AU_DK_AWR_COUNT

,AIA.MINIMUM_GUARANTEE	--MINIMUM_GUARANTEE
,AIA.AUTHORIZED_MINUTES	--AUTHORIZED_TO_INVOICE

,CONVERT(VARCHAR(10),DEW.CAL_WEEK_END_DATE,101)      --AS WEEK_ENDING_DATE       --EVERY SUNDAY.--,AIA.WEEK_ENDING_DATE             --HAVE TO CALCULATE !!!!!!!!!!!
,CONVERT(VARCHAR(10),DEW.PAY_CYCLE_CLOSURE_DATE,101) --AS PAY_CYCLE_CLOSURE_DATE --EVERY OTHER SUNDAY, FROM A STARTING SUNDAY OF 10/31/11.--,AIA.PAY_CYCLE_CLOSURE_DATE       --HAVE TO CALCULATE !!!!!!!!!!!

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,DT.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_MINUTES
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,'Egencia W'	--AIA.INVOICE_ID  --CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END  --AS INVOICE_ID	<<<<< WEEKEND ONLY
,AIA.RESOURCE_NAME
,NULL			--AIA.AIRITKDUR
,NULL			--AIA.AIRIACDUR
,dbo.GETDATE()  --	[WS_ROW_CREATED_TIME] [datetime] NULL,
,NULL			--	[WS_ROW_UPDATED_TIME] [datetime] NULL
	
--SELECT TOP 1000 *
FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_2            AIA 
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_AIA_STATIC_DEFAULTS AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_GROUPS      CASG  ON CASG.ID_EXT            = AIASD.ACD_ID_EXTENSION	

INNER JOIN      DATE_TIME									   DT    ON DT.DATE_TIME_KEY       = AIA.STD_TENANT_START_DATE_TIME_KEY

LEFT JOIN       #DT_EASY_WEEKS								   DEW   ON DEW.CAL_DATE_STRING    = DT.CAL_DATE_STRING

WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
  AND (ISNULL(AIASD.ACD_ID_EXTENSION,'') <> '')
  AND (ISNULL(AIA.RESOURCE_NAME,'') <> '')
  AND AIA.WEEKEND = 'Y'												--<<<<<---- WEEKEND ONLY RECORDS
  --AND AIA.AUT2 <> 0.00											--<<<<<---- FILTER OUT RECORDS WHERE AUTHORIZED TIME = 0.00


--==========================================================================
--UPDATE WSOL_TB_...UV_ANT_AIA TABLE:
--==========================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA SET
 [PLATFORM]							= W1.[PLATFORM]
,[STATUS]							= W1.[STATUS]
--,INVOICE_MAP_KEY					= W1.INVOICE_MAP_KEY
,FIELD_NAME							= W1.FIELD_NAME
,SCHEDULER_PROJECT_ID				= W1.SCHEDULER_PROJECT_ID
,SCHEDULER_ACL_NAME					= W1.SCHEDULER_ACL_NAME
--,ACD_ID_EXTENSION					= W1.ACD_ID_EXTENSION
,OFFICIAL_WSOL_CLIENT_ID			= W1.OFFICIAL_WSOL_CLIENT_ID
,OFFICIAL_WSOL_CLIENT_NAME			= W1.OFFICIAL_WSOL_CLIENT_NAME
,OFFICIAL_ACD_CLIENT_ID				= W1.OFFICIAL_ACD_CLIENT_ID
,OFFICIAL_ACD_CLIENT_NAME			= W1.OFFICIAL_ACD_CLIENT_NAME
,PRIMARY_PROJECT_MANAGER_ID			= W1.PRIMARY_PROJECT_MANAGER_ID
,DIRECTOR_OF_PROJECT_MANAGEMENT_ID	= W1.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AGENT_TECHNOLOGY_MANAGER_ID		= W1.AGENT_TECHNOLOGY_MANAGER_ID
,CONTRACTOR_SUPPORT_PATHWAY			= W1.CONTRACTOR_SUPPORT_PATHWAY
,INVOICE_SYSTEM_ID					= W1.INVOICE_SYSTEM_ID
,HOLIDAY_INVOICE_ID					= W1.HOLIDAY_INVOICE_ID
,HOLIDAY							= W1.HOLIDAY
,FILE_FORMAT_OF_PUSH				= W1.FILE_FORMAT_OF_PUSH
,AGENT_PREPARATION_INVOICE_ID		= W1.AGENT_PREPARATION_INVOICE_ID
,NEW_ACL							= W1.NEW_ACL
,CURRENT_CATS						= W1.CURRENT_CATS
,CATS_ID							= W1.CATS_ID
,PATS_ID							= W1.PATS_ID
,SMART_ELIGIBLE						= W1.SMART_ELIGIBLE
,SMART_TIER_1						= W1.SMART_TIER_1
,SMART_TIER_2						= W1.SMART_TIER_2
,SMART_TIER_3						= W1.SMART_TIER_3
,INTERVAL							= W1.INTERVAL
,[DATE]								= W1.[DATE]
,HOD_INTERVAL						= W1.HOD_INTERVAL
,AU_DK_LOGGED_IN_DURATION			= W1.AU_DK_LOGGED_IN_DURATION
,AU_DK_AVAILABLE_DURATION			= W1.AU_DK_AVAILABLE_DURATION
,AU_DK_TALK_DURATION				= W1.AU_DK_TALK_DURATION
,AU_DK_IB_TALK_DURATION				= W1.AU_DK_IB_TALK_DURATION
,AU_DK_OB_TALK_DURATION				= W1.AU_DK_OB_TALK_DURATION
,AU_DK_CONVENTIONAL_ACW				= W1.AU_DK_CONVENTIONAL_ACW
,AU_DK_NR_DURATION					= W1.AU_DK_NR_DURATION
,AU_DK_PSEUDO_PRODUCTIVE_DURATION   = W1.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AU_DK_ADJUSTED_NR_DURATION         = W1.AU_DK_ADJUSTED_NR_DURATION
,AU_DK_TOTAL_PRODUCTIVE_DURATION    = W1.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS = W1.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AU_DK_XFER_COUNT					= W1.AU_DK_XFER_COUNT
,AU_DK_HOLD_COUNT					= W1.AU_DK_HOLD_COUNT
,AU_DK_CONFERENCE_COUNT				= W1.AU_DK_CONFERENCE_COUNT
,AU_DK_CONSULT_COUNT				= W1.AU_DK_CONSULT_COUNT
,AU_DK_PUP_COUNT					= W1.AU_DK_PUP_COUNT
,AU_DK_OFFERED_COUNT				= W1.AU_DK_OFFERED_COUNT
,AU_DK_HANDLED_COUNT				= W1.AU_DK_HANDLED_COUNT
,AU_DK_IB_HANDLE_COUNT				= W1.AU_DK_IB_HANDLE_COUNT
,AU_DK_OB_HANDLE_COUNT				= W1.AU_DK_OB_HANDLE_COUNT
,AU_DK_RONA_COUNT					= W1.AU_DK_RONA_COUNT
,AU_DK_AWR_COUNT					= W1.AU_DK_AWR_COUNT
,MINIMUM_GUARANTEE					= W1.MINIMUM_GUARANTEE
,AUTHORIZED_TO_INVOICE				= W1.AUTHORIZED_TO_INVOICE
,WEEK_ENDING_DATE					= W1.WEEK_ENDING_DATE
,PAY_CYCLE_CLOSURE_DATE				= W1.PAY_CYCLE_CLOSURE_DATE

--FIELDS ABOVE ARE IN XML FILE.   FIELDS BELOW ARE NOT IN XML FILE!!!:
,FTP_FILE_NAME						= W1.FTP_FILE_NAME
,EMAIL								= W1.EMAIL

--,STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W1.CAL_DATE
,TENANT_KEY							= W1.TENANT_KEY
,AIR_DAY_TYPE						= W1.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W1.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE					= W1.MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE					= W1.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W1.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W1.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W1.INCLUDE_IN_CAS
,READY_FOR_XML						= W1.READY_FOR_XML
,SHOW_ID_EXTS						= W1.SHOW_ID_EXTS
,INVOICE_ID							= W1.INVOICE_ID
,RESOURCE_NAME						= W1.RESOURCE_NAME

,AIRITKDUR							= W1.AIRITKDUR
,AIRIACDUR							= W1.AIRIACDUR

--,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND   W1

INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA			  UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
																 AND UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION
																 AND UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY )
  AND ( UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION )
  AND ( UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY )


--=====================================================
--INSERT TMP TABLE FIELDS INTO WSOL_TB_... TABLE:
--=====================================================
INSERT INTO [WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA]
SELECT 
 AIA.[PLATFORM]
,AIA.[STATUS]
,AIA.INVOICE_MAP_KEY
,AIA.FIELD_NAME
,AIA.SCHEDULER_PROJECT_ID
,AIA.SCHEDULER_ACL_NAME
,AIA.ACD_ID_EXTENSION
,AIA.OFFICIAL_WSOL_CLIENT_ID
,AIA.OFFICIAL_WSOL_CLIENT_NAME
,AIA.OFFICIAL_ACD_CLIENT_ID
,AIA.OFFICIAL_ACD_CLIENT_NAME
,AIA.PRIMARY_PROJECT_MANAGER_ID
,AIA.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIA.AGENT_TECHNOLOGY_MANAGER_ID
,AIA.CONTRACTOR_SUPPORT_PATHWAY
,AIA.INVOICE_SYSTEM_ID
,AIA.HOLIDAY_INVOICE_ID
,AIA.HOLIDAY
,AIA.FILE_FORMAT_OF_PUSH
,AIA.AGENT_PREPARATION_INVOICE_ID
,AIA.NEW_ACL
,AIA.CURRENT_CATS
,AIA.CATS_ID
,AIA.PATS_ID
,AIA.SMART_ELIGIBLE
,AIA.SMART_TIER_1
,AIA.SMART_TIER_2
,AIA.SMART_TIER_3
,AIA.INTERVAL
,AIA.[DATE]
,AIA.HOD_INTERVAL
,AIA.AU_DK_LOGGED_IN_DURATION
,AIA.AU_DK_AVAILABLE_DURATION
,AIA.AU_DK_TALK_DURATION
,AIA.AU_DK_IB_TALK_DURATION
,AIA.AU_DK_OB_TALK_DURATION
,AIA.AU_DK_CONVENTIONAL_ACW
,AIA.AU_DK_NR_DURATION
,AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AIA.AU_DK_ADJUSTED_NR_DURATION
,AIA.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AIA.AU_DK_XFER_COUNT
,AIA.AU_DK_HOLD_COUNT
,AIA.AU_DK_CONFERENCE_COUNT
,AIA.AU_DK_CONSULT_COUNT
,AIA.AU_DK_PUP_COUNT
,AIA.AU_DK_OFFERED_COUNT
,AIA.AU_DK_HANDLED_COUNT
,AIA.AU_DK_IB_HANDLE_COUNT
,AIA.AU_DK_OB_HANDLE_COUNT
,AIA.AU_DK_RONA_COUNT
,AIA.AU_DK_AWR_COUNT
,AIA.MINIMUM_GUARANTEE
,AIA.AUTHORIZED_TO_INVOICE
,AIA.WEEK_ENDING_DATE
,AIA.PAY_CYCLE_CLOSURE_DATE

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,AIA.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_RATE
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID
,AIA.RESOURCE_NAME
,AIA.AIRITKDUR
,AIA.AIRIACDUR
,AIA.WS_ROW_CREATED_TIME
,AIA.WS_ROW_UPDATED_TIME

--Where Permanent table is Null and Work table is not Null - then we want to add the data!!!:

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_WEEKEND   AIA
LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA			  UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = AIA.STD_TENANT_START_DATE_TIME_KEY
																 AND UV.ACD_ID_EXTENSION               = AIA.ACD_ID_EXTENSION
																 AND UV.INVOICE_MAP_KEY                = AIA.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY IS NULL AND ISNULL(AIA.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND ( UV.ACD_ID_EXTENSION               IS NULL AND ISNULL(AIA.ACD_ID_EXTENSION,'') <> '' )
  AND ( UV.INVOICE_MAP_KEY                IS NULL AND ISNULL(AIA.INVOICE_MAP_KEY,'') <> '' )


--===============================================
--	CREATE TMP TABLE FOR HOLIDAY RECORDS:																<<<<<<<<<<<< HOLIDAY RECORDS <<<<<<<<<<<<<<<<<<<<<<<<<<
--===============================================
IF OBJECT_ID('TEMPDB..#WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY') IS NOT NULL BEGIN
   DROP TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY
END
CREATE TABLE #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY
(	[PLATFORM] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_MAP_KEY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[FIELD_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_PROJECT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SCHEDULER_ACL_NAME] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ACD_ID_EXTENSION] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[OFFICIAL_WSOL_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_WSOL_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[OFFICIAL_ACD_CLIENT_NAME] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[PRIMARY_PROJECT_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DIRECTOR_OF_PROJECT_MANAGEMENT_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_TECHNOLOGY_MANAGER_ID] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CONTRACTOR_SUPPORT_PATHWAY] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INVOICE_SYSTEM_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY_INVOICE_ID] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOLIDAY] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[FILE_FORMAT_OF_PUSH] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGENT_PREPARATION_INVOICE_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NEW_ACL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CURRENT_CATS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[CATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PATS_ID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_ELIGIBLE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_2] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SMART_TIER_3] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HOD_INTERVAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AU_DK_LOGGED_IN_DURATION] [decimal](10, 2) NULL,
	[AU_DK_AVAILABLE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_IB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_OB_TALK_DURATION] [decimal](10, 2) NULL,
	[AU_DK_CONVENTIONAL_ACW] [decimal](10, 2) NULL,
	[AU_DK_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_PSEUDO_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_ADJUSTED_NR_DURATION] [decimal](10, 2) NULL,
	[AU_DK_TOTAL_PRODUCTIVE_DURATION] [decimal](10, 2) NULL,
	[AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS] [decimal](10, 2) NULL,
	[AU_DK_XFER_COUNT] [int] NULL,
	[AU_DK_HOLD_COUNT] [int] NULL,
	[AU_DK_CONFERENCE_COUNT] [int] NULL,
	[AU_DK_CONSULT_COUNT] [int] NULL,
	[AU_DK_PUP_COUNT] [int] NULL,
	[AU_DK_OFFERED_COUNT] [int] NULL,
	[AU_DK_HANDLED_COUNT] [int] NULL,
	[AU_DK_IB_HANDLE_COUNT] [int] NULL,
	[AU_DK_OB_HANDLE_COUNT] [int] NULL,
	[AU_DK_RONA_COUNT] [int] NULL,
	[AU_DK_AWR_COUNT] [int] NULL,
	[MINIMUM_GUARANTEE] [decimal](10, 2) NULL,
	[AUTHORIZED_TO_INVOICE] [decimal](10, 2) NULL,
	[WEEK_ENDING_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PAY_CYCLE_CLOSURE_DATE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

	[FTP_FILE_NAME] [varchar](100) NOT NULL,
	[EMAIL] [varchar](100)  NULL,
	[STD_TENANT_START_DATE_TIME_KEY] [int] NOT NULL,
	[CAL_DATE] [datetime] NULL,
	[TENANT_KEY] [int] NOT NULL,
	[AIR_DAY_TYPE] [varchar](1) NOT NULL,
	[AIR_ACW_FONT_COLOR] [varchar](50) NULL,
	[MIN_GUARANTEE_RATE] [decimal](6, 3) NULL,
	[MIN_GUARANTEE_TYPE] [varchar](50) NULL,
	[AUTHORIZED_TO_INVOICE_TYPE] [varchar](50) NULL,
	[HAS_HOLIDAYS] [varchar](1) NULL,
	[INCLUDE_IN_CAS] [varchar](1) NULL,
	[READY_FOR_XML] [varchar](1) NULL,
	[SHOW_ID_EXTS] [varchar](1) NULL,
	[INVOICE_ID] [varchar](100) NULL,
	[RESOURCE_NAME] [varchar](100) NULL,
	[AIRITKDUR] [decimal](10, 2) NULL,
	[AIRIACDUR] [decimal](10, 2) NULL,
	[WS_ROW_CREATED_TIME] [datetime] NULL,
	[WS_ROW_UPDATED_TIME] [datetime] NULL

)
INSERT INTO #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY
SELECT 
 AIASD.[PLATFORM]
,AIASD.[STATUS]    
,AIA.FF_LOGIN_ID  --INVOICE_MAP_KEY
,AIASD.FIELD_NAME
,AIASD.SCHEDULER_PROJECT_ID
,AIASD.SCHEDULER_ACL_NAME
,'EGH'											--AIASD.ACD_ID_EXTENSION	<<<<< HOLIDAY ONLY
,AIASD.OFFICIAL_WSOL_CLIENT_ID
,AIASD.OFFICIAL_WSOL_CLIENT_NAME
,AIASD.OFFICIAL_ACD_CLIENT_ID
,AIASD.OFFICIAL_ACD_CLIENT_NAME
,AIASD.PRIMARY_PROJECT_MANAGER_ID
,AIASD.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIASD.AGENT_TECHNOLOGY_MANAGER_ID
,AIASD.CONTRACTOR_SUPPORT_PATHWAY
,'Egencia H'									--AIASD.INVOICE_SYSTEM_ID	<<<<< HOLIDAY ONLY
,AIASD.HOLIDAY_INVOICE_ID
,'Yes'	--CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN 'Yes' ELSE 'No' END  AS HOLIDAY   --AIR_DAY_TYPE:  'H'=Holiday  'S'=Standard (not holiday)
,AIASD.FILE_FORMAT_OF_PUSH
,AIASD.AGENT_PREPARATION_INVOICE_ID
,AIASD.NEW_ACL
,AIASD.CURRENT_CATS
,AIASD.CATS_ID
,AIASD.PATS_ID
,AIASD.SMART_ELIGIBLE
,AIASD.SMART_TIER_1
,AIASD.SMART_TIER_2
,AIASD.SMART_TIER_3
,AIASD.INTERVAL
,DT.CAL_DATE_STRING		--[DATE]             
,DT.LABEL_HH24 + ':00'	--HOD_INTERVAL

,AIA.STAFFED_SECS		--AU_DK_LOGGED_IN_DURATION
,AIA.AVAILABLE_SECS		--AU_DK_AVAILABLE_DURATION

,AIA.ACD_SECS			--AU_DK_TALK_DURATION
,0						--AU_DK_IB_TALK_DURATION
,0						--AU_DK_OB_TALK_DURATION

,AIA.ACW_SECS			--AU_DK_CONVENTIONAL_ACW
,CASE WHEN AIA.LINE_OF_BUSINESS IN ('Resource','SME') THEN
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS + 
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS
	  ELSE
		AIA.RING_SECS + AIA.AUX_1_BREAK_SECS + AIA.AUX_2_COACHING_SECS + AIA.AUX_5_EGE_TRAINING_SECS +
		AIA.AUX_8_QUEUE_WORK_SECS + AIA.AUX_9_SYSTEM_DOWN_SECS + AUX_11_PERSONAL_SECS +
		AIA.AUX_3_MEETING_SECS + AIA.AUX_4_PROJECT_SECS + AUX_37_SECS + AUX_40_SECS
	  END		        --AU_DK_NR_DURATION
,0												--AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,0												--AU_DK_ADJUSTED_NR_DURATION
,AIA.CPROD										--AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.CPROD										--AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS  

,0		--AU_DK_XFER_COUNT
,0		--AU_DK_HOLD_COUNT
,0		--AU_DK_CONFERENCE_COUNT
,0		--AU_DK_CONSULT_COUNT
,0		--AU_DK_PUP_COUNT

,0		--AU_DK_OFFERED_COUNT
,0		--AU_DK_HANDLED_COUNT
,0		--AU_DK_IB_HANDLE_COUNT
,0		--AU_DK_OB_HANDLE_COUNT
													
,0		--AU_DK_RONA_COUNT
,0		--AU_DK_AWR_COUNT

,AIA.MINIMUM_GUARANTEE	--MINIMUM_GUARANTEE
,AIA.AUTHORIZED_MINUTES	--AUTHORIZED_TO_INVOICE

,CONVERT(VARCHAR(10),DEW.CAL_WEEK_END_DATE,101)      --AS WEEK_ENDING_DATE       --EVERY SUNDAY.--,AIA.WEEK_ENDING_DATE             --HAVE TO CALCULATE !!!!!!!!!!!
,CONVERT(VARCHAR(10),DEW.PAY_CYCLE_CLOSURE_DATE,101) --AS PAY_CYCLE_CLOSURE_DATE --EVERY OTHER SUNDAY, FROM A STARTING SUNDAY OF 10/31/11.--,AIA.PAY_CYCLE_CLOSURE_DATE       --HAVE TO CALCULATE !!!!!!!!!!!

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,DT.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_MINUTES
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,'Egencia H'	--AIA.INVOICE_ID  --CASE WHEN AIA.AIR_DAY_TYPE = 'H' THEN AIASD.HOLIDAY_INVOICE_ID ELSE AIASD.INVOICE_SYSTEM_ID END  --AS INVOICE_ID	<<<<< HOLIDAY ONLY
,AIA.RESOURCE_NAME
,NULL			--AIA.AIRITKDUR
,NULL			--AIA.AIRIACDUR
,dbo.GETDATE()  --	[WS_ROW_CREATED_TIME] [datetime] NULL,
,NULL			--	[WS_ROW_UPDATED_TIME] [datetime] NULL
	
--SELECT TOP 1000 *
FROM            WSOL_TB_IMPORTS_EGENCIA_INVOICING_2            AIA 
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_AIA_STATIC_DEFAULTS AIASD ON AIASD.ACD_ID_EXTENSION = AIA.ID_EXT
INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_SD_INVOICE_GROUPS      CASG  ON CASG.ID_EXT            = AIASD.ACD_ID_EXTENSION	

INNER JOIN      DATE_TIME									   DT    ON DT.DATE_TIME_KEY       = AIA.STD_TENANT_START_DATE_TIME_KEY

LEFT JOIN       #DT_EASY_WEEKS								   DEW   ON DEW.CAL_DATE_STRING    = DT.CAL_DATE_STRING

WHERE DT.CAL_DATE >= @DTM_BEG AND DT.CAL_DATE <  @DTM_END
  AND (ISNULL(AIASD.ACD_ID_EXTENSION,'') <> '')
  AND (ISNULL(AIA.RESOURCE_NAME,'') <> '')
  AND AIA.AIR_DAY_TYPE = 'H'										--<<<<<---- HOLIDAY ONLY RECORDS
  --AND AIA.AUT2 <> 0.00											--<<<<<---- FILTER OUT RECORDS WHERE AUTHORIZED TIME = 0.00


--==========================================================================
--UPDATE WSOL_TB_...UV_ANT_AIA TABLE:
--==========================================================================
UPDATE WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA SET
 [PLATFORM]							= W1.[PLATFORM]
,[STATUS]							= W1.[STATUS]
--,INVOICE_MAP_KEY					= W1.INVOICE_MAP_KEY
,FIELD_NAME							= W1.FIELD_NAME
,SCHEDULER_PROJECT_ID				= W1.SCHEDULER_PROJECT_ID
,SCHEDULER_ACL_NAME					= W1.SCHEDULER_ACL_NAME
--,ACD_ID_EXTENSION					= W1.ACD_ID_EXTENSION
,OFFICIAL_WSOL_CLIENT_ID			= W1.OFFICIAL_WSOL_CLIENT_ID
,OFFICIAL_WSOL_CLIENT_NAME			= W1.OFFICIAL_WSOL_CLIENT_NAME
,OFFICIAL_ACD_CLIENT_ID				= W1.OFFICIAL_ACD_CLIENT_ID
,OFFICIAL_ACD_CLIENT_NAME			= W1.OFFICIAL_ACD_CLIENT_NAME
,PRIMARY_PROJECT_MANAGER_ID			= W1.PRIMARY_PROJECT_MANAGER_ID
,DIRECTOR_OF_PROJECT_MANAGEMENT_ID	= W1.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AGENT_TECHNOLOGY_MANAGER_ID		= W1.AGENT_TECHNOLOGY_MANAGER_ID
,CONTRACTOR_SUPPORT_PATHWAY			= W1.CONTRACTOR_SUPPORT_PATHWAY
,INVOICE_SYSTEM_ID					= W1.INVOICE_SYSTEM_ID
,HOLIDAY_INVOICE_ID					= W1.HOLIDAY_INVOICE_ID
,HOLIDAY							= W1.HOLIDAY
,FILE_FORMAT_OF_PUSH				= W1.FILE_FORMAT_OF_PUSH
,AGENT_PREPARATION_INVOICE_ID		= W1.AGENT_PREPARATION_INVOICE_ID
,NEW_ACL							= W1.NEW_ACL
,CURRENT_CATS						= W1.CURRENT_CATS
,CATS_ID							= W1.CATS_ID
,PATS_ID							= W1.PATS_ID
,SMART_ELIGIBLE						= W1.SMART_ELIGIBLE
,SMART_TIER_1						= W1.SMART_TIER_1
,SMART_TIER_2						= W1.SMART_TIER_2
,SMART_TIER_3						= W1.SMART_TIER_3
,INTERVAL							= W1.INTERVAL
,[DATE]								= W1.[DATE]
,HOD_INTERVAL						= W1.HOD_INTERVAL
,AU_DK_LOGGED_IN_DURATION			= W1.AU_DK_LOGGED_IN_DURATION
,AU_DK_AVAILABLE_DURATION			= W1.AU_DK_AVAILABLE_DURATION
,AU_DK_TALK_DURATION				= W1.AU_DK_TALK_DURATION
,AU_DK_IB_TALK_DURATION				= W1.AU_DK_IB_TALK_DURATION
,AU_DK_OB_TALK_DURATION				= W1.AU_DK_OB_TALK_DURATION
,AU_DK_CONVENTIONAL_ACW				= W1.AU_DK_CONVENTIONAL_ACW
,AU_DK_NR_DURATION					= W1.AU_DK_NR_DURATION
,AU_DK_PSEUDO_PRODUCTIVE_DURATION   = W1.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AU_DK_ADJUSTED_NR_DURATION         = W1.AU_DK_ADJUSTED_NR_DURATION
,AU_DK_TOTAL_PRODUCTIVE_DURATION    = W1.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS = W1.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AU_DK_XFER_COUNT					= W1.AU_DK_XFER_COUNT
,AU_DK_HOLD_COUNT					= W1.AU_DK_HOLD_COUNT
,AU_DK_CONFERENCE_COUNT				= W1.AU_DK_CONFERENCE_COUNT
,AU_DK_CONSULT_COUNT				= W1.AU_DK_CONSULT_COUNT
,AU_DK_PUP_COUNT					= W1.AU_DK_PUP_COUNT
,AU_DK_OFFERED_COUNT				= W1.AU_DK_OFFERED_COUNT
,AU_DK_HANDLED_COUNT				= W1.AU_DK_HANDLED_COUNT
,AU_DK_IB_HANDLE_COUNT				= W1.AU_DK_IB_HANDLE_COUNT
,AU_DK_OB_HANDLE_COUNT				= W1.AU_DK_OB_HANDLE_COUNT
,AU_DK_RONA_COUNT					= W1.AU_DK_RONA_COUNT
,AU_DK_AWR_COUNT					= W1.AU_DK_AWR_COUNT
,MINIMUM_GUARANTEE					= W1.MINIMUM_GUARANTEE
,AUTHORIZED_TO_INVOICE				= W1.AUTHORIZED_TO_INVOICE
,WEEK_ENDING_DATE					= W1.WEEK_ENDING_DATE
,PAY_CYCLE_CLOSURE_DATE				= W1.PAY_CYCLE_CLOSURE_DATE

--FIELDS ABOVE ARE IN XML FILE.   FIELDS BELOW ARE NOT IN XML FILE!!!:
,FTP_FILE_NAME						= W1.FTP_FILE_NAME
,EMAIL								= W1.EMAIL

--,STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
,CAL_DATE							= W1.CAL_DATE
,TENANT_KEY							= W1.TENANT_KEY
,AIR_DAY_TYPE						= W1.AIR_DAY_TYPE
,AIR_ACW_FONT_COLOR					= W1.AIR_ACW_FONT_COLOR
,MIN_GUARANTEE_RATE					= W1.MIN_GUARANTEE_RATE
,MIN_GUARANTEE_TYPE					= W1.MIN_GUARANTEE_TYPE
,AUTHORIZED_TO_INVOICE_TYPE			= W1.AUTHORIZED_TO_INVOICE_TYPE
,HAS_HOLIDAYS						= W1.HAS_HOLIDAYS
,INCLUDE_IN_CAS						= W1.INCLUDE_IN_CAS
,READY_FOR_XML						= W1.READY_FOR_XML
,SHOW_ID_EXTS						= W1.SHOW_ID_EXTS
,INVOICE_ID							= W1.INVOICE_ID
,RESOURCE_NAME						= W1.RESOURCE_NAME

,AIRITKDUR							= W1.AIRITKDUR
,AIRIACDUR							= W1.AIRIACDUR

--,WS_ROW_CREATED_TIME
,WS_ROW_UPDATED_TIME				= @WS_ROW_CREATED_TIME

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY   W1

INNER JOIN      WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA			  UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY
																 AND UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION
																 AND UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY = W1.STD_TENANT_START_DATE_TIME_KEY )
  AND ( UV.ACD_ID_EXTENSION               = W1.ACD_ID_EXTENSION )
  AND ( UV.INVOICE_MAP_KEY                = W1.INVOICE_MAP_KEY )


--=====================================================
--INSERT TMP TABLE FIELDS INTO WSOL_TB_... TABLE:
--=====================================================
INSERT INTO [WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA]
SELECT 
 AIA.[PLATFORM]
,AIA.[STATUS]
,AIA.INVOICE_MAP_KEY
,AIA.FIELD_NAME
,AIA.SCHEDULER_PROJECT_ID
,AIA.SCHEDULER_ACL_NAME
,AIA.ACD_ID_EXTENSION
,AIA.OFFICIAL_WSOL_CLIENT_ID
,AIA.OFFICIAL_WSOL_CLIENT_NAME
,AIA.OFFICIAL_ACD_CLIENT_ID
,AIA.OFFICIAL_ACD_CLIENT_NAME
,AIA.PRIMARY_PROJECT_MANAGER_ID
,AIA.DIRECTOR_OF_PROJECT_MANAGEMENT_ID
,AIA.AGENT_TECHNOLOGY_MANAGER_ID
,AIA.CONTRACTOR_SUPPORT_PATHWAY
,AIA.INVOICE_SYSTEM_ID
,AIA.HOLIDAY_INVOICE_ID
,AIA.HOLIDAY
,AIA.FILE_FORMAT_OF_PUSH
,AIA.AGENT_PREPARATION_INVOICE_ID
,AIA.NEW_ACL
,AIA.CURRENT_CATS
,AIA.CATS_ID
,AIA.PATS_ID
,AIA.SMART_ELIGIBLE
,AIA.SMART_TIER_1
,AIA.SMART_TIER_2
,AIA.SMART_TIER_3
,AIA.INTERVAL
,AIA.[DATE]
,AIA.HOD_INTERVAL
,AIA.AU_DK_LOGGED_IN_DURATION
,AIA.AU_DK_AVAILABLE_DURATION
,AIA.AU_DK_TALK_DURATION
,AIA.AU_DK_IB_TALK_DURATION
,AIA.AU_DK_OB_TALK_DURATION
,AIA.AU_DK_CONVENTIONAL_ACW
,AIA.AU_DK_NR_DURATION
,AIA.AU_DK_PSEUDO_PRODUCTIVE_DURATION
,AIA.AU_DK_ADJUSTED_NR_DURATION
,AIA.AU_DK_TOTAL_PRODUCTIVE_DURATION
,AIA.AU_DK_WPSEUDO_PRODUCTIVE_DURATIONS
,AIA.AU_DK_XFER_COUNT
,AIA.AU_DK_HOLD_COUNT
,AIA.AU_DK_CONFERENCE_COUNT
,AIA.AU_DK_CONSULT_COUNT
,AIA.AU_DK_PUP_COUNT
,AIA.AU_DK_OFFERED_COUNT
,AIA.AU_DK_HANDLED_COUNT
,AIA.AU_DK_IB_HANDLE_COUNT
,AIA.AU_DK_OB_HANDLE_COUNT
,AIA.AU_DK_RONA_COUNT
,AIA.AU_DK_AWR_COUNT
,AIA.MINIMUM_GUARANTEE
,AIA.AUTHORIZED_TO_INVOICE
,AIA.WEEK_ENDING_DATE
,AIA.PAY_CYCLE_CLOSURE_DATE

,AIA.FTP_FILE_NAME
,AIA.EMAIL
,AIA.STD_TENANT_START_DATE_TIME_KEY
,AIA.CAL_DATE
,AIA.TENANT_KEY
,AIA.AIR_DAY_TYPE
,AIA.AIR_ACW_FONT_COLOR
,AIA.MIN_GUARANTEE_RATE
,AIA.MIN_GUARANTEE_TYPE
,AIA.AUTHORIZED_TO_INVOICE_TYPE
,AIA.HAS_HOLIDAYS
,AIA.INCLUDE_IN_CAS
,AIA.READY_FOR_XML
,AIA.SHOW_ID_EXTS
,AIA.INVOICE_ID
,AIA.RESOURCE_NAME
,AIA.AIRITKDUR
,AIA.AIRIACDUR
,AIA.WS_ROW_CREATED_TIME
,AIA.WS_ROW_UPDATED_TIME

--Where Permanent table is Null and Work table is not Null - then we want to add the data!!!:

FROM            #WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA_HOLIDAY   AIA
LEFT JOIN       WSOL_TB_IMPORTS_EGENCIA_UV_ANT_AIA			  UV  ON UV.STD_TENANT_START_DATE_TIME_KEY = AIA.STD_TENANT_START_DATE_TIME_KEY
																 AND UV.ACD_ID_EXTENSION               = AIA.ACD_ID_EXTENSION
																 AND UV.INVOICE_MAP_KEY                = AIA.INVOICE_MAP_KEY

WHERE ( UV.STD_TENANT_START_DATE_TIME_KEY IS NULL AND ISNULL(AIA.STD_TENANT_START_DATE_TIME_KEY,0) <> 0 )
  AND ( UV.ACD_ID_EXTENSION               IS NULL AND ISNULL(AIA.ACD_ID_EXTENSION,'') <> '' )
  AND ( UV.INVOICE_MAP_KEY                IS NULL AND ISNULL(AIA.INVOICE_MAP_KEY,'') <> '' )

--=============================================
EARLY_EXIT:
--=============================================