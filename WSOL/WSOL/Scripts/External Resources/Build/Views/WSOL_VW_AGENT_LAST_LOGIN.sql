CREATE VIEW [dbo].[WSOL_VW_AGENT_LAST_LOGIN]
AS

-- <<<<< APFM >>>>> --
SELECT
 'A Place for Mom'						AS CLIENT_NAME
,APFM.RESOURCE_NAME						AS AGENT_NAME
,APFM.EMPLOYEE_ID						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, APFM.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT *
FROM WSOL_TB_IMPORTS_APFM_INVOICING	APFM
WHERE APFM.LOGGED_IN_DUR > 0.00
  AND ISNULL(APFM.RESOURCE_NAME,'') <> ''
  AND APFM.BILLABLE_SKILL_Y_N <> 'N'
GROUP BY
 APFM.RESOURCE_NAME
,APFM.EMPLOYEE_ID

UNION ALL

-- <<<<< DATALOT >>>>> --
SELECT
 'Datalot Inc.'							AS CLIENT_NAME
,DLOT.RESOURCE_NAME						AS AGENT_NAME
,DLOT.FF_AGENT_ID						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, DLOT.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM YZ_TB_IMPORTS_DATALOT_INVOICING DLOT
WHERE DLOT.ONLINE_TIME > 0.00
  AND ISNULL(DLOT.RESOURCE_NAME,'') <> ''
GROUP BY
 DLOT.RESOURCE_NAME
,DLOT.FF_AGENT_ID

UNION ALL

-- <<<<< GAR >>>>> --
SELECT
 'GetARoom.com'							AS CLIENT_NAME
,GETA.RESOURCE_NAME						AS AGENT_NAME
,GETA.FF_AGENT_NAME						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, GETA.[DATETIME]))	AS LAST_LOGIN_DATE
 --SELECT TOP 100 *
FROM WSOL_TB_IMPORTS_GAR_INVOICING GETA
WHERE GETA.LOGIN_TIME > 0.00
GROUP BY
 GETA.RESOURCE_NAME
,GETA.FF_AGENT_NAME

UNION ALL

-- <<<<< BRIGHT PATTERN >>>>> --		SWITCHED FROM HUMACH TO BRIGHT PATTERN ON 11/3/17
SELECT
 CASE WHEN BRPA.FF_TEAM = 'i9 Sports Agents'	THEN 'i9 Sports Corporation'
	  WHEN BRPA.FF_TEAM = 'Asurion Agents'		THEN 'Asurion'
	  ELSE 'BRIGHT_PATTERN'
 END									AS CLIENT_NAME
,BRPA.RESOURCE_NAME						AS AGENT_NAME
,BRPA.EMPLOYEE_ID						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, BRPA.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 5000 *
FROM WSOL_TB_IMPORTS_BRIGHT_PATTERN_INVOICING BRPA
WHERE BRPA.LOGGED_IN_TIME > 0.00
  AND ISNULL(BRPA.INVOICE_ID,'') <> ''
GROUP BY
 CASE WHEN BRPA.FF_TEAM = 'i9 Sports Agents'	THEN 'i9 Sports Corporation'
	  WHEN BRPA.FF_TEAM = 'Asurion Agents'		THEN 'Asurion'
	  ELSE 'BRIGHT_PATTERN'
 END
,BRPA.EMPLOYEE_ID
,BRPA.RESOURCE_NAME

UNION ALL

-- <<<<< SABRE >>>>> --
SELECT
 'Sabre GLBL Inc'						AS CLIENT_NAME
,SABR.RESOURCE_NAME						AS AGENT_NAME
,SABR.FF_USERNAME						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, SABR.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM WSOL_TB_IMPORTS_SABRE_INVOICING SABR
WHERE SABR.STAFFED_TIME > 0.00
GROUP BY
 SABR.RESOURCE_NAME
,SABR.FF_USERNAME

UNION ALL

-- <<<<< STUBHUB >>>>> --
SELECT
 'StubHub'								AS CLIENT_NAME
,STUB.RESOURCE_NAME						AS AGENT_NAME
,STUB.FF_USER_NAME						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, STUB.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM YZ_TB_IMPORTS_STUBHUB_INVOICING STUB
WHERE STUB.LOGGED_IN_TIME > 0
  AND ISNULL(STUB.RESOURCE_NAME,'') <> ''
GROUP BY
 STUB.RESOURCE_NAME
,STUB.FF_USER_NAME

UNION ALL

-- <<<<< WORLD VENTURES >>>>> --
SELECT
 'World Ventures'						AS CLIENT_NAME
,WRLD.RESOURCE_NAME						AS AGENT_NAME
,WRLD.FF_AGENT_NAME						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, WRLD.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM WSOL_TB_IMPORTS_WV_INCONTACT_INVOICING WRLD
WHERE WRLD.LOGIN_TIME > 0.00
GROUP BY
 WRLD.RESOURCE_NAME
,WRLD.FF_AGENT_NAME

UNION ALL

-- <<<<< EGENCIA >>>>> --
SELECT
 'Egencia'								AS CLIENT_NAME
,EGEN.RESOURCE_NAME						AS AGENT_NAME
,EGEN.FF_LOGIN_ID						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, EGEN.DATETIME_CT))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM WSOL_TB_IMPORTS_EGENCIA_INVOICING EGEN
WHERE EGEN.STAFFED_SECS > 0.00
  AND ISNULL(EGEN.RESOURCE_NAME,'') <> ''
GROUP BY
 EGEN.RESOURCE_NAME
,EGEN.FF_LOGIN_ID

UNION ALL

-- <<<<< MONAT GLOBAL >>>>> --
SELECT
 'Monat Global Corp'					AS CLIENT_NAME
,MONA.RESOURCE_NAME						AS AGENT_NAME
,MONA.FF_AGENT_NAME						AS INVOICE_MAP_KEY
,MAX(CONVERT(DATE, MONA.[DATETIME]))	AS LAST_LOGIN_DATE
--SELECT TOP 100 *
FROM WSOL_TB_IMPORTS_MONAT_IC_INVOICING MONA
WHERE MONA.LOGIN_TIME > 0.00
  AND ISNULL(MONA.RESOURCE_NAME,'') <> ''
GROUP BY
 MONA.RESOURCE_NAME
,MONA.FF_AGENT_NAME

-- SELECT * FROM CLIENT ORDER BY [NAME]
GO