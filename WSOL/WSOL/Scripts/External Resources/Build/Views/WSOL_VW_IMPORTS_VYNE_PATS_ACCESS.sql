


CREATE VIEW [dbo].[WSOL_VW_IMPORTS_VYNE_PATS_ACCESS]
AS

SELECT DAT.*
FROM
(
SELECT
 APP.FIRSTNAME + ' ' + APP.LASTNAME										AS AGENT_FULL_NAME
,APP.FIRSTNAME															AS FF_OFFICIAL_ACL_FIRST_NAME
,APP.LASTNAME															AS FF_OFFICIAL_ACL_LAST_NAME
,REPLACE((LEFT(APP.FIRSTNAME,1) + LEFT(APP.LASTNAME,7)),' ','')			AS ALIAS
,APP.CORPORATNAME														AS CORPORATE_NAME
,APP.AGENTID															AS AGENT_ID
,APP.AGENTIDENTNUM														AS ID_NUMBER
,APS.[NAME]																AS CATS_STATUS_CODE
,APP.PHONE																AS PRIMARY_PHONE
,ISNULL(CONVERT(VARCHAR(50), APP.MOBILEPHONE),'')						AS MOBILE_PHONE
,CASE WHEN APP.MOBILETERMS = 'Y' THEN 'Yes'
	  WHEN APP.MOBILETERMS = 'N' THEN 'No'
	  ELSE APP.MOBILETERMS
 END																	AS MOBILE_TERMS
,APP.EMAIL																AS USERNAME
,PRJ.[NAME]																AS [PROGRAM_NAME]
,'Welcome'																AS [GROUP]
,PRD.ROSTERNUMBER														AS PATS_ROSTER_NUMBER
,PRT.[NAME]																AS TYPE_OF_PREP
,TRA.FIRSTNAME + ' ' + TRA.LASTNAME										AS TRAINER_NAME
,PRD.DATESTART															AS [START_DATE]
,PRD.DATESTOP															AS END_DATE
,CASE WHEN PRA.COMPLETION = 'Y' THEN 'Yes'
	  WHEN PRA.COMPLETION = 'N' THEN 'No'
	  WHEN PRA.COMPLETION = 'A' THEN 'DP'
	  WHEN PRA.COMPLETION = 'M' THEN 'MR'
	  ELSE PRA.COMPLETION END											AS COMPLETION_STATUS
,RES.[NAME]																AS REASON_CODE
,CASE WHEN PRD.OPENCLOSESTATUS = 'C' THEN 'Closed'
	  ELSE 'Open' END													AS PATS_ROSTER_STATUS
,APP.MAILADDR															AS STREET_ADDRESS
,APP.CITY																AS CITY
,APP.IDSTATE															AS [STATE_PROVINCE]
,APP.ZIP																AS ZIP
,APP.IDCOUNTRY															AS COUNTRY
,APP.FIRSTNAME + ' ' + RTRIM(LTRIM(APP.MIDDLINIT)) + ' ' + APP.LASTNAME	AS CATS_PROFILE_NAME
,APP.FIRSTNAME + ' '
			   + LEFT(APP.LASTNAME,1)
			   + '. - WS Agent Since '
			   + CONVERT(CHAR(3), PRD.DATESTART,0)
			   + '. '
			   + CAST(YEAR(PRD.DATESTART) AS VARCHAR(4))				AS NICKNAME
,APP.DATEUPDATED														AS LAST_CHANGED_DATE
,CLI.ID																	AS CLIENT_ID
,CLI.[NAME]																AS CLIENT_NAME
FROM PREPARATIONDATA			PRD
LEFT JOIN TYPEOFPREPARATION		PRT ON PRD.IDTYPEOFPREPARATION	= PRT.IDTYPEOFPREPARATION
LEFT JOIN PROJECT				PRJ ON PRD.IDPROJECT			= PRJ.IDPROJECT
LEFT JOIN PREPARATIONAGENT		PRA ON PRD.IDPREPARATIONDATA	= PRA.IDPREPARATIONDATA
LEFT JOIN APPLICANT				APP ON PRA.EMAIL				= APP.EMAIL
LEFT JOIN APPSTATUS				APS ON APP.IDAPPSTATUS			= APS.IDAPPSTATUS
LEFT JOIN PREPARATIONTRAINER	TRA ON PRD.IDPREPARATIONTRAINER	= TRA.IDPREPARATIONTRAINER
LEFT JOIN PREPARATIONREASON		RES ON PRA.IDPREPARATIONREASON	= RES.IDPREPARATIONREASON
LEFT JOIN CLIENT				CLI ON PRJ.IDCLIENT				= CLI.ID
WHERE PRT.IDTYPEOFPREPARATION = 1
  AND PRD.ISDELETED <> 'Y'
) DAT

WHERE DAT.ID_NUMBER IS NOT NULL
GO